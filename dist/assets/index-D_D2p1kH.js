(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const Ks=[32,64,125,250,500,1e3,2e3,4e3,8e3,16e3];function wc(r,e){const t=r.numberOfChannels,n=e||r.length,i=n*t*2,s=new ArrayBuffer(44+i),a=new DataView(s);function c(m,_,T){for(let R=0;R<T.length;R++)m.setUint8(_+R,T.charCodeAt(R))}c(a,0,"RIFF"),a.setUint32(4,36+i,!0),c(a,8,"WAVE"),c(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,t,!0),a.setUint32(24,r.sampleRate,!0),a.setUint32(28,r.sampleRate*2*t,!0),a.setUint16(32,t*2,!0),a.setUint16(34,16,!0),c(a,36,"data"),a.setUint32(40,i,!0);const l=new Int16Array(s,44,n*t),h=[];for(let m=0;m<t;m++)h.push(r.getChannelData(m));let f=0;for(let m=0;m<n;m++)for(let _=0;_<t;_++){let T=h[_][m];T=Math.max(-1,Math.min(1,T)),l[f++]=T<0?T*32768:T*32767}return new Blob([s],{type:"audio/wav"})}function If(r,e,t,n){const i=Math.floor(e*r.length),s=Math.floor(t*r.length),a=s-i;if(a<=0)return null;const c=n.createBuffer(r.numberOfChannels,a,r.sampleRate);for(let l=0;l<r.numberOfChannels;l++)c.copyToChannel(r.getChannelData(l).slice(i,s),l);return c}function ii(r){const e=typeof r=="number"?r:50,t=44100,n=new Float32Array(t),i=Math.PI/180;for(let s=0;s<t;++s){const a=s*2/t-1;n[s]=(3+e)*a*20*i/(Math.PI+e*Math.abs(a))}return n}function bf(r,e,t){const n=r.numberOfChannels,i=r.length,s=1/Math.pow(2,e),a=1/s,c=Math.floor(1/t);for(let l=0;l<n;l++){const h=r.getChannelData(l);let f=0;for(let m=0;m<i;m++){if(m%c===0){let _=h[m];_=Math.round(_*a)*s,f=_}h[m]=f}}return r}function Af(r,e,t,n){const i=r.numberOfChannels,s=n.createBuffer(i,r.length,r.sampleRate),a=Math.floor(e*r.sampleRate),c=Math.floor(t*r.sampleRate);for(let l=0;l<i;l++){const h=r.getChannelData(l),f=s.getChannelData(l);f.set(h),c>a&&f.subarray(a,c).reverse()}return s}async function Rf(r,e,t,n,i){const s=r.sampleRate,a=r.numberOfChannels,c=Math.floor(e*s),l=Math.floor(t*s),h=l-c;if(h<=0)return r;const f=new OfflineAudioContext(a,h,s),m=f.createBufferSource(),_=f.createBuffer(a,h,s);for(let N=0;N<a;N++)_.copyToChannel(r.getChannelData(N).slice(c,l),N);m.buffer=_;let T=m,R=f.destination;if(n==="distortion"){const N=f.createWaveShaper();N.curve=ii(i.amount),N.oversample="4x",T.connect(N),N.connect(R)}else if(n==="delay"){const N=f.createDelay();N.delayTime.value=i.time||.3;const O=f.createGain();O.gain.value=i.feedback||.5,T.connect(R),T.connect(N),N.connect(O),O.connect(N),N.connect(R)}else n==="bitcrush"&&T.connect(R);m.start(0);let k=await f.startRendering();n==="bitcrush"&&(k=bf(k,i.bits||8,i.normFreq||.5));const S=new OfflineAudioContext(a,r.length,s).createBuffer(a,r.length,s);for(let N=0;N<a;N++){const O=S.getChannelData(N);O.set(r.getChannelData(N)),O.set(k.getChannelData(N),c)}return S}async function Tc(r,e,t,n,i,s={}){return t==="reverse"?Af(r,n,i,e):["distortion","delay","bitcrush"].includes(t)?await Rf(r,n,i,t,s):r}const Cf=()=>{};var Ic={};const ou=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Sf=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const i=r[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const s=r[t++];e[n++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=r[t++],a=r[t++],c=r[t++],l=((i&7)<<18|(s&63)<<12|(a&63)<<6|c&63)-65536;e[n++]=String.fromCharCode(55296+(l>>10)),e[n++]=String.fromCharCode(56320+(l&1023))}else{const s=r[t++],a=r[t++];e[n++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},au={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<r.length;i+=3){const s=r[i],a=i+1<r.length,c=a?r[i+1]:0,l=i+2<r.length,h=l?r[i+2]:0,f=s>>2,m=(s&3)<<4|c>>4;let _=(c&15)<<2|h>>6,T=h&63;l||(T=64,a||(_=64)),n.push(t[f],t[m],t[_],t[T])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(ou(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):Sf(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<r.length;){const s=t[r.charAt(i++)],c=i<r.length?t[r.charAt(i)]:0;++i;const h=i<r.length?t[r.charAt(i)]:64;++i;const m=i<r.length?t[r.charAt(i)]:64;if(++i,s==null||c==null||h==null||m==null)throw new Pf;const _=s<<2|c>>4;if(n.push(_),h!==64){const T=c<<4&240|h>>2;if(n.push(T),m!==64){const R=h<<6&192|m;n.push(R)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Pf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const kf=function(r){const e=ou(r);return au.encodeByteArray(e,!0)},gi=function(r){return kf(r).replace(/\./g,"")},cu=function(r){try{return au.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Df(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Nf=()=>Df().__FIREBASE_DEFAULTS__,xf=()=>{if(typeof process>"u"||typeof Ic>"u")return;const r=Ic.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Of=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&cu(r[1]);return e&&JSON.parse(e)},Vi=()=>{try{return Cf()||Nf()||xf()||Of()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},lu=r=>Vi()?.emulatorHosts?.[r],uu=r=>{const e=lu(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},hu=()=>Vi()?.config,du=r=>Vi()?.[`_${r}`];class Lf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}function Mt(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Io(r){return(await fetch(r,{credentials:"include"})).ok}function fu(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",i=r.iat||0,s=r.sub||r.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...r};return[gi(JSON.stringify(t)),gi(JSON.stringify(a)),""].join(".")}const sr={};function Vf(){const r={prod:[],emulator:[]};for(const e of Object.keys(sr))sr[e]?r.emulator.push(e):r.prod.push(e);return r}function Mf(r){let e=document.getElementById(r),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",r),t=!0),{created:t,element:e}}let bc=!1;function bo(r,e){if(typeof window>"u"||typeof document>"u"||!Mt(window.location.host)||sr[r]===e||sr[r]||bc)return;sr[r]=e;function t(_){return`__firebase__banner__${_}`}const n="__firebase__banner",s=Vf().prod.length>0;function a(){const _=document.getElementById(n);_&&_.remove()}function c(_){_.style.display="flex",_.style.background="#7faaf0",_.style.position="fixed",_.style.bottom="5px",_.style.left="5px",_.style.padding=".5em",_.style.borderRadius="5px",_.style.alignItems="center"}function l(_,T){_.setAttribute("width","24"),_.setAttribute("id",T),_.setAttribute("height","24"),_.setAttribute("viewBox","0 0 24 24"),_.setAttribute("fill","none"),_.style.marginLeft="-6px"}function h(){const _=document.createElement("span");return _.style.cursor="pointer",_.style.marginLeft="16px",_.style.fontSize="24px",_.innerHTML=" &times;",_.onclick=()=>{bc=!0,a()},_}function f(_,T){_.setAttribute("id",T),_.innerText="Learn more",_.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",_.setAttribute("target","__blank"),_.style.paddingLeft="5px",_.style.textDecoration="underline"}function m(){const _=Mf(n),T=t("text"),R=document.getElementById(T)||document.createElement("span"),k=t("learnmore"),S=document.getElementById(k)||document.createElement("a"),N=t("preprendIcon"),O=document.getElementById(N)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(_.created){const V=_.element;c(V),f(S,k);const z=h();l(O,N),V.append(O,R,S,z),document.body.appendChild(V)}s?(R.innerText="Preview backend disconnected.",O.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(O.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,R.innerText="Preview backend running in this workspace."),R.setAttribute("id",T)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function be(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Uf(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(be())}function Ff(){const r=Vi()?.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Bf(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function qf(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function zf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function jf(){const r=be();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function $f(){return!Ff()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Hf(){try{return typeof indexedDB=="object"}catch{return!1}}function Wf(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}const Gf="FirebaseError";class Ze extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Gf,Object.setPrototypeOf(this,Ze.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,vr.prototype.create)}}class vr{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?Kf(s,n):"Error",c=`${this.serviceName}: ${a} (${i}).`;return new Ze(i,c,n)}}function Kf(r,e){return r.replace(Qf,(t,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const Qf=/\{\$([^}]+)}/g;function Xf(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function nt(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const i of t){if(!n.includes(i))return!1;const s=r[i],a=e[i];if(Ac(s)&&Ac(a)){if(!nt(s,a))return!1}else if(s!==a)return!1}for(const i of n)if(!t.includes(i))return!1;return!0}function Ac(r){return r!==null&&typeof r=="object"}function Er(r){const e=[];for(const[t,n]of Object.entries(r))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Yf(r,e){const t=new Jf(r,e);return t.subscribe.bind(t)}class Jf{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");Zf(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:n},i.next===void 0&&(i.next=Ds),i.error===void 0&&(i.error=Ds),i.complete===void 0&&(i.complete=Ds);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Zf(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function Ds(){}function fe(r){return r&&r._delegate?r._delegate:r}class St{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ht="[DEFAULT]";class ep{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Lf;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(n)return null;throw i}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(np(e))try{this.getOrInitializeService({instanceIdentifier:Ht})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});n.resolve(s)}catch{}}}}clearInstance(e=Ht){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ht){return this.instances.has(e)}getOptions(e=Ht){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(s);n===c&&a.resolve(i)}return i}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);const s=this.instances.get(n);return s&&e(s,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:tp(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Ht){return this.component?this.component.multipleInstances?e:Ht:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function tp(r){return r===Ht?void 0:r}function np(r){return r.instantiationMode==="EAGER"}class rp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new ep(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var G;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(G||(G={}));const ip={debug:G.DEBUG,verbose:G.VERBOSE,info:G.INFO,warn:G.WARN,error:G.ERROR,silent:G.SILENT},sp=G.INFO,op={[G.DEBUG]:"log",[G.VERBOSE]:"log",[G.INFO]:"info",[G.WARN]:"warn",[G.ERROR]:"error"},ap=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),i=op[e];if(i)console[i](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ao{constructor(e){this.name=e,this._logLevel=sp,this._logHandler=ap,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in G))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ip[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,G.DEBUG,...e),this._logHandler(this,G.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,G.VERBOSE,...e),this._logHandler(this,G.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,G.INFO,...e),this._logHandler(this,G.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,G.WARN,...e),this._logHandler(this,G.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,G.ERROR,...e),this._logHandler(this,G.ERROR,...e)}}const cp=(r,e)=>e.some(t=>r instanceof t);let Rc,Cc;function lp(){return Rc||(Rc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function up(){return Cc||(Cc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pu=new WeakMap,Qs=new WeakMap,mu=new WeakMap,Ns=new WeakMap,Ro=new WeakMap;function hp(r){const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("success",s),r.removeEventListener("error",a)},s=()=>{t(wt(r.result)),i()},a=()=>{n(r.error),i()};r.addEventListener("success",s),r.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&pu.set(t,r)}).catch(()=>{}),Ro.set(e,r),e}function dp(r){if(Qs.has(r))return;const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("complete",s),r.removeEventListener("error",a),r.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",s),r.addEventListener("error",a),r.addEventListener("abort",a)});Qs.set(r,e)}let Xs={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Qs.get(r);if(e==="objectStoreNames")return r.objectStoreNames||mu.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return wt(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function fp(r){Xs=r(Xs)}function pp(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(xs(this),e,...t);return mu.set(n,e.sort?e.sort():[e]),wt(n)}:up().includes(r)?function(...e){return r.apply(xs(this),e),wt(pu.get(this))}:function(...e){return wt(r.apply(xs(this),e))}}function mp(r){return typeof r=="function"?pp(r):(r instanceof IDBTransaction&&dp(r),cp(r,lp())?new Proxy(r,Xs):r)}function wt(r){if(r instanceof IDBRequest)return hp(r);if(Ns.has(r))return Ns.get(r);const e=mp(r);return e!==r&&(Ns.set(r,e),Ro.set(e,r)),e}const xs=r=>Ro.get(r);function gp(r,e,{blocked:t,upgrade:n,blocking:i,terminated:s}={}){const a=indexedDB.open(r,e),c=wt(a);return n&&a.addEventListener("upgradeneeded",l=>{n(wt(a.result),l.oldVersion,l.newVersion,wt(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const _p=["get","getKey","getAll","getAllKeys","count"],yp=["put","add","delete","clear"],Os=new Map;function Sc(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Os.get(e))return Os.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,i=yp.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||_p.includes(t)))return;const s=async function(a,...c){const l=this.transaction(a,i?"readwrite":"readonly");let h=l.store;return n&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),i&&l.done]))[0]};return Os.set(e,s),s}fp(r=>({...r,get:(e,t,n)=>Sc(e,t)||r.get(e,t,n),has:(e,t)=>!!Sc(e,t)||r.has(e,t)}));class vp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ep(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function Ep(r){return r.getComponent()?.type==="VERSION"}const Ys="@firebase/app",Pc="0.14.6";const rt=new Ao("@firebase/app"),wp="@firebase/app-compat",Tp="@firebase/analytics-compat",Ip="@firebase/analytics",bp="@firebase/app-check-compat",Ap="@firebase/app-check",Rp="@firebase/auth",Cp="@firebase/auth-compat",Sp="@firebase/database",Pp="@firebase/data-connect",kp="@firebase/database-compat",Dp="@firebase/functions",Np="@firebase/functions-compat",xp="@firebase/installations",Op="@firebase/installations-compat",Lp="@firebase/messaging",Vp="@firebase/messaging-compat",Mp="@firebase/performance",Up="@firebase/performance-compat",Fp="@firebase/remote-config",Bp="@firebase/remote-config-compat",qp="@firebase/storage",zp="@firebase/storage-compat",jp="@firebase/firestore",$p="@firebase/ai",Hp="@firebase/firestore-compat",Wp="firebase",Gp="12.6.0";const Js="[DEFAULT]",Kp={[Ys]:"fire-core",[wp]:"fire-core-compat",[Ip]:"fire-analytics",[Tp]:"fire-analytics-compat",[Ap]:"fire-app-check",[bp]:"fire-app-check-compat",[Rp]:"fire-auth",[Cp]:"fire-auth-compat",[Sp]:"fire-rtdb",[Pp]:"fire-data-connect",[kp]:"fire-rtdb-compat",[Dp]:"fire-fn",[Np]:"fire-fn-compat",[xp]:"fire-iid",[Op]:"fire-iid-compat",[Lp]:"fire-fcm",[Vp]:"fire-fcm-compat",[Mp]:"fire-perf",[Up]:"fire-perf-compat",[Fp]:"fire-rc",[Bp]:"fire-rc-compat",[qp]:"fire-gcs",[zp]:"fire-gcs-compat",[jp]:"fire-fst",[Hp]:"fire-fst-compat",[$p]:"fire-vertex","fire-js":"fire-js",[Wp]:"fire-js-all"};const _i=new Map,Qp=new Map,Zs=new Map;function kc(r,e){try{r.container.addComponent(e)}catch(t){rt.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function Qt(r){const e=r.name;if(Zs.has(e))return rt.debug(`There were multiple attempts to register component ${e}.`),!1;Zs.set(e,r);for(const t of _i.values())kc(t,r);for(const t of Qp.values())kc(t,r);return!0}function Mi(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function Le(r){return r==null?!1:r.settings!==void 0}const Xp={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Tt=new vr("app","Firebase",Xp);class Yp{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new St("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Tt.create("app-deleted",{appName:this._name})}}const en=Gp;function gu(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n={name:Js,automaticDataCollectionEnabled:!0,...e},i=n.name;if(typeof i!="string"||!i)throw Tt.create("bad-app-name",{appName:String(i)});if(t||(t=hu()),!t)throw Tt.create("no-options");const s=_i.get(i);if(s){if(nt(t,s.options)&&nt(n,s.config))return s;throw Tt.create("duplicate-app",{appName:i})}const a=new rp(i);for(const l of Zs.values())a.addComponent(l);const c=new Yp(t,n,a);return _i.set(i,c),c}function Co(r=Js){const e=_i.get(r);if(!e&&r===Js&&hu())return gu();if(!e)throw Tt.create("no-app",{appName:r});return e}function $e(r,e,t){let n=Kp[r]??r;t&&(n+=`-${t}`);const i=n.match(/\s|\//),s=e.match(/\s|\//);if(i||s){const a=[`Unable to register library "${n}" with version "${e}":`];i&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),rt.warn(a.join(" "));return}Qt(new St(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}const Jp="firebase-heartbeat-database",Zp=1,dr="firebase-heartbeat-store";let Ls=null;function _u(){return Ls||(Ls=gp(Jp,Zp,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(dr)}catch(t){console.warn(t)}}}}).catch(r=>{throw Tt.create("idb-open",{originalErrorMessage:r.message})})),Ls}async function em(r){try{const t=(await _u()).transaction(dr),n=await t.objectStore(dr).get(yu(r));return await t.done,n}catch(e){if(e instanceof Ze)rt.warn(e.message);else{const t=Tt.create("idb-get",{originalErrorMessage:e?.message});rt.warn(t.message)}}}async function Dc(r,e){try{const n=(await _u()).transaction(dr,"readwrite");await n.objectStore(dr).put(e,yu(r)),await n.done}catch(t){if(t instanceof Ze)rt.warn(t.message);else{const n=Tt.create("idb-set",{originalErrorMessage:t?.message});rt.warn(n.message)}}}function yu(r){return`${r.name}!${r.options.appId}`}const tm=1024,nm=30;class rm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new sm(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Nc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(i=>i.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats.length>nm){const i=om(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){rt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Nc(),{heartbeatsToSend:t,unsentEntries:n}=im(this._heartbeatsCache.heartbeats),i=gi(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return rt.warn(e),""}}}function Nc(){return new Date().toISOString().substring(0,10)}function im(r,e=tm){const t=[];let n=r.slice();for(const i of r){const s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),xc(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),xc(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class sm{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Hf()?Wf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await em(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Dc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Dc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function xc(r){return gi(JSON.stringify({version:2,heartbeats:r})).length}function om(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let n=1;n<r.length;n++)r[n].date<t&&(t=r[n].date,e=n);return e}function am(r){Qt(new St("platform-logger",e=>new vp(e),"PRIVATE")),Qt(new St("heartbeat",e=>new rm(e),"PRIVATE")),$e(Ys,Pc,r),$e(Ys,Pc,"esm2020"),$e("fire-js","")}am("");var cm="firebase",lm="12.6.0";$e(cm,lm,"app");function vu(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const um=vu,Eu=new vr("auth","Firebase",vu());const yi=new Ao("@firebase/auth");function hm(r,...e){yi.logLevel<=G.WARN&&yi.warn(`Auth (${en}): ${r}`,...e)}function si(r,...e){yi.logLevel<=G.ERROR&&yi.error(`Auth (${en}): ${r}`,...e)}function it(r,...e){throw So(r,...e)}function He(r,...e){return So(r,...e)}function wu(r,e,t){const n={...um(),[e]:t};return new vr("auth","Firebase",n).create(e,{appName:r.name})}function It(r){return wu(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function So(r,...e){if(typeof r!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return Eu.create(r,...e)}function j(r,e,...t){if(!r)throw So(e,...t)}function et(r){const e="INTERNAL ASSERTION FAILED: "+r;throw si(e),new Error(e)}function st(r,e){r||et(e)}function eo(){return typeof self<"u"&&self.location?.href||""}function dm(){return Oc()==="http:"||Oc()==="https:"}function Oc(){return typeof self<"u"&&self.location?.protocol||null}function fm(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(dm()||qf()||"connection"in navigator)?navigator.onLine:!0}function pm(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}class wr{constructor(e,t){this.shortDelay=e,this.longDelay=t,st(t>e,"Short delay should be less than long delay!"),this.isMobile=Uf()||zf()}get(){return fm()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Po(r,e){st(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Tu{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;et("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;et("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;et("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const mm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const gm=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],_m=new wr(3e4,6e4);function Ui(r,e){return r.tenantId&&!e.tenantId?{...e,tenantId:r.tenantId}:e}async function Sn(r,e,t,n,i={}){return Iu(r,i,async()=>{let s={},a={};n&&(e==="GET"?a=n:s={body:JSON.stringify(n)});const c=Er({key:r.config.apiKey,...a}).slice(1),l=await r._getAdditionalHeaders();l["Content-Type"]="application/json",r.languageCode&&(l["X-Firebase-Locale"]=r.languageCode);const h={method:e,headers:l,...s};return Bf()||(h.referrerPolicy="no-referrer"),r.emulatorConfig&&Mt(r.emulatorConfig.host)&&(h.credentials="include"),Tu.fetch()(await Au(r,r.config.apiHost,t,c),h)})}async function Iu(r,e,t){r._canInitEmulator=!1;const n={...mm,...e};try{const i=new ym(r),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw Gr(r,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const c=s.ok?a.errorMessage:a.error.message,[l,h]=c.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Gr(r,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw Gr(r,"email-already-in-use",a);if(l==="USER_DISABLED")throw Gr(r,"user-disabled",a);const f=n[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw wu(r,f,h);it(r,f)}}catch(i){if(i instanceof Ze)throw i;it(r,"network-request-failed",{message:String(i)})}}async function bu(r,e,t,n,i={}){const s=await Sn(r,e,t,n,i);return"mfaPendingCredential"in s&&it(r,"multi-factor-auth-required",{_serverResponse:s}),s}async function Au(r,e,t,n){const i=`${e}${t}?${n}`,s=r,a=s.config.emulator?Po(r.config,i):`${r.config.apiScheme}://${i}`;return gm.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a}class ym{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(He(this.auth,"network-request-failed")),_m.get())})}}function Gr(r,e,t){const n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const i=He(r,e,n);return i.customData._tokenResponse=t,i}async function vm(r,e){return Sn(r,"POST","/v1/accounts:delete",e)}async function vi(r,e){return Sn(r,"POST","/v1/accounts:lookup",e)}function or(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Em(r,e=!1){const t=fe(r),n=await t.getIdToken(e),i=ko(n);j(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:n,authTime:or(Vs(i.auth_time)),issuedAtTime:or(Vs(i.iat)),expirationTime:or(Vs(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}}function Vs(r){return Number(r)*1e3}function ko(r){const[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return si("JWT malformed, contained fewer than 3 sections"),null;try{const i=cu(t);return i?JSON.parse(i):(si("Failed to decode base64 JWT payload"),null)}catch(i){return si("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Lc(r){const e=ko(r);return j(e,"internal-error"),j(typeof e.exp<"u","internal-error"),j(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function fr(r,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof Ze&&wm(n)&&r.auth.currentUser===r&&await r.auth.signOut(),n}}function wm({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}class Tm{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class to{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=or(this.lastLoginAt),this.creationTime=or(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Ei(r){const e=r.auth,t=await r.getIdToken(),n=await fr(r,vi(e,{idToken:t}));j(n?.users.length,e,"internal-error");const i=n.users[0];r._notifyReloadListener(i);const s=i.providerUserInfo?.length?Ru(i.providerUserInfo):[],a=bm(r.providerData,s),c=r.isAnonymous,l=!(r.email&&i.passwordHash)&&!a?.length,h=c?l:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new to(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(r,f)}async function Im(r){const e=fe(r);await Ei(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function bm(r,e){return[...r.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function Ru(r){return r.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Am(r,e){const t=await Iu(r,{},async()=>{const n=Er({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=r.config,a=await Au(r,i,"/v1/token",`key=${s}`),c=await r._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:c,body:n};return r.emulatorConfig&&Mt(r.emulatorConfig.host)&&(l.credentials="include"),Tu.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Rm(r,e){return Sn(r,"POST","/v2/accounts:revokeToken",Ui(r,e))}class fn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){j(e.idToken,"internal-error"),j(typeof e.idToken<"u","internal-error"),j(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Lc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){j(e.length!==0,"internal-error");const t=Lc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(j(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await Am(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,a=new fn;return n&&(j(typeof n=="string","internal-error",{appName:e}),a.refreshToken=n),i&&(j(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(j(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new fn,this.toJSON())}_performRefresh(){return et("not implemented")}}function pt(r,e){j(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class Me{constructor({uid:e,auth:t,stsTokenManager:n,...i}){this.providerId="firebase",this.proactiveRefresh=new Tm(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new to(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await fr(this,this.stsTokenManager.getToken(this.auth,e));return j(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Em(this,e)}reload(){return Im(this)}_assign(e){this!==e&&(j(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Me({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){j(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Ei(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Le(this.auth.app))return Promise.reject(It(this.auth));const e=await this.getIdToken();return await fr(this,vm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,a=t.photoURL??void 0,c=t.tenantId??void 0,l=t._redirectEventId??void 0,h=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:m,emailVerified:_,isAnonymous:T,providerData:R,stsTokenManager:k}=t;j(m&&k,e,"internal-error");const S=fn.fromJSON(this.name,k);j(typeof m=="string",e,"internal-error"),pt(n,e.name),pt(i,e.name),j(typeof _=="boolean",e,"internal-error"),j(typeof T=="boolean",e,"internal-error"),pt(s,e.name),pt(a,e.name),pt(c,e.name),pt(l,e.name),pt(h,e.name),pt(f,e.name);const N=new Me({uid:m,auth:e,email:i,emailVerified:_,displayName:n,isAnonymous:T,photoURL:a,phoneNumber:s,tenantId:c,stsTokenManager:S,createdAt:h,lastLoginAt:f});return R&&Array.isArray(R)&&(N.providerData=R.map(O=>({...O}))),l&&(N._redirectEventId=l),N}static async _fromIdTokenResponse(e,t,n=!1){const i=new fn;i.updateFromServerResponse(t);const s=new Me({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await Ei(s),s}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];j(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?Ru(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!s?.length,c=new fn;c.updateFromIdToken(n);const l=new Me({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:a}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new to(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(l,h),l}}const Vc=new Map;function tt(r){st(r instanceof Function,"Expected a class definition");let e=Vc.get(r);return e?(st(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,Vc.set(r,e),e)}class Cu{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Cu.type="NONE";const Mc=Cu;function oi(r,e,t){return`firebase:${r}:${e}:${t}`}class pn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=oi(this.userKey,i.apiKey,s),this.fullPersistenceKey=oi("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await vi(this.auth,{idToken:e}).catch(()=>{});return t?Me._fromGetAccountInfoResponse(this.auth,t,e):null}return Me._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new pn(tt(Mc),e,n);const i=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let s=i[0]||tt(Mc);const a=oi(n,e.config.apiKey,e.name);let c=null;for(const h of t)try{const f=await h._get(a);if(f){let m;if(typeof f=="string"){const _=await vi(e,{idToken:f}).catch(()=>{});if(!_)break;m=await Me._fromGetAccountInfoResponse(e,_,f)}else m=Me._fromJSON(e,f);h!==s&&(c=m),s=h;break}}catch{}const l=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new pn(s,e,n):(s=l[0],c&&await s._set(a,c.toJSON()),await Promise.all(t.map(async h=>{if(h!==s)try{await h._remove(a)}catch{}})),new pn(s,e,n))}}function Uc(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Du(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Su(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(xu(e))return"Blackberry";if(Ou(e))return"Webos";if(Pu(e))return"Safari";if((e.includes("chrome/")||ku(e))&&!e.includes("edge/"))return"Chrome";if(Nu(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if(n?.length===2)return n[1]}return"Other"}function Su(r=be()){return/firefox\//i.test(r)}function Pu(r=be()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ku(r=be()){return/crios\//i.test(r)}function Du(r=be()){return/iemobile/i.test(r)}function Nu(r=be()){return/android/i.test(r)}function xu(r=be()){return/blackberry/i.test(r)}function Ou(r=be()){return/webos/i.test(r)}function Do(r=be()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function Cm(r=be()){return Do(r)&&!!window.navigator?.standalone}function Sm(){return jf()&&document.documentMode===10}function Lu(r=be()){return Do(r)||Nu(r)||Ou(r)||xu(r)||/windows phone/i.test(r)||Du(r)}function Vu(r,e=[]){let t;switch(r){case"Browser":t=Uc(be());break;case"Worker":t=`${Uc(be())}-${r}`;break;default:t=r}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${en}/${n}`}class Pm{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=s=>new Promise((a,c)=>{try{const l=e(s);a(l)}catch(l){c(l)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}async function km(r,e={}){return Sn(r,"GET","/v2/passwordPolicy",Ui(r,e))}const Dm=6;class Nm{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Dm,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class xm{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Fc(this),this.idTokenSubscription=new Fc(this),this.beforeStateQueue=new Pm(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Eu,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=tt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await pn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await vi(this,{idToken:e}),n=await Me._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Le(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=this.redirectUser?._redirectEventId,a=n?._redirectEventId,c=await this.tryRedirectSignIn(e);(!s||s===a)&&c?.user&&(n=c.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(s){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return j(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ei(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=pm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Le(this.app))return Promise.reject(It(this));const t=e?fe(e):null;return t&&j(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&j(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Le(this.app)?Promise.reject(It(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Le(this.app)?Promise.reject(It(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(tt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await km(this),t=new Nm(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new vr("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await Rm(this,n)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&tt(e)||this._popupRedirectResolver;j(t,this,"argument-error"),this.redirectPersistenceManager=await pn.create(this,[tt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(j(c,this,"internal-error"),c.then(()=>{a||s(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,n,i);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return j(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Vu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(Le(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&hm(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Fi(r){return fe(r)}class Fc{constructor(e){this.auth=e,this.observer=null,this.addObserver=Yf(t=>this.observer=t)}get next(){return j(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let No={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Om(r){No=r}function Lm(r){return No.loadJS(r)}function Vm(){return No.gapiScript}function Mm(r){return`__${r}${Math.floor(Math.random()*1e6)}`}function Um(r,e){const t=Mi(r,"auth");if(t.isInitialized()){const i=t.getImmediate(),s=t.getOptions();if(nt(s,e??{}))return i;it(i,"already-initialized")}return t.initialize({options:e})}function Fm(r,e){const t=e?.persistence||[],n=(Array.isArray(t)?t:[t]).map(tt);e?.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e?.popupRedirectResolver)}function Bm(r,e,t){const n=Fi(r);j(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const i=!1,s=Mu(e),{host:a,port:c}=qm(e),l=c===null?"":`:${c}`,h={url:`${s}//${a}${l}/`},f=Object.freeze({host:a,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){j(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),j(nt(h,n.config.emulator)&&nt(f,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=h,n.emulatorConfig=f,n.settings.appVerificationDisabledForTesting=!0,Mt(a)?(Io(`${s}//${a}${l}`),bo("Auth",!0)):zm()}function Mu(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function qm(r){const e=Mu(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const s=i[1];return{host:s,port:Bc(n.substr(s.length+1))}}else{const[s,a]=n.split(":");return{host:s,port:Bc(a)}}}function Bc(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function zm(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}class Uu{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return et("not implemented")}_getIdTokenResponse(e){return et("not implemented")}_linkToIdToken(e,t){return et("not implemented")}_getReauthenticationResolver(e){return et("not implemented")}}async function mn(r,e){return bu(r,"POST","/v1/accounts:signInWithIdp",Ui(r,e))}const jm="http://localhost";class Xt extends Uu{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Xt(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):it("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i,...s}=t;if(!n||!i)return null;const a=new Xt(n,i);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return mn(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,mn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,mn(e,t)}buildRequest(){const e={requestUri:jm,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Er(t)}return e}}class Fu{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Tr extends Fu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class mt extends Tr{constructor(){super("facebook.com")}static credential(e){return Xt._fromParams({providerId:mt.PROVIDER_ID,signInMethod:mt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return mt.credentialFromTaggedObject(e)}static credentialFromError(e){return mt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return mt.credential(e.oauthAccessToken)}catch{return null}}}mt.FACEBOOK_SIGN_IN_METHOD="facebook.com";mt.PROVIDER_ID="facebook.com";class gt extends Tr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Xt._fromParams({providerId:gt.PROVIDER_ID,signInMethod:gt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return gt.credentialFromTaggedObject(e)}static credentialFromError(e){return gt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return gt.credential(t,n)}catch{return null}}}gt.GOOGLE_SIGN_IN_METHOD="google.com";gt.PROVIDER_ID="google.com";class _t extends Tr{constructor(){super("github.com")}static credential(e){return Xt._fromParams({providerId:_t.PROVIDER_ID,signInMethod:_t.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _t.credentialFromTaggedObject(e)}static credentialFromError(e){return _t.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _t.credential(e.oauthAccessToken)}catch{return null}}}_t.GITHUB_SIGN_IN_METHOD="github.com";_t.PROVIDER_ID="github.com";class yt extends Tr{constructor(){super("twitter.com")}static credential(e,t){return Xt._fromParams({providerId:yt.PROVIDER_ID,signInMethod:yt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return yt.credentialFromTaggedObject(e)}static credentialFromError(e){return yt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return yt.credential(t,n)}catch{return null}}}yt.TWITTER_SIGN_IN_METHOD="twitter.com";yt.PROVIDER_ID="twitter.com";async function $m(r,e){return bu(r,"POST","/v1/accounts:signUp",Ui(r,e))}class Pt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const s=await Me._fromIdTokenResponse(e,n,i),a=qc(n);return new Pt({user:s,providerId:a,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=qc(n);return new Pt({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function qc(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}async function Hm(r){if(Le(r.app))return Promise.reject(It(r));const e=Fi(r);if(await e._initializationPromise,e.currentUser?.isAnonymous)return new Pt({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await $m(e,{returnSecureToken:!0}),n=await Pt._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(n.user),n}class wi extends Ze{constructor(e,t,n,i){super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,wi.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new wi(e,t,n,i)}}function Bu(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?wi._fromErrorAndOperation(r,s,e,n):s})}async function Wm(r,e,t=!1){const n=await fr(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return Pt._forOperation(r,"link",n)}async function Gm(r,e,t=!1){const{auth:n}=r;if(Le(n.app))return Promise.reject(It(n));const i="reauthenticate";try{const s=await fr(r,Bu(n,i,e,r),t);j(s.idToken,n,"internal-error");const a=ko(s.idToken);j(a,n,"internal-error");const{sub:c}=a;return j(r.uid===c,n,"user-mismatch"),Pt._forOperation(r,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&it(n,"user-mismatch"),s}}async function Km(r,e,t=!1){if(Le(r.app))return Promise.reject(It(r));const n="signIn",i=await Bu(r,n,e),s=await Pt._fromIdTokenResponse(r,n,i);return t||await r._updateCurrentUser(s.user),s}function Qm(r,e,t,n){return fe(r).onIdTokenChanged(e,t,n)}function Xm(r,e,t){return fe(r).beforeAuthStateChanged(e,t)}const Ti="__sak";class qu{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ti,"1"),this.storage.removeItem(Ti),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Ym=1e3,Jm=10;class zu extends qu{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Lu(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,c,l)=>{this.notifyListeners(a,l)});return}const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const a=this.storage.getItem(n);!t&&this.localCache[n]===a||this.notifyListeners(n,a)},s=this.storage.getItem(n);Sm()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Jm):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},Ym)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}zu.type="LOCAL";const Zm=zu;class ju extends qu{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ju.type="SESSION";const $u=ju;function eg(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Bi{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const n=new Bi(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,a=this.handlersMap[i];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const c=Array.from(a).map(async h=>h(t.origin,s)),l=await eg(c);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Bi.receivers=[];function xo(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}class tg{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((c,l)=>{const h=xo("",20);i.port1.start();const f=setTimeout(()=>{l(new Error("unsupported_event"))},n);a={messageChannel:i,onMessage(m){const _=m;if(_.data.eventId===h)switch(_.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(_.data.response);break;default:clearTimeout(f),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function We(){return window}function ng(r){We().location.href=r}function Hu(){return typeof We().WorkerGlobalScope<"u"&&typeof We().importScripts=="function"}async function rg(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function ig(){return navigator?.serviceWorker?.controller||null}function sg(){return Hu()?self:null}const Wu="firebaseLocalStorageDb",og=1,Ii="firebaseLocalStorage",Gu="fbase_key";class Ir{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function qi(r,e){return r.transaction([Ii],e?"readwrite":"readonly").objectStore(Ii)}function ag(){const r=indexedDB.deleteDatabase(Wu);return new Ir(r).toPromise()}function no(){const r=indexedDB.open(Wu,og);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const n=r.result;try{n.createObjectStore(Ii,{keyPath:Gu})}catch(i){t(i)}}),r.addEventListener("success",async()=>{const n=r.result;n.objectStoreNames.contains(Ii)?e(n):(n.close(),await ag(),e(await no()))})})}async function zc(r,e,t){const n=qi(r,!0).put({[Gu]:e,value:t});return new Ir(n).toPromise()}async function cg(r,e){const t=qi(r,!1).get(e),n=await new Ir(t).toPromise();return n===void 0?null:n.value}function jc(r,e){const t=qi(r,!0).delete(e);return new Ir(t).toPromise()}const lg=800,ug=3;class Ku{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await no(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>ug)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Hu()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Bi._getInstance(sg()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await rg(),!this.activeServiceWorker)return;this.sender=new tg(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||ig()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await no();return await zc(e,Ti,"1"),await jc(e,Ti),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>zc(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>cg(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>jc(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=qi(i,!1).getAll();return new Ir(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),lg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Ku.type="LOCAL";const hg=Ku;new wr(3e4,6e4);function dg(r,e){return e?tt(e):(j(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}class Oo extends Uu{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return mn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return mn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return mn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function fg(r){return Km(r.auth,new Oo(r),r.bypassAuthState)}function pg(r){const{auth:e,user:t}=r;return j(t,e,"internal-error"),Gm(t,new Oo(r),r.bypassAuthState)}async function mg(r){const{auth:e,user:t}=r;return j(t,e,"internal-error"),Wm(t,new Oo(r),r.bypassAuthState)}class Qu{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:a,type:c}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(l))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return fg;case"linkViaPopup":case"linkViaRedirect":return mg;case"reauthViaPopup":case"reauthViaRedirect":return pg;default:it(this.auth,"internal-error")}}resolve(e){st(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){st(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const gg=new wr(2e3,1e4);class dn extends Qu{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,dn.currentPopupAction&&dn.currentPopupAction.cancel(),dn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return j(e,this.auth,"internal-error"),e}async onExecution(){st(this.filter.length===1,"Popup operations only handle one event");const e=xo();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(He(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(He(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,dn.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(He(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,gg.get())};e()}}dn.currentPopupAction=null;const _g="pendingRedirect",ai=new Map;class yg extends Qu{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=ai.get(this.auth._key());if(!e){try{const n=await vg(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}ai.set(this.auth._key(),e)}return this.bypassAuthState||ai.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function vg(r,e){const t=Tg(e),n=wg(r);if(!await n._isAvailable())return!1;const i=await n._get(t)==="true";return await n._remove(t),i}function Eg(r,e){ai.set(r._key(),e)}function wg(r){return tt(r._redirectPersistence)}function Tg(r){return oi(_g,r.config.apiKey,r.name)}async function Ig(r,e,t=!1){if(Le(r.app))return Promise.reject(It(r));const n=Fi(r),i=dg(n,e),a=await new yg(n,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,e)),a}const bg=600*1e3;class Ag{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Rg(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Xu(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(He(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=bg&&this.cachedEventUids.clear(),this.cachedEventUids.has($c(e))}saveEventToCache(e){this.cachedEventUids.add($c(e)),this.lastProcessedEventTime=Date.now()}}function $c(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function Xu({type:r,error:e}){return r==="unknown"&&e?.code==="auth/no-auth-event"}function Rg(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Xu(r);default:return!1}}async function Cg(r,e={}){return Sn(r,"GET","/v1/projects",e)}const Sg=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Pg=/^https?/;async function kg(r){if(r.config.emulator)return;const{authorizedDomains:e}=await Cg(r);for(const t of e)try{if(Dg(t))return}catch{}it(r,"unauthorized-domain")}function Dg(r){const e=eo(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){const a=new URL(r);return a.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===n}if(!Pg.test(t))return!1;if(Sg.test(r))return n===r;const i=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}const Ng=new wr(3e4,6e4);function Hc(){const r=We().___jsl;if(r?.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function xg(r){return new Promise((e,t)=>{function n(){Hc(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Hc(),t(He(r,"network-request-failed"))},timeout:Ng.get()})}if(We().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(We().gapi?.load)n();else{const i=Mm("iframefcb");return We()[i]=()=>{gapi.load?n():t(He(r,"network-request-failed"))},Lm(`${Vm()}?onload=${i}`).catch(s=>t(s))}}).catch(e=>{throw ci=null,e})}let ci=null;function Og(r){return ci=ci||xg(r),ci}const Lg=new wr(5e3,15e3),Vg="__/auth/iframe",Mg="emulator/auth/iframe",Ug={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Fg=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Bg(r){const e=r.config;j(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?Po(e,Mg):`https://${r.config.authDomain}/${Vg}`,n={apiKey:e.apiKey,appName:r.name,v:en},i=Fg.get(r.config.apiHost);i&&(n.eid=i);const s=r._getFrameworks();return s.length&&(n.fw=s.join(",")),`${t}?${Er(n).slice(1)}`}async function qg(r){const e=await Og(r),t=We().gapi;return j(t,r,"internal-error"),e.open({where:document.body,url:Bg(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ug,dontclear:!0},n=>new Promise(async(i,s)=>{await n.restyle({setHideOnLeave:!1});const a=He(r,"network-request-failed"),c=We().setTimeout(()=>{s(a)},Lg.get());function l(){We().clearTimeout(c),i(n)}n.ping(l).then(l,()=>{s(a)})}))}const zg={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},jg=500,$g=600,Hg="_blank",Wg="http://localhost";class Wc{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Gg(r,e,t,n=jg,i=$g){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let c="";const l={...zg,width:n.toString(),height:i.toString(),top:s,left:a},h=be().toLowerCase();t&&(c=ku(h)?Hg:t),Su(h)&&(e=e||Wg,l.scrollbars="yes");const f=Object.entries(l).reduce((_,[T,R])=>`${_}${T}=${R},`,"");if(Cm(h)&&c!=="_self")return Kg(e||"",c),new Wc(null);const m=window.open(e||"",c,f);j(m,r,"popup-blocked");try{m.focus()}catch{}return new Wc(m)}function Kg(r,e){const t=document.createElement("a");t.href=r,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}const Qg="__/auth/handler",Xg="emulator/auth/handler",Yg=encodeURIComponent("fac");async function Gc(r,e,t,n,i,s){j(r.config.authDomain,r,"auth-domain-config-required"),j(r.config.apiKey,r,"invalid-api-key");const a={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:en,eventId:i};if(e instanceof Fu){e.setDefaultLanguage(r.languageCode),a.providerId=e.providerId||"",Xf(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,m]of Object.entries({}))a[f]=m}if(e instanceof Tr){const f=e.getScopes().filter(m=>m!=="");f.length>0&&(a.scopes=f.join(","))}r.tenantId&&(a.tid=r.tenantId);const c=a;for(const f of Object.keys(c))c[f]===void 0&&delete c[f];const l=await r._getAppCheckToken(),h=l?`#${Yg}=${encodeURIComponent(l)}`:"";return`${Jg(r)}?${Er(c).slice(1)}${h}`}function Jg({config:r}){return r.emulator?Po(r,Xg):`https://${r.authDomain}/${Qg}`}const Ms="webStorageSupport";class Zg{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=$u,this._completeRedirectFn=Ig,this._overrideRedirectResult=Eg}async _openPopup(e,t,n,i){st(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const s=await Gc(e,t,n,eo(),i);return Gg(e,s,xo())}async _openRedirect(e,t,n,i){await this._originValidation(e);const s=await Gc(e,t,n,eo(),i);return ng(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(st(s,"If manager is not set, promise should be"),s)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await qg(e),n=new Ag(e);return t.register("authEvent",i=>(j(i?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ms,{type:Ms},i=>{const s=i?.[0]?.[Ms];s!==void 0&&t(!!s),it(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=kg(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Lu()||Pu()||Do()}}const e_=Zg;var Kc="@firebase/auth",Qc="1.11.1";class t_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){j(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function n_(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function r_(r){Qt(new St("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=n.options;j(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const l={apiKey:a,authDomain:c,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Vu(r)},h=new xm(n,i,s,l);return Fm(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Qt(new St("auth-internal",e=>{const t=Fi(e.getProvider("auth").getImmediate());return(n=>new t_(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),$e(Kc,Qc,n_(r)),$e(Kc,Qc,"esm2020")}const i_=300,s_=du("authIdTokenMaxAge")||i_;let Xc=null;const o_=r=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>s_)return;const i=t?.token;Xc!==i&&(Xc=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function a_(r=Co()){const e=Mi(r,"auth");if(e.isInitialized())return e.getImmediate();const t=Um(r,{popupRedirectResolver:e_,persistence:[hg,Zm,$u]}),n=du("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(n,location.origin);if(location.origin===s.origin){const a=o_(s.toString());Xm(t,a,()=>a(t.currentUser)),Qm(t,c=>a(c))}}const i=lu("auth");return i&&Bm(t,`http://${i}`),t}function c_(){return document.getElementsByTagName("head")?.[0]??document}Om({loadJS(r){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=i=>{const s=He("internal-error");s.customData=i,t(s)},n.type="text/javascript",n.charset="UTF-8",c_().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});r_("Browser");var Yc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var bt,Yu;(function(){var r;function e(E,g){function y(){}y.prototype=g.prototype,E.F=g.prototype,E.prototype=new y,E.prototype.constructor=E,E.D=function(I,w,b){for(var v=Array(arguments.length-2),ge=2;ge<arguments.length;ge++)v[ge-2]=arguments[ge];return g.prototype[w].apply(I,v)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,t),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,g,y){y||(y=0);const I=Array(16);if(typeof g=="string")for(var w=0;w<16;++w)I[w]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(w=0;w<16;++w)I[w]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=E.g[0],y=E.g[1],w=E.g[2];let b=E.g[3],v;v=g+(b^y&(w^b))+I[0]+3614090360&4294967295,g=y+(v<<7&4294967295|v>>>25),v=b+(w^g&(y^w))+I[1]+3905402710&4294967295,b=g+(v<<12&4294967295|v>>>20),v=w+(y^b&(g^y))+I[2]+606105819&4294967295,w=b+(v<<17&4294967295|v>>>15),v=y+(g^w&(b^g))+I[3]+3250441966&4294967295,y=w+(v<<22&4294967295|v>>>10),v=g+(b^y&(w^b))+I[4]+4118548399&4294967295,g=y+(v<<7&4294967295|v>>>25),v=b+(w^g&(y^w))+I[5]+1200080426&4294967295,b=g+(v<<12&4294967295|v>>>20),v=w+(y^b&(g^y))+I[6]+2821735955&4294967295,w=b+(v<<17&4294967295|v>>>15),v=y+(g^w&(b^g))+I[7]+4249261313&4294967295,y=w+(v<<22&4294967295|v>>>10),v=g+(b^y&(w^b))+I[8]+1770035416&4294967295,g=y+(v<<7&4294967295|v>>>25),v=b+(w^g&(y^w))+I[9]+2336552879&4294967295,b=g+(v<<12&4294967295|v>>>20),v=w+(y^b&(g^y))+I[10]+4294925233&4294967295,w=b+(v<<17&4294967295|v>>>15),v=y+(g^w&(b^g))+I[11]+2304563134&4294967295,y=w+(v<<22&4294967295|v>>>10),v=g+(b^y&(w^b))+I[12]+1804603682&4294967295,g=y+(v<<7&4294967295|v>>>25),v=b+(w^g&(y^w))+I[13]+4254626195&4294967295,b=g+(v<<12&4294967295|v>>>20),v=w+(y^b&(g^y))+I[14]+2792965006&4294967295,w=b+(v<<17&4294967295|v>>>15),v=y+(g^w&(b^g))+I[15]+1236535329&4294967295,y=w+(v<<22&4294967295|v>>>10),v=g+(w^b&(y^w))+I[1]+4129170786&4294967295,g=y+(v<<5&4294967295|v>>>27),v=b+(y^w&(g^y))+I[6]+3225465664&4294967295,b=g+(v<<9&4294967295|v>>>23),v=w+(g^y&(b^g))+I[11]+643717713&4294967295,w=b+(v<<14&4294967295|v>>>18),v=y+(b^g&(w^b))+I[0]+3921069994&4294967295,y=w+(v<<20&4294967295|v>>>12),v=g+(w^b&(y^w))+I[5]+3593408605&4294967295,g=y+(v<<5&4294967295|v>>>27),v=b+(y^w&(g^y))+I[10]+38016083&4294967295,b=g+(v<<9&4294967295|v>>>23),v=w+(g^y&(b^g))+I[15]+3634488961&4294967295,w=b+(v<<14&4294967295|v>>>18),v=y+(b^g&(w^b))+I[4]+3889429448&4294967295,y=w+(v<<20&4294967295|v>>>12),v=g+(w^b&(y^w))+I[9]+568446438&4294967295,g=y+(v<<5&4294967295|v>>>27),v=b+(y^w&(g^y))+I[14]+3275163606&4294967295,b=g+(v<<9&4294967295|v>>>23),v=w+(g^y&(b^g))+I[3]+4107603335&4294967295,w=b+(v<<14&4294967295|v>>>18),v=y+(b^g&(w^b))+I[8]+1163531501&4294967295,y=w+(v<<20&4294967295|v>>>12),v=g+(w^b&(y^w))+I[13]+2850285829&4294967295,g=y+(v<<5&4294967295|v>>>27),v=b+(y^w&(g^y))+I[2]+4243563512&4294967295,b=g+(v<<9&4294967295|v>>>23),v=w+(g^y&(b^g))+I[7]+1735328473&4294967295,w=b+(v<<14&4294967295|v>>>18),v=y+(b^g&(w^b))+I[12]+2368359562&4294967295,y=w+(v<<20&4294967295|v>>>12),v=g+(y^w^b)+I[5]+4294588738&4294967295,g=y+(v<<4&4294967295|v>>>28),v=b+(g^y^w)+I[8]+2272392833&4294967295,b=g+(v<<11&4294967295|v>>>21),v=w+(b^g^y)+I[11]+1839030562&4294967295,w=b+(v<<16&4294967295|v>>>16),v=y+(w^b^g)+I[14]+4259657740&4294967295,y=w+(v<<23&4294967295|v>>>9),v=g+(y^w^b)+I[1]+2763975236&4294967295,g=y+(v<<4&4294967295|v>>>28),v=b+(g^y^w)+I[4]+1272893353&4294967295,b=g+(v<<11&4294967295|v>>>21),v=w+(b^g^y)+I[7]+4139469664&4294967295,w=b+(v<<16&4294967295|v>>>16),v=y+(w^b^g)+I[10]+3200236656&4294967295,y=w+(v<<23&4294967295|v>>>9),v=g+(y^w^b)+I[13]+681279174&4294967295,g=y+(v<<4&4294967295|v>>>28),v=b+(g^y^w)+I[0]+3936430074&4294967295,b=g+(v<<11&4294967295|v>>>21),v=w+(b^g^y)+I[3]+3572445317&4294967295,w=b+(v<<16&4294967295|v>>>16),v=y+(w^b^g)+I[6]+76029189&4294967295,y=w+(v<<23&4294967295|v>>>9),v=g+(y^w^b)+I[9]+3654602809&4294967295,g=y+(v<<4&4294967295|v>>>28),v=b+(g^y^w)+I[12]+3873151461&4294967295,b=g+(v<<11&4294967295|v>>>21),v=w+(b^g^y)+I[15]+530742520&4294967295,w=b+(v<<16&4294967295|v>>>16),v=y+(w^b^g)+I[2]+3299628645&4294967295,y=w+(v<<23&4294967295|v>>>9),v=g+(w^(y|~b))+I[0]+4096336452&4294967295,g=y+(v<<6&4294967295|v>>>26),v=b+(y^(g|~w))+I[7]+1126891415&4294967295,b=g+(v<<10&4294967295|v>>>22),v=w+(g^(b|~y))+I[14]+2878612391&4294967295,w=b+(v<<15&4294967295|v>>>17),v=y+(b^(w|~g))+I[5]+4237533241&4294967295,y=w+(v<<21&4294967295|v>>>11),v=g+(w^(y|~b))+I[12]+1700485571&4294967295,g=y+(v<<6&4294967295|v>>>26),v=b+(y^(g|~w))+I[3]+2399980690&4294967295,b=g+(v<<10&4294967295|v>>>22),v=w+(g^(b|~y))+I[10]+4293915773&4294967295,w=b+(v<<15&4294967295|v>>>17),v=y+(b^(w|~g))+I[1]+2240044497&4294967295,y=w+(v<<21&4294967295|v>>>11),v=g+(w^(y|~b))+I[8]+1873313359&4294967295,g=y+(v<<6&4294967295|v>>>26),v=b+(y^(g|~w))+I[15]+4264355552&4294967295,b=g+(v<<10&4294967295|v>>>22),v=w+(g^(b|~y))+I[6]+2734768916&4294967295,w=b+(v<<15&4294967295|v>>>17),v=y+(b^(w|~g))+I[13]+1309151649&4294967295,y=w+(v<<21&4294967295|v>>>11),v=g+(w^(y|~b))+I[4]+4149444226&4294967295,g=y+(v<<6&4294967295|v>>>26),v=b+(y^(g|~w))+I[11]+3174756917&4294967295,b=g+(v<<10&4294967295|v>>>22),v=w+(g^(b|~y))+I[2]+718787259&4294967295,w=b+(v<<15&4294967295|v>>>17),v=y+(b^(w|~g))+I[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(w+(v<<21&4294967295|v>>>11))&4294967295,E.g[2]=E.g[2]+w&4294967295,E.g[3]=E.g[3]+b&4294967295}n.prototype.v=function(E,g){g===void 0&&(g=E.length);const y=g-this.blockSize,I=this.C;let w=this.h,b=0;for(;b<g;){if(w==0)for(;b<=y;)i(this,E,b),b+=this.blockSize;if(typeof E=="string"){for(;b<g;)if(I[w++]=E.charCodeAt(b++),w==this.blockSize){i(this,I),w=0;break}}else for(;b<g;)if(I[w++]=E[b++],w==this.blockSize){i(this,I),w=0;break}}this.h=w,this.o+=g},n.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;g=this.o*8;for(var y=E.length-8;y<E.length;++y)E[y]=g&255,g/=256;for(this.v(E),E=Array(16),g=0,y=0;y<4;++y)for(let I=0;I<32;I+=8)E[g++]=this.g[y]>>>I&255;return E};function s(E,g){var y=c;return Object.prototype.hasOwnProperty.call(y,E)?y[E]:y[E]=g(E)}function a(E,g){this.h=g;const y=[];let I=!0;for(let w=E.length-1;w>=0;w--){const b=E[w]|0;I&&b==g||(y[w]=b,I=!1)}this.g=y}var c={};function l(E){return-128<=E&&E<128?s(E,function(g){return new a([g|0],g<0?-1:0)}):new a([E|0],E<0?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return m;if(E<0)return S(h(-E));const g=[];let y=1;for(let I=0;E>=y;I++)g[I]=E/y|0,y*=4294967296;return new a(g,0)}function f(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return S(f(E.substring(1),g));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=h(Math.pow(g,8));let I=m;for(let b=0;b<E.length;b+=8){var w=Math.min(8,E.length-b);const v=parseInt(E.substring(b,b+w),g);w<8?(w=h(Math.pow(g,w)),I=I.j(w).add(h(v))):(I=I.j(y),I=I.add(h(v)))}return I}var m=l(0),_=l(1),T=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-S(this).m();let E=0,g=1;for(let y=0;y<this.g.length;y++){const I=this.i(y);E+=(I>=0?I:4294967296+I)*g,g*=4294967296}return E},r.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(R(this))return"0";if(k(this))return"-"+S(this).toString(E);const g=h(Math.pow(E,6));var y=this;let I="";for(;;){const w=z(y,g).g;y=N(y,w.j(g));let b=((y.g.length>0?y.g[0]:y.h)>>>0).toString(E);if(y=w,R(y))return b+I;for(;b.length<6;)b="0"+b;I=b+I}},r.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function R(E){if(E.h!=0)return!1;for(let g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function k(E){return E.h==-1}r.l=function(E){return E=N(this,E),k(E)?-1:R(E)?0:1};function S(E){const g=E.g.length,y=[];for(let I=0;I<g;I++)y[I]=~E.g[I];return new a(y,~E.h).add(_)}r.abs=function(){return k(this)?S(this):this},r.add=function(E){const g=Math.max(this.g.length,E.g.length),y=[];let I=0;for(let w=0;w<=g;w++){let b=I+(this.i(w)&65535)+(E.i(w)&65535),v=(b>>>16)+(this.i(w)>>>16)+(E.i(w)>>>16);I=v>>>16,b&=65535,v&=65535,y[w]=v<<16|b}return new a(y,y[y.length-1]&-2147483648?-1:0)};function N(E,g){return E.add(S(g))}r.j=function(E){if(R(this)||R(E))return m;if(k(this))return k(E)?S(this).j(S(E)):S(S(this).j(E));if(k(E))return S(this.j(S(E)));if(this.l(T)<0&&E.l(T)<0)return h(this.m()*E.m());const g=this.g.length+E.g.length,y=[];for(var I=0;I<2*g;I++)y[I]=0;for(I=0;I<this.g.length;I++)for(let w=0;w<E.g.length;w++){const b=this.i(I)>>>16,v=this.i(I)&65535,ge=E.i(w)>>>16,Fe=E.i(w)&65535;y[2*I+2*w]+=v*Fe,O(y,2*I+2*w),y[2*I+2*w+1]+=b*Fe,O(y,2*I+2*w+1),y[2*I+2*w+1]+=v*ge,O(y,2*I+2*w+1),y[2*I+2*w+2]+=b*ge,O(y,2*I+2*w+2)}for(E=0;E<g;E++)y[E]=y[2*E+1]<<16|y[2*E];for(E=g;E<2*g;E++)y[E]=0;return new a(y,0)};function O(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function V(E,g){this.g=E,this.h=g}function z(E,g){if(R(g))throw Error("division by zero");if(R(E))return new V(m,m);if(k(E))return g=z(S(E),g),new V(S(g.g),S(g.h));if(k(g))return g=z(E,S(g)),new V(S(g.g),g.h);if(E.g.length>30){if(k(E)||k(g))throw Error("slowDivide_ only works with positive integers.");for(var y=_,I=g;I.l(E)<=0;)y=F(y),I=F(I);var w=M(y,1),b=M(I,1);for(I=M(I,2),y=M(y,2);!R(I);){var v=b.add(I);v.l(E)<=0&&(w=w.add(y),b=v),I=M(I,1),y=M(y,1)}return g=N(E,w.j(g)),new V(w,g)}for(w=m;E.l(g)>=0;){for(y=Math.max(1,Math.floor(E.m()/g.m())),I=Math.ceil(Math.log(y)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),b=h(y),v=b.j(g);k(v)||v.l(E)>0;)y-=I,b=h(y),v=b.j(g);R(b)&&(b=_),w=w.add(b),E=N(E,v)}return new V(w,E)}r.B=function(E){return z(this,E).h},r.and=function(E){const g=Math.max(this.g.length,E.g.length),y=[];for(let I=0;I<g;I++)y[I]=this.i(I)&E.i(I);return new a(y,this.h&E.h)},r.or=function(E){const g=Math.max(this.g.length,E.g.length),y=[];for(let I=0;I<g;I++)y[I]=this.i(I)|E.i(I);return new a(y,this.h|E.h)},r.xor=function(E){const g=Math.max(this.g.length,E.g.length),y=[];for(let I=0;I<g;I++)y[I]=this.i(I)^E.i(I);return new a(y,this.h^E.h)};function F(E){const g=E.g.length+1,y=[];for(let I=0;I<g;I++)y[I]=E.i(I)<<1|E.i(I-1)>>>31;return new a(y,E.h)}function M(E,g){const y=g>>5;g%=32;const I=E.g.length-y,w=[];for(let b=0;b<I;b++)w[b]=g>0?E.i(b+y)>>>g|E.i(b+y+1)<<32-g:E.i(b+y);return new a(w,E.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,Yu=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,bt=a}).apply(typeof Yc<"u"?Yc:typeof self<"u"?self:typeof window<"u"?window:{});var Kr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Ju,tr,Zu,li,ro,eh,th,nh;(function(){var r,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Kr=="object"&&Kr];for(var u=0;u<o.length;++u){var d=o[u];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=t(this);function i(o,u){if(u)e:{var d=n;o=o.split(".");for(var p=0;p<o.length-1;p++){var A=o[p];if(!(A in d))break e;d=d[A]}o=o[o.length-1],p=d[o],u=u(p),u!=p&&u!=null&&e(d,o,{configurable:!0,writable:!0,value:u})}}i("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(o){return o||function(u){var d=[],p;for(p in u)Object.prototype.hasOwnProperty.call(u,p)&&d.push([p,u[p]]);return d}});var s=s||{},a=this||self;function c(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function l(o,u,d){return o.call.apply(o.bind,arguments)}function h(o,u,d){return h=l,h.apply(null,arguments)}function f(o,u){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function m(o,u){function d(){}d.prototype=u.prototype,o.Z=u.prototype,o.prototype=new d,o.prototype.constructor=o,o.Ob=function(p,A,C){for(var x=Array(arguments.length-2),W=2;W<arguments.length;W++)x[W-2]=arguments[W];return u.prototype[A].apply(p,x)}}var _=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function T(o){const u=o.length;if(u>0){const d=Array(u);for(let p=0;p<u;p++)d[p]=o[p];return d}return[]}function R(o,u){for(let p=1;p<arguments.length;p++){const A=arguments[p];var d=typeof A;if(d=d!="object"?d:A?Array.isArray(A)?"array":d:"null",d=="array"||d=="object"&&typeof A.length=="number"){d=o.length||0;const C=A.length||0;o.length=d+C;for(let x=0;x<C;x++)o[d+x]=A[x]}else o.push(A)}}class k{constructor(u,d){this.i=u,this.j=d,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function S(o){a.setTimeout(()=>{throw o},0)}function N(){var o=E;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class O{constructor(){this.h=this.g=null}add(u,d){const p=V.get();p.set(u,d),this.h?this.h.next=p:this.g=p,this.h=p}}var V=new k(()=>new z,o=>o.reset());class z{constructor(){this.next=this.g=this.h=null}set(u,d){this.h=u,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let F,M=!1,E=new O,g=()=>{const o=Promise.resolve(void 0);F=()=>{o.then(y)}};function y(){for(var o;o=N();){try{o.h.call(o.g)}catch(d){S(d)}var u=V;u.j(o),u.h<100&&(u.h++,o.next=u.g,u.g=o)}M=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function w(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}w.prototype.h=function(){this.defaultPrevented=!0};var b=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};a.addEventListener("test",d,u),a.removeEventListener("test",d,u)}catch{}return o})();function v(o){return/^[\s\xa0]*$/.test(o)}function ge(o,u){w.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,u)}m(ge,w),ge.prototype.init=function(o,u){const d=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget,u||(d=="mouseover"?u=o.fromElement:d=="mouseout"&&(u=o.toElement)),this.relatedTarget=u,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&ge.Z.h.call(this)},ge.prototype.h=function(){ge.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Fe="closure_listenable_"+(Math.random()*1e6|0),os=0;function Nr(o,u,d,p,A){this.listener=o,this.proxy=null,this.src=u,this.type=d,this.capture=!!p,this.ha=A,this.key=++os,this.da=this.fa=!1}function rn(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function xr(o,u,d){for(const p in o)u.call(d,o[p],p,o)}function Wd(o,u){for(const d in o)u.call(void 0,o[d],d,o)}function Ea(o){const u={};for(const d in o)u[d]=o[d];return u}const wa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ta(o,u){let d,p;for(let A=1;A<arguments.length;A++){p=arguments[A];for(d in p)o[d]=p[d];for(let C=0;C<wa.length;C++)d=wa[C],Object.prototype.hasOwnProperty.call(p,d)&&(o[d]=p[d])}}function Or(o){this.src=o,this.g={},this.h=0}Or.prototype.add=function(o,u,d,p,A){const C=o.toString();o=this.g[C],o||(o=this.g[C]=[],this.h++);const x=cs(o,u,p,A);return x>-1?(u=o[x],d||(u.fa=!1)):(u=new Nr(u,this.src,C,!!p,A),u.fa=d,o.push(u)),u};function as(o,u){const d=u.type;if(d in o.g){var p=o.g[d],A=Array.prototype.indexOf.call(p,u,void 0),C;(C=A>=0)&&Array.prototype.splice.call(p,A,1),C&&(rn(u),o.g[d].length==0&&(delete o.g[d],o.h--))}}function cs(o,u,d,p){for(let A=0;A<o.length;++A){const C=o[A];if(!C.da&&C.listener==u&&C.capture==!!d&&C.ha==p)return A}return-1}var ls="closure_lm_"+(Math.random()*1e6|0),us={};function Ia(o,u,d,p,A){if(Array.isArray(u)){for(let C=0;C<u.length;C++)Ia(o,u[C],d,p,A);return null}return d=Ra(d),o&&o[Fe]?o.J(u,d,c(p)?!!p.capture:!1,A):Gd(o,u,d,!1,p,A)}function Gd(o,u,d,p,A,C){if(!u)throw Error("Invalid event type");const x=c(A)?!!A.capture:!!A;let W=ds(o);if(W||(o[ls]=W=new Or(o)),d=W.add(u,d,p,x,C),d.proxy)return d;if(p=Kd(),d.proxy=p,p.src=o,p.listener=d,o.addEventListener)b||(A=x),A===void 0&&(A=!1),o.addEventListener(u.toString(),p,A);else if(o.attachEvent)o.attachEvent(Aa(u.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Kd(){function o(d){return u.call(o.src,o.listener,d)}const u=Qd;return o}function ba(o,u,d,p,A){if(Array.isArray(u))for(var C=0;C<u.length;C++)ba(o,u[C],d,p,A);else p=c(p)?!!p.capture:!!p,d=Ra(d),o&&o[Fe]?(o=o.i,C=String(u).toString(),C in o.g&&(u=o.g[C],d=cs(u,d,p,A),d>-1&&(rn(u[d]),Array.prototype.splice.call(u,d,1),u.length==0&&(delete o.g[C],o.h--)))):o&&(o=ds(o))&&(u=o.g[u.toString()],o=-1,u&&(o=cs(u,d,p,A)),(d=o>-1?u[o]:null)&&hs(d))}function hs(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[Fe])as(u.i,o);else{var d=o.type,p=o.proxy;u.removeEventListener?u.removeEventListener(d,p,o.capture):u.detachEvent?u.detachEvent(Aa(d),p):u.addListener&&u.removeListener&&u.removeListener(p),(d=ds(u))?(as(d,o),d.h==0&&(d.src=null,u[ls]=null)):rn(o)}}}function Aa(o){return o in us?us[o]:us[o]="on"+o}function Qd(o,u){if(o.da)o=!0;else{u=new ge(u,this);const d=o.listener,p=o.ha||o.src;o.fa&&hs(o),o=d.call(p,u)}return o}function ds(o){return o=o[ls],o instanceof Or?o:null}var fs="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ra(o){return typeof o=="function"?o:(o[fs]||(o[fs]=function(u){return o.handleEvent(u)}),o[fs])}function Ee(){I.call(this),this.i=new Or(this),this.M=this,this.G=null}m(Ee,I),Ee.prototype[Fe]=!0,Ee.prototype.removeEventListener=function(o,u,d,p){ba(this,o,u,d,p)};function Ae(o,u){var d,p=o.G;if(p)for(d=[];p;p=p.G)d.push(p);if(o=o.M,p=u.type||u,typeof u=="string")u=new w(u,o);else if(u instanceof w)u.target=u.target||o;else{var A=u;u=new w(p,o),Ta(u,A)}A=!0;let C,x;if(d)for(x=d.length-1;x>=0;x--)C=u.g=d[x],A=Lr(C,p,!0,u)&&A;if(C=u.g=o,A=Lr(C,p,!0,u)&&A,A=Lr(C,p,!1,u)&&A,d)for(x=0;x<d.length;x++)C=u.g=d[x],A=Lr(C,p,!1,u)&&A}Ee.prototype.N=function(){if(Ee.Z.N.call(this),this.i){var o=this.i;for(const u in o.g){const d=o.g[u];for(let p=0;p<d.length;p++)rn(d[p]);delete o.g[u],o.h--}}this.G=null},Ee.prototype.J=function(o,u,d,p){return this.i.add(String(o),u,!1,d,p)},Ee.prototype.K=function(o,u,d,p){return this.i.add(String(o),u,!0,d,p)};function Lr(o,u,d,p){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();let A=!0;for(let C=0;C<u.length;++C){const x=u[C];if(x&&!x.da&&x.capture==d){const W=x.listener,le=x.ha||x.src;x.fa&&as(o.i,x),A=W.call(le,p)!==!1&&A}}return A&&!p.defaultPrevented}function Xd(o,u){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=h(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:a.setTimeout(o,u||0)}function Ca(o){o.g=Xd(()=>{o.g=null,o.i&&(o.i=!1,Ca(o))},o.l);const u=o.h;o.h=null,o.m.apply(null,u)}class Yd extends I{constructor(u,d){super(),this.m=u,this.l=d,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Ca(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function On(o){I.call(this),this.h=o,this.g={}}m(On,I);var Sa=[];function Pa(o){xr(o.g,function(u,d){this.g.hasOwnProperty(d)&&hs(u)},o),o.g={}}On.prototype.N=function(){On.Z.N.call(this),Pa(this)},On.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ps=a.JSON.stringify,Jd=a.JSON.parse,Zd=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function ka(){}function Da(){}var Ln={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ms(){w.call(this,"d")}m(ms,w);function gs(){w.call(this,"c")}m(gs,w);var Bt={},Na=null;function Vr(){return Na=Na||new Ee}Bt.Ia="serverreachability";function xa(o){w.call(this,Bt.Ia,o)}m(xa,w);function Vn(o){const u=Vr();Ae(u,new xa(u))}Bt.STAT_EVENT="statevent";function Oa(o,u){w.call(this,Bt.STAT_EVENT,o),this.stat=u}m(Oa,w);function Re(o){const u=Vr();Ae(u,new Oa(u,o))}Bt.Ja="timingevent";function La(o,u){w.call(this,Bt.Ja,o),this.size=u}m(La,w);function Mn(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},u)}function Un(){this.g=!0}Un.prototype.ua=function(){this.g=!1};function ef(o,u,d,p,A,C){o.info(function(){if(o.g)if(C){var x="",W=C.split("&");for(let J=0;J<W.length;J++){var le=W[J].split("=");if(le.length>1){const pe=le[0];le=le[1];const qe=pe.split("_");x=qe.length>=2&&qe[1]=="type"?x+(pe+"="+le+"&"):x+(pe+"=redacted&")}}}else x=null;else x=C;return"XMLHTTP REQ ("+p+") [attempt "+A+"]: "+u+`
`+d+`
`+x})}function tf(o,u,d,p,A,C,x){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+A+"]: "+u+`
`+d+`
`+C+" "+x})}function sn(o,u,d,p){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+rf(o,d)+(p?" "+p:"")})}function nf(o,u){o.info(function(){return"TIMEOUT: "+u})}Un.prototype.info=function(){};function rf(o,u){if(!o.g)return u;if(!u)return null;try{const C=JSON.parse(u);if(C){for(o=0;o<C.length;o++)if(Array.isArray(C[o])){var d=C[o];if(!(d.length<2)){var p=d[1];if(Array.isArray(p)&&!(p.length<1)){var A=p[0];if(A!="noop"&&A!="stop"&&A!="close")for(let x=1;x<p.length;x++)p[x]=""}}}}return ps(C)}catch{return u}}var Mr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Va={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ma;function _s(){}m(_s,ka),_s.prototype.g=function(){return new XMLHttpRequest},Ma=new _s;function Fn(o){return encodeURIComponent(String(o))}function sf(o){var u=1;o=o.split(":");const d=[];for(;u>0&&o.length;)d.push(o.shift()),u--;return o.length&&d.push(o.join(":")),d}function ct(o,u,d,p){this.j=o,this.i=u,this.l=d,this.S=p||1,this.V=new On(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ua}function Ua(){this.i=null,this.g="",this.h=!1}var Fa={},ys={};function vs(o,u,d){o.M=1,o.A=Fr(Be(u)),o.u=d,o.R=!0,Ba(o,null)}function Ba(o,u){o.F=Date.now(),Ur(o),o.B=Be(o.A);var d=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),Za(d.i,"t",p),o.C=0,d=o.j.L,o.h=new Ua,o.g=_c(o.j,d?u:null,!o.u),o.P>0&&(o.O=new Yd(h(o.Y,o,o.g),o.P)),u=o.V,d=o.g,p=o.ba;var A="readystatechange";Array.isArray(A)||(A&&(Sa[0]=A.toString()),A=Sa);for(let C=0;C<A.length;C++){const x=Ia(d,A[C],p||u.handleEvent,!1,u.h||u);if(!x)break;u.g[x.key]=x}u=o.J?Ea(o.J):{},o.u?(o.v||(o.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,u)):(o.v="GET",o.g.ea(o.B,o.v,null,u)),Vn(),ef(o.i,o.v,o.B,o.l,o.S,o.u)}ct.prototype.ba=function(o){o=o.target;const u=this.O;u&&ht(o)==3?u.j():this.Y(o)},ct.prototype.Y=function(o){try{if(o==this.g)e:{const W=ht(this.g),le=this.g.ya(),J=this.g.ca();if(!(W<3)&&(W!=3||this.g&&(this.h.h||this.g.la()||oc(this.g)))){this.K||W!=4||le==7||(le==8||J<=0?Vn(3):Vn(2)),Es(this);var u=this.g.ca();this.X=u;var d=of(this);if(this.o=u==200,tf(this.i,this.v,this.B,this.l,this.S,W,u),this.o){if(this.U&&!this.L){t:{if(this.g){var p,A=this.g;if((p=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!v(p)){var C=p;break t}}C=null}if(o=C)sn(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ws(this,o);else{this.o=!1,this.m=3,Re(12),qt(this),Bn(this);break e}}if(this.R){o=!0;let pe;for(;!this.K&&this.C<d.length;)if(pe=af(this,d),pe==ys){W==4&&(this.m=4,Re(14),o=!1),sn(this.i,this.l,null,"[Incomplete Response]");break}else if(pe==Fa){this.m=4,Re(15),sn(this.i,this.l,d,"[Invalid Chunk]"),o=!1;break}else sn(this.i,this.l,pe,null),ws(this,pe);if(qa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),W!=4||d.length!=0||this.h.h||(this.m=1,Re(16),o=!1),this.o=this.o&&o,!o)sn(this.i,this.l,d,"[Invalid Chunked Response]"),qt(this),Bn(this);else if(d.length>0&&!this.W){this.W=!0;var x=this.j;x.g==this&&x.aa&&!x.P&&(x.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),Ps(x),x.P=!0,Re(11))}}else sn(this.i,this.l,d,null),ws(this,d);W==4&&qt(this),this.o&&!this.K&&(W==4?fc(this.j,this):(this.o=!1,Ur(this)))}else wf(this.g),u==400&&d.indexOf("Unknown SID")>0?(this.m=3,Re(12)):(this.m=0,Re(13)),qt(this),Bn(this)}}}catch{}finally{}};function of(o){if(!qa(o))return o.g.la();const u=oc(o.g);if(u==="")return"";let d="";const p=u.length,A=ht(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return qt(o),Bn(o),"";o.h.i=new a.TextDecoder}for(let C=0;C<p;C++)o.h.h=!0,d+=o.h.i.decode(u[C],{stream:!(A&&C==p-1)});return u.length=0,o.h.g+=d,o.C=0,o.h.g}function qa(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function af(o,u){var d=o.C,p=u.indexOf(`
`,d);return p==-1?ys:(d=Number(u.substring(d,p)),isNaN(d)?Fa:(p+=1,p+d>u.length?ys:(u=u.slice(p,p+d),o.C=p+d,u)))}ct.prototype.cancel=function(){this.K=!0,qt(this)};function Ur(o){o.T=Date.now()+o.H,za(o,o.H)}function za(o,u){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Mn(h(o.aa,o),u)}function Es(o){o.D&&(a.clearTimeout(o.D),o.D=null)}ct.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(nf(this.i,this.B),this.M!=2&&(Vn(),Re(17)),qt(this),this.m=2,Bn(this)):za(this,this.T-o)};function Bn(o){o.j.I==0||o.K||fc(o.j,o)}function qt(o){Es(o);var u=o.O;u&&typeof u.dispose=="function"&&u.dispose(),o.O=null,Pa(o.V),o.g&&(u=o.g,o.g=null,u.abort(),u.dispose())}function ws(o,u){try{var d=o.j;if(d.I!=0&&(d.g==o||Ts(d.h,o))){if(!o.L&&Ts(d.h,o)&&d.I==3){try{var p=d.Ba.g.parse(u)}catch{p=null}if(Array.isArray(p)&&p.length==3){var A=p;if(A[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<o.F)$r(d),zr(d);else break e;Ss(d),Re(18)}}else d.xa=A[1],0<d.xa-d.K&&A[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=Mn(h(d.Va,d),6e3));Ha(d.h)<=1&&d.ta&&(d.ta=void 0)}else jt(d,11)}else if((o.L||d.g==o)&&$r(d),!v(u))for(A=d.Ba.g.parse(u),u=0;u<A.length;u++){let J=A[u];const pe=J[0];if(!(pe<=d.K))if(d.K=pe,J=J[1],d.I==2)if(J[0]=="c"){d.M=J[1],d.ba=J[2];const qe=J[3];qe!=null&&(d.ka=qe,d.j.info("VER="+d.ka));const $t=J[4];$t!=null&&(d.za=$t,d.j.info("SVER="+d.za));const dt=J[5];dt!=null&&typeof dt=="number"&&dt>0&&(p=1.5*dt,d.O=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;const ft=o.g;if(ft){const Wr=ft.g?ft.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Wr){var C=p.h;C.g||Wr.indexOf("spdy")==-1&&Wr.indexOf("quic")==-1&&Wr.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(Is(C,C.h),C.h=null))}if(p.G){const ks=ft.g?ft.g.getResponseHeader("X-HTTP-Session-Id"):null;ks&&(p.wa=ks,Z(p.J,p.G,ks))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-o.F,d.j.info("Handshake RTT: "+d.T+"ms")),p=d;var x=o;if(p.na=gc(p,p.L?p.ba:null,p.W),x.L){Wa(p.h,x);var W=x,le=p.O;le&&(W.H=le),W.D&&(Es(W),Ur(W)),p.g=x}else hc(p);d.i.length>0&&jr(d)}else J[0]!="stop"&&J[0]!="close"||jt(d,7);else d.I==3&&(J[0]=="stop"||J[0]=="close"?J[0]=="stop"?jt(d,7):Cs(d):J[0]!="noop"&&d.l&&d.l.qa(J),d.A=0)}}Vn(4)}catch{}}var cf=class{constructor(o,u){this.g=o,this.map=u}};function ja(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function $a(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Ha(o){return o.h?1:o.g?o.g.size:0}function Ts(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function Is(o,u){o.g?o.g.add(u):o.h=u}function Wa(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}ja.prototype.cancel=function(){if(this.i=Ga(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Ga(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let u=o.i;for(const d of o.g.values())u=u.concat(d.G);return u}return T(o.i)}var Ka=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lf(o,u){if(o){o=o.split("&");for(let d=0;d<o.length;d++){const p=o[d].indexOf("=");let A,C=null;p>=0?(A=o[d].substring(0,p),C=o[d].substring(p+1)):A=o[d],u(A,C?decodeURIComponent(C.replace(/\+/g," ")):"")}}}function lt(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;o instanceof lt?(this.l=o.l,qn(this,o.j),this.o=o.o,this.g=o.g,zn(this,o.u),this.h=o.h,bs(this,ec(o.i)),this.m=o.m):o&&(u=String(o).match(Ka))?(this.l=!1,qn(this,u[1]||"",!0),this.o=jn(u[2]||""),this.g=jn(u[3]||"",!0),zn(this,u[4]),this.h=jn(u[5]||"",!0),bs(this,u[6]||"",!0),this.m=jn(u[7]||"")):(this.l=!1,this.i=new Hn(null,this.l))}lt.prototype.toString=function(){const o=[];var u=this.j;u&&o.push($n(u,Qa,!0),":");var d=this.g;return(d||u=="file")&&(o.push("//"),(u=this.o)&&o.push($n(u,Qa,!0),"@"),o.push(Fn(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&o.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push($n(d,d.charAt(0)=="/"?df:hf,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",$n(d,pf)),o.join("")},lt.prototype.resolve=function(o){const u=Be(this);let d=!!o.j;d?qn(u,o.j):d=!!o.o,d?u.o=o.o:d=!!o.g,d?u.g=o.g:d=o.u!=null;var p=o.h;if(d)zn(u,o.u);else if(d=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var A=u.h.lastIndexOf("/");A!=-1&&(p=u.h.slice(0,A+1)+p)}if(A=p,A==".."||A==".")p="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){p=A.lastIndexOf("/",0)==0,A=A.split("/");const C=[];for(let x=0;x<A.length;){const W=A[x++];W=="."?p&&x==A.length&&C.push(""):W==".."?((C.length>1||C.length==1&&C[0]!="")&&C.pop(),p&&x==A.length&&C.push("")):(C.push(W),p=!0)}p=C.join("/")}else p=A}return d?u.h=p:d=o.i.toString()!=="",d?bs(u,ec(o.i)):d=!!o.m,d&&(u.m=o.m),u};function Be(o){return new lt(o)}function qn(o,u,d){o.j=d?jn(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function zn(o,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);o.u=u}else o.u=null}function bs(o,u,d){u instanceof Hn?(o.i=u,mf(o.i,o.l)):(d||(u=$n(u,ff)),o.i=new Hn(u,o.l))}function Z(o,u,d){o.i.set(u,d)}function Fr(o){return Z(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function jn(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function $n(o,u,d){return typeof o=="string"?(o=encodeURI(o).replace(u,uf),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function uf(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Qa=/[#\/\?@]/g,hf=/[#\?:]/g,df=/[#\?]/g,ff=/[#\?@]/g,pf=/#/g;function Hn(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function zt(o){o.g||(o.g=new Map,o.h=0,o.i&&lf(o.i,function(u,d){o.add(decodeURIComponent(u.replace(/\+/g," ")),d)}))}r=Hn.prototype,r.add=function(o,u){zt(this),this.i=null,o=on(this,o);let d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(u),this.h+=1,this};function Xa(o,u){zt(o),u=on(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function Ya(o,u){return zt(o),u=on(o,u),o.g.has(u)}r.forEach=function(o,u){zt(this),this.g.forEach(function(d,p){d.forEach(function(A){o.call(u,A,p,this)},this)},this)};function Ja(o,u){zt(o);let d=[];if(typeof u=="string")Ya(o,u)&&(d=d.concat(o.g.get(on(o,u))));else for(o=Array.from(o.g.values()),u=0;u<o.length;u++)d=d.concat(o[u]);return d}r.set=function(o,u){return zt(this),this.i=null,o=on(this,o),Ya(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},r.get=function(o,u){return o?(o=Ja(this,o),o.length>0?String(o[0]):u):u};function Za(o,u,d){Xa(o,u),d.length>0&&(o.i=null,o.g.set(on(o,u),T(d)),o.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],u=Array.from(this.g.keys());for(let p=0;p<u.length;p++){var d=u[p];const A=Fn(d);d=Ja(this,d);for(let C=0;C<d.length;C++){let x=A;d[C]!==""&&(x+="="+Fn(d[C])),o.push(x)}}return this.i=o.join("&")};function ec(o){const u=new Hn;return u.i=o.i,o.g&&(u.g=new Map(o.g),u.h=o.h),u}function on(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function mf(o,u){u&&!o.j&&(zt(o),o.i=null,o.g.forEach(function(d,p){const A=p.toLowerCase();p!=A&&(Xa(this,p),Za(this,A,d))},o)),o.j=u}function gf(o,u){const d=new Un;if(a.Image){const p=new Image;p.onload=f(ut,d,"TestLoadImage: loaded",!0,u,p),p.onerror=f(ut,d,"TestLoadImage: error",!1,u,p),p.onabort=f(ut,d,"TestLoadImage: abort",!1,u,p),p.ontimeout=f(ut,d,"TestLoadImage: timeout",!1,u,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else u(!1)}function _f(o,u){const d=new Un,p=new AbortController,A=setTimeout(()=>{p.abort(),ut(d,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:p.signal}).then(C=>{clearTimeout(A),C.ok?ut(d,"TestPingServer: ok",!0,u):ut(d,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(A),ut(d,"TestPingServer: error",!1,u)})}function ut(o,u,d,p,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),p(d)}catch{}}function yf(){this.g=new Zd}function As(o){this.i=o.Sb||null,this.h=o.ab||!1}m(As,ka),As.prototype.g=function(){return new Br(this.i,this.h)};function Br(o,u){Ee.call(this),this.H=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(Br,Ee),r=Br.prototype,r.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=u,this.readyState=1,Gn(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(u.body=o),(this.H||a).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Wn(this)),this.readyState=0},r.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Gn(this)),this.g&&(this.readyState=3,Gn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tc(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function tc(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}r.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?Wn(this):Gn(this),this.readyState==3&&tc(this)}},r.Oa=function(o){this.g&&(this.response=this.responseText=o,Wn(this))},r.Na=function(o){this.g&&(this.response=o,Wn(this))},r.ga=function(){this.g&&Wn(this)};function Wn(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Gn(o)}r.setRequestHeader=function(o,u){this.A.append(o,u)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],u=this.h.entries();for(var d=u.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=u.next();return o.join(`\r
`)};function Gn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Br.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function nc(o){let u="";return xr(o,function(d,p){u+=p,u+=":",u+=d,u+=`\r
`}),u}function Rs(o,u,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=nc(d),typeof o=="string"?d!=null&&Fn(d):Z(o,u,d))}function re(o){Ee.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(re,Ee);var vf=/^https?$/i,Ef=["POST","PUT"];r=re.prototype,r.Fa=function(o){this.H=o},r.ea=function(o,u,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ma.g(),this.g.onreadystatechange=_(h(this.Ca,this));try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(C){rc(this,C);return}if(o=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var A in p)d.set(A,p[A]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const C of p.keys())d.set(C,p.get(C));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(C=>C.toLowerCase()=="content-type"),A=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(Ef,u,void 0)>=0)||p||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[C,x]of d)this.g.setRequestHeader(C,x);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(C){rc(this,C)}};function rc(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.o=5,ic(o),qr(o)}function ic(o){o.A||(o.A=!0,Ae(o,"complete"),Ae(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,Ae(this,"complete"),Ae(this,"abort"),qr(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qr(this,!0)),re.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?sc(this):this.Xa())},r.Xa=function(){sc(this)};function sc(o){if(o.h&&typeof s<"u"){if(o.v&&ht(o)==4)setTimeout(o.Ca.bind(o),0);else if(Ae(o,"readystatechange"),ht(o)==4){o.h=!1;try{const C=o.ca();e:switch(C){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var d;if(!(d=u)){var p;if(p=C===0){let x=String(o.D).match(Ka)[1]||null;!x&&a.self&&a.self.location&&(x=a.self.location.protocol.slice(0,-1)),p=!vf.test(x?x.toLowerCase():"")}d=p}if(d)Ae(o,"complete"),Ae(o,"success");else{o.o=6;try{var A=ht(o)>2?o.g.statusText:""}catch{A=""}o.l=A+" ["+o.ca()+"]",ic(o)}}finally{qr(o)}}}}function qr(o,u){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const d=o.g;o.g=null,u||Ae(o,"ready");try{d.onreadystatechange=null}catch{}}}r.isActive=function(){return!!this.g};function ht(o){return o.g?o.g.readyState:0}r.ca=function(){try{return ht(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),Jd(u)}};function oc(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function wf(o){const u={};o=(o.g&&ht(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(v(o[p]))continue;var d=sf(o[p]);const A=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const C=u[A]||[];u[A]=C,C.push(d)}Wd(u,function(p){return p.join(", ")})}r.ya=function(){return this.o},r.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Kn(o,u,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||u}function ac(o){this.za=0,this.i=[],this.j=new Un,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Kn("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Kn("baseRetryDelayMs",5e3,o),this.Za=Kn("retryDelaySeedMs",1e4,o),this.Ta=Kn("forwardChannelMaxRetries",2,o),this.va=Kn("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new ja(o&&o.concurrentRequestLimit),this.Ba=new yf,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}r=ac.prototype,r.ka=8,r.I=1,r.connect=function(o,u,d,p){Re(0),this.W=o,this.H=u||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.J=gc(this,null,this.W),jr(this)};function Cs(o){if(cc(o),o.I==3){var u=o.V++,d=Be(o.J);if(Z(d,"SID",o.M),Z(d,"RID",u),Z(d,"TYPE","terminate"),Qn(o,d),u=new ct(o,o.j,u),u.M=2,u.A=Fr(Be(d)),d=!1,a.navigator&&a.navigator.sendBeacon)try{d=a.navigator.sendBeacon(u.A.toString(),"")}catch{}!d&&a.Image&&(new Image().src=u.A,d=!0),d||(u.g=_c(u.j,null),u.g.ea(u.A)),u.F=Date.now(),Ur(u)}mc(o)}function zr(o){o.g&&(Ps(o),o.g.cancel(),o.g=null)}function cc(o){zr(o),o.v&&(a.clearTimeout(o.v),o.v=null),$r(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function jr(o){if(!$a(o.h)&&!o.m){o.m=!0;var u=o.Ea;F||g(),M||(F(),M=!0),E.add(u,o),o.D=0}}function Tf(o,u){return Ha(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=u.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Mn(h(o.Ea,o,u),pc(o,o.D)),o.D++,!0)}r.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const A=new ct(this,this.j,o);let C=this.o;if(this.U&&(C?(C=Ea(C),Ta(C,this.U)):C=this.U),this.u!==null||this.R||(A.J=C,C=null),this.S)e:{for(var u=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(u+=p,u>4096){u=d;break e}if(u===4096||d===this.i.length-1){u=d+1;break e}}u=1e3}else u=1e3;u=uc(this,A,u),d=Be(this.J),Z(d,"RID",o),Z(d,"CVER",22),this.G&&Z(d,"X-HTTP-Session-Id",this.G),Qn(this,d),C&&(this.R?u="headers="+Fn(nc(C))+"&"+u:this.u&&Rs(d,this.u,C)),Is(this.h,A),this.Ra&&Z(d,"TYPE","init"),this.S?(Z(d,"$req",u),Z(d,"SID","null"),A.U=!0,vs(A,d,null)):vs(A,d,u),this.I=2}}else this.I==3&&(o?lc(this,o):this.i.length==0||$a(this.h)||lc(this))};function lc(o,u){var d;u?d=u.l:d=o.V++;const p=Be(o.J);Z(p,"SID",o.M),Z(p,"RID",d),Z(p,"AID",o.K),Qn(o,p),o.u&&o.o&&Rs(p,o.u,o.o),d=new ct(o,o.j,d,o.D+1),o.u===null&&(d.J=o.o),u&&(o.i=u.G.concat(o.i)),u=uc(o,d,1e3),d.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Is(o.h,d),vs(d,p,u)}function Qn(o,u){o.H&&xr(o.H,function(d,p){Z(u,p,d)}),o.l&&xr({},function(d,p){Z(u,p,d)})}function uc(o,u,d){d=Math.min(o.i.length,d);const p=o.l?h(o.l.Ka,o.l,o):null;e:{var A=o.i;let W=-1;for(;;){const le=["count="+d];W==-1?d>0?(W=A[0].g,le.push("ofs="+W)):W=0:le.push("ofs="+W);let J=!0;for(let pe=0;pe<d;pe++){var C=A[pe].g;const qe=A[pe].map;if(C-=W,C<0)W=Math.max(0,A[pe].g-100),J=!1;else try{C="req"+C+"_"||"";try{var x=qe instanceof Map?qe:Object.entries(qe);for(const[$t,dt]of x){let ft=dt;c(dt)&&(ft=ps(dt)),le.push(C+$t+"="+encodeURIComponent(ft))}}catch($t){throw le.push(C+"type="+encodeURIComponent("_badmap")),$t}}catch{p&&p(qe)}}if(J){x=le.join("&");break e}}x=void 0}return o=o.i.splice(0,d),u.G=o,x}function hc(o){if(!o.g&&!o.v){o.Y=1;var u=o.Da;F||g(),M||(F(),M=!0),E.add(u,o),o.A=0}}function Ss(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Mn(h(o.Da,o),pc(o,o.A)),o.A++,!0)}r.Da=function(){if(this.v=null,dc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Mn(h(this.Wa,this),o)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Re(10),zr(this),dc(this))};function Ps(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function dc(o){o.g=new ct(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var u=Be(o.na);Z(u,"RID","rpc"),Z(u,"SID",o.M),Z(u,"AID",o.K),Z(u,"CI",o.F?"0":"1"),!o.F&&o.ia&&Z(u,"TO",o.ia),Z(u,"TYPE","xmlhttp"),Qn(o,u),o.u&&o.o&&Rs(u,o.u,o.o),o.O&&(o.g.H=o.O);var d=o.g;o=o.ba,d.M=1,d.A=Fr(Be(u)),d.u=null,d.R=!0,Ba(d,o)}r.Va=function(){this.C!=null&&(this.C=null,zr(this),Ss(this),Re(19))};function $r(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function fc(o,u){var d=null;if(o.g==u){$r(o),Ps(o),o.g=null;var p=2}else if(Ts(o.h,u))d=u.G,Wa(o.h,u),p=1;else return;if(o.I!=0){if(u.o)if(p==1){d=u.u?u.u.length:0,u=Date.now()-u.F;var A=o.D;p=Vr(),Ae(p,new La(p,d)),jr(o)}else hc(o);else if(A=u.m,A==3||A==0&&u.X>0||!(p==1&&Tf(o,u)||p==2&&Ss(o)))switch(d&&d.length>0&&(u=o.h,u.i=u.i.concat(d)),A){case 1:jt(o,5);break;case 4:jt(o,10);break;case 3:jt(o,6);break;default:jt(o,2)}}}function pc(o,u){let d=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(d*=2),d*u}function jt(o,u){if(o.j.info("Error code "+u),u==2){var d=h(o.bb,o),p=o.Ua;const A=!p;p=new lt(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||qn(p,"https"),Fr(p),A?gf(p.toString(),d):_f(p.toString(),d)}else Re(2);o.I=0,o.l&&o.l.pa(u),mc(o),cc(o)}r.bb=function(o){o?(this.j.info("Successfully pinged google.com"),Re(2)):(this.j.info("Failed to ping google.com"),Re(1))};function mc(o){if(o.I=0,o.ja=[],o.l){const u=Ga(o.h);(u.length!=0||o.i.length!=0)&&(R(o.ja,u),R(o.ja,o.i),o.h.i.length=0,T(o.i),o.i.length=0),o.l.oa()}}function gc(o,u,d){var p=d instanceof lt?Be(d):new lt(d);if(p.g!="")u&&(p.g=u+"."+p.g),zn(p,p.u);else{var A=a.location;p=A.protocol,u=u?u+"."+A.hostname:A.hostname,A=+A.port;const C=new lt(null);p&&qn(C,p),u&&(C.g=u),A&&zn(C,A),d&&(C.h=d),p=C}return d=o.G,u=o.wa,d&&u&&Z(p,d,u),Z(p,"VER",o.ka),Qn(o,p),p}function _c(o,u,d){if(u&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Aa&&!o.ma?new re(new As({ab:d})):new re(o.ma),u.Fa(o.L),u}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function yc(){}r=yc.prototype,r.ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){};function Hr(){}Hr.prototype.g=function(o,u){return new De(o,u)};function De(o,u){Ee.call(this),this.g=new ac(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(o?o["X-WebChannel-Client-Profile"]=u.sa:o={"X-WebChannel-Client-Profile":u.sa}),this.g.U=o,(o=u&&u.Qb)&&!v(o)&&(this.g.u=o),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!v(u)&&(this.g.G=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new an(this)}m(De,Ee),De.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},De.prototype.close=function(){Cs(this.g)},De.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.v&&(d={},d.__data__=ps(o),o=d);u.i.push(new cf(u.Ya++,o)),u.I==3&&jr(u)},De.prototype.N=function(){this.g.l=null,delete this.j,Cs(this.g),delete this.g,De.Z.N.call(this)};function vc(o){ms.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(const d in u){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}m(vc,ms);function Ec(){gs.call(this),this.status=1}m(Ec,gs);function an(o){this.g=o}m(an,yc),an.prototype.ra=function(){Ae(this.g,"a")},an.prototype.qa=function(o){Ae(this.g,new vc(o))},an.prototype.pa=function(o){Ae(this.g,new Ec)},an.prototype.oa=function(){Ae(this.g,"b")},Hr.prototype.createWebChannel=Hr.prototype.g,De.prototype.send=De.prototype.o,De.prototype.open=De.prototype.m,De.prototype.close=De.prototype.close,nh=function(){return new Hr},th=function(){return Vr()},eh=Bt,ro={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Mr.NO_ERROR=0,Mr.TIMEOUT=8,Mr.HTTP_ERROR=6,li=Mr,Va.COMPLETE="complete",Zu=Va,Da.EventType=Ln,Ln.OPEN="a",Ln.CLOSE="b",Ln.ERROR="c",Ln.MESSAGE="d",Ee.prototype.listen=Ee.prototype.J,tr=Da,re.prototype.listenOnce=re.prototype.K,re.prototype.getLastError=re.prototype.Ha,re.prototype.getLastErrorCode=re.prototype.ya,re.prototype.getStatus=re.prototype.ca,re.prototype.getResponseJson=re.prototype.La,re.prototype.getResponseText=re.prototype.la,re.prototype.send=re.prototype.ea,re.prototype.setWithCredentials=re.prototype.Fa,Ju=re}).apply(typeof Kr<"u"?Kr:typeof self<"u"?self:typeof window<"u"?window:{});const Jc="@firebase/firestore",Zc="4.9.2";class Te{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Te.UNAUTHENTICATED=new Te(null),Te.GOOGLE_CREDENTIALS=new Te("google-credentials-uid"),Te.FIRST_PARTY=new Te("first-party-uid"),Te.MOCK_USER=new Te("mock-user");let Pn="12.3.0";const Yt=new Ao("@firebase/firestore");function cn(){return Yt.logLevel}function L(r,...e){if(Yt.logLevel<=G.DEBUG){const t=e.map(Lo);Yt.debug(`Firestore (${Pn}): ${r}`,...t)}}function ot(r,...e){if(Yt.logLevel<=G.ERROR){const t=e.map(Lo);Yt.error(`Firestore (${Pn}): ${r}`,...t)}}function En(r,...e){if(Yt.logLevel<=G.WARN){const t=e.map(Lo);Yt.warn(`Firestore (${Pn}): ${r}`,...t)}}function Lo(r){if(typeof r=="string")return r;try{return(function(t){return JSON.stringify(t)})(r)}catch{return r}}function q(r,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,rh(r,n,t)}function rh(r,e,t){let n=`FIRESTORE (${Pn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw ot(n),new Error(n)}function Y(r,e,t,n){let i="Unexpected state";typeof t=="string"?i=t:n=t,r||rh(e,i,n)}function H(r,e){return r}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class U extends Ze{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class At{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class ih{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class l_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Te.UNAUTHENTICATED)))}shutdown(){}}class u_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class h_{constructor(e){this.t=e,this.currentUser=Te.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Y(this.o===void 0,42304);let n=this.i;const i=l=>this.i!==n?(n=this.i,t(l)):Promise.resolve();let s=new At;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new At,e.enqueueRetryable((()=>i(this.currentUser)))};const a=()=>{const l=s;e.enqueueRetryable((async()=>{await l.promise,await i(this.currentUser)}))},c=l=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((l=>c(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?c(l):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new At)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((n=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(Y(typeof n.accessToken=="string",31837,{l:n}),new ih(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Y(e===null||typeof e=="string",2055,{h:e}),new Te(e)}}class d_{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Te.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class f_{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new d_(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Te.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class el{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class p_{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Le(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Y(this.o===void 0,3512);const n=s=>{s.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,L("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable((()=>n(s)))};const i=s=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>i(s))),setTimeout((()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new el(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Y(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new el(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function m_(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class Vo{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const i=m_(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%62))}return n}}function K(r,e){return r<e?-1:r>e?1:0}function io(r,e){const t=Math.min(r.length,e.length);for(let n=0;n<t;n++){const i=r.charAt(n),s=e.charAt(n);if(i!==s)return Us(i)===Us(s)?K(i,s):Us(i)?1:-1}return K(r.length,e.length)}const g_=55296,__=57343;function Us(r){const e=r.charCodeAt(0);return e>=g_&&e<=__}function wn(r,e,t){return r.length===e.length&&r.every(((n,i)=>t(n,e[i])))}const tl="__name__";class ze{constructor(e,t,n){t===void 0?t=0:t>e.length&&q(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&q(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return ze.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ze?e.forEach((n=>{t.push(n)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=ze.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return K(e.length,t.length)}static compareSegments(e,t){const n=ze.isNumericId(e),i=ze.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?ze.extractNumericId(e).compare(ze.extractNumericId(t)):io(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return bt.fromString(e.substring(4,e.length-2))}}class ee extends ze{construct(e,t,n){return new ee(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new U(D.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((i=>i.length>0)))}return new ee(t)}static emptyPath(){return new ee([])}}const y_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ye extends ze{construct(e,t,n){return new ye(e,t,n)}static isValidIdentifier(e){return y_.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ye.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===tl}static keyField(){return new ye([tl])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(n.length===0)throw new U(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const c=e[i];if(c==="\\"){if(i+1===e.length)throw new U(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new U(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=l,i+=2}else c==="`"?(a=!a,i++):c!=="."||a?(n+=c,i++):(s(),i++)}if(s(),a)throw new U(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ye(t)}static emptyPath(){return new ye([])}}class B{constructor(e){this.path=e}static fromPath(e){return new B(ee.fromString(e))}static fromName(e){return new B(ee.fromString(e).popFirst(5))}static empty(){return new B(ee.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ee.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ee.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new B(new ee(e.slice()))}}function sh(r,e,t){if(!t)throw new U(D.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function v_(r,e,t,n){if(e===!0&&n===!0)throw new U(D.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function nl(r){if(!B.isDocumentKey(r))throw new U(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function rl(r){if(B.isDocumentKey(r))throw new U(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function oh(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function Mo(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":q(12329,{type:typeof r})}function kt(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new U(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Mo(r);throw new U(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function ce(r,e){const t={typeString:r};return e&&(t.value=e),t}function br(r,e){if(!oh(r))throw new U(D.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const i=e[n].typeString,s="value"in e[n]?{value:e[n].value}:void 0;if(!(n in r)){t=`JSON missing required field: '${n}'`;break}const a=r[n];if(i&&typeof a!==i){t=`JSON field '${n}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${n}' field to equal '${s.value}'`;break}}if(t)throw new U(D.INVALID_ARGUMENT,t);return!0}const il=-62135596800,sl=1e6;class te{static now(){return te.fromMillis(Date.now())}static fromDate(e){return te.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*sl);return new te(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new U(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new U(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<il)throw new U(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new U(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/sl}_compareTo(e){return this.seconds===e.seconds?K(this.nanoseconds,e.nanoseconds):K(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:te._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(br(e,te._jsonSchema))return new te(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-il;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}te._jsonSchemaVersion="firestore/timestamp/1.0",te._jsonSchema={type:ce("string",te._jsonSchemaVersion),seconds:ce("number"),nanoseconds:ce("number")};class ${static fromTimestamp(e){return new $(e)}static min(){return new $(new te(0,0))}static max(){return new $(new te(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const pr=-1;function E_(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=$.fromTimestamp(n===1e9?new te(t+1,0):new te(t,n));return new Dt(i,B.empty(),e)}function w_(r){return new Dt(r.readTime,r.key,pr)}class Dt{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Dt($.min(),B.empty(),pr)}static max(){return new Dt($.max(),B.empty(),pr)}}function T_(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=B.comparator(r.documentKey,e.documentKey),t!==0?t:K(r.largestBatchId,e.largestBatchId))}const I_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class b_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function kn(r){if(r.code!==D.FAILED_PRECONDITION||r.message!==I_)throw r;L("LocalStore","Unexpectedly lost primary lease")}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&q(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P(((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):P.reject(t)}static resolve(e){return new P(((t,n)=>{t(e)}))}static reject(e){return new P(((t,n)=>{n(e)}))}static waitFor(e){return new P(((t,n)=>{let i=0,s=0,a=!1;e.forEach((c=>{++i,c.next((()=>{++s,a&&s===i&&t()}),(l=>n(l)))})),a=!0,s===i&&t()}))}static or(e){let t=P.resolve(!1);for(const n of e)t=t.next((i=>i?P.resolve(i):n()));return t}static forEach(e,t){const n=[];return e.forEach(((i,s)=>{n.push(t.call(this,i,s))})),this.waitFor(n)}static mapArray(e,t){return new P(((n,i)=>{const s=e.length,a=new Array(s);let c=0;for(let l=0;l<s;l++){const h=l;t(e[h]).next((f=>{a[h]=f,++c,c===s&&n(a)}),(f=>i(f)))}}))}static doWhile(e,t){return new P(((n,i)=>{const s=()=>{e()===!0?t().next((()=>{s()}),i):n()};s()}))}}function A_(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Dn(r){return r.name==="IndexedDbTransactionError"}class zi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}zi.ce=-1;const Uo=-1;function ji(r){return r==null}function bi(r){return r===0&&1/r==-1/0}function R_(r){return typeof r=="number"&&Number.isInteger(r)&&!bi(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}const ah="";function C_(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=ol(e)),e=S_(r.get(t),e);return ol(e)}function S_(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="";break;case ah:t+="";break;default:t+=s}}return t}function ol(r){return r+ah+""}function al(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Ut(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function ch(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class ne{constructor(e,t){this.comparator=e,this.root=t||_e.EMPTY}insert(e,t){return new ne(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,_e.BLACK,null,null))}remove(e){return new ne(this.comparator,this.root.remove(e,this.comparator).copy(null,null,_e.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Qr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Qr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Qr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Qr(this.root,e,this.comparator,!0)}}class Qr{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class _e{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??_e.RED,this.left=i??_e.EMPTY,this.right=s??_e.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new _e(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return _e.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return _e.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,_e.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,_e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw q(43730,{key:this.key,value:this.value});if(this.right.isRed())throw q(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw q(27949);return e+(this.isRed()?0:1)}}_e.EMPTY=null,_e.RED=!0,_e.BLACK=!1;_e.EMPTY=new class{constructor(){this.size=0}get key(){throw q(57766)}get value(){throw q(16141)}get color(){throw q(16727)}get left(){throw q(29726)}get right(){throw q(36894)}copy(e,t,n,i,s){return this}insert(e,t,n){return new _e(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class de{constructor(e){this.comparator=e,this.data=new ne(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new cl(this.data.getIterator())}getIteratorFrom(e){return new cl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((n=>{t=t.add(n)})),t}isEqual(e){if(!(e instanceof de)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new de(this.comparator);return t.data=e,t}}class cl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class xe{constructor(e){this.fields=e,e.sort(ye.comparator)}static empty(){return new xe([])}unionWith(e){let t=new de(ye.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new xe(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return wn(this.fields,e.fields,((t,n)=>t.isEqual(n)))}}class lh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ve{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new lh("Invalid base64 string: "+s):s}})(e);return new ve(t)}static fromUint8Array(e){const t=(function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s})(e);return new ve(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return K(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ve.EMPTY_BYTE_STRING=new ve("");const P_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nt(r){if(Y(!!r,39018),typeof r=="string"){let e=0;const t=P_.exec(r);if(Y(!!t,46558,{timestamp:r}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:oe(r.seconds),nanos:oe(r.nanos)}}function oe(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function xt(r){return typeof r=="string"?ve.fromBase64String(r):ve.fromUint8Array(r)}const uh="server_timestamp",hh="__type__",dh="__previous_value__",fh="__local_write_time__";function Fo(r){return(r?.mapValue?.fields||{})[hh]?.stringValue===uh}function $i(r){const e=r.mapValue.fields[dh];return Fo(e)?$i(e):e}function mr(r){const e=Nt(r.mapValue.fields[fh].timestampValue);return new te(e.seconds,e.nanos)}class k_{constructor(e,t,n,i,s,a,c,l,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=h,this.isUsingEmulator=f}}const Ai="(default)";class gr{constructor(e,t){this.projectId=e,this.database=t||Ai}static empty(){return new gr("","")}get isDefaultDatabase(){return this.database===Ai}isEqual(e){return e instanceof gr&&e.projectId===this.projectId&&e.database===this.database}}const ph="__type__",D_="__max__",Xr={mapValue:{}},mh="__vector__",Ri="value";function Ot(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Fo(r)?4:x_(r)?9007199254740991:N_(r)?10:11:q(28295,{value:r})}function Ye(r,e){if(r===e)return!0;const t=Ot(r);if(t!==Ot(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return mr(r).isEqual(mr(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=Nt(i.timestampValue),c=Nt(s.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos})(r,e);case 5:return r.stringValue===e.stringValue;case 6:return(function(i,s){return xt(i.bytesValue).isEqual(xt(s.bytesValue))})(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return(function(i,s){return oe(i.geoPointValue.latitude)===oe(s.geoPointValue.latitude)&&oe(i.geoPointValue.longitude)===oe(s.geoPointValue.longitude)})(r,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return oe(i.integerValue)===oe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=oe(i.doubleValue),c=oe(s.doubleValue);return a===c?bi(a)===bi(c):isNaN(a)&&isNaN(c)}return!1})(r,e);case 9:return wn(r.arrayValue.values||[],e.arrayValue.values||[],Ye);case 10:case 11:return(function(i,s){const a=i.mapValue.fields||{},c=s.mapValue.fields||{};if(al(a)!==al(c))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(c[l]===void 0||!Ye(a[l],c[l])))return!1;return!0})(r,e);default:return q(52216,{left:r})}}function _r(r,e){return(r.values||[]).find((t=>Ye(t,e)))!==void 0}function Tn(r,e){if(r===e)return 0;const t=Ot(r),n=Ot(e);if(t!==n)return K(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return K(r.booleanValue,e.booleanValue);case 2:return(function(s,a){const c=oe(s.integerValue||s.doubleValue),l=oe(a.integerValue||a.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1})(r,e);case 3:return ll(r.timestampValue,e.timestampValue);case 4:return ll(mr(r),mr(e));case 5:return io(r.stringValue,e.stringValue);case 6:return(function(s,a){const c=xt(s),l=xt(a);return c.compareTo(l)})(r.bytesValue,e.bytesValue);case 7:return(function(s,a){const c=s.split("/"),l=a.split("/");for(let h=0;h<c.length&&h<l.length;h++){const f=K(c[h],l[h]);if(f!==0)return f}return K(c.length,l.length)})(r.referenceValue,e.referenceValue);case 8:return(function(s,a){const c=K(oe(s.latitude),oe(a.latitude));return c!==0?c:K(oe(s.longitude),oe(a.longitude))})(r.geoPointValue,e.geoPointValue);case 9:return ul(r.arrayValue,e.arrayValue);case 10:return(function(s,a){const c=s.fields||{},l=a.fields||{},h=c[Ri]?.arrayValue,f=l[Ri]?.arrayValue,m=K(h?.values?.length||0,f?.values?.length||0);return m!==0?m:ul(h,f)})(r.mapValue,e.mapValue);case 11:return(function(s,a){if(s===Xr.mapValue&&a===Xr.mapValue)return 0;if(s===Xr.mapValue)return 1;if(a===Xr.mapValue)return-1;const c=s.fields||{},l=Object.keys(c),h=a.fields||{},f=Object.keys(h);l.sort(),f.sort();for(let m=0;m<l.length&&m<f.length;++m){const _=io(l[m],f[m]);if(_!==0)return _;const T=Tn(c[l[m]],h[f[m]]);if(T!==0)return T}return K(l.length,f.length)})(r.mapValue,e.mapValue);default:throw q(23264,{he:t})}}function ll(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return K(r,e);const t=Nt(r),n=Nt(e),i=K(t.seconds,n.seconds);return i!==0?i:K(t.nanos,n.nanos)}function ul(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const s=Tn(t[i],n[i]);if(s)return s}return K(t.length,n.length)}function In(r){return so(r)}function so(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(t){const n=Nt(t);return`time(${n.seconds},${n.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(t){return xt(t).toBase64()})(r.bytesValue):"referenceValue"in r?(function(t){return B.fromName(t).toString()})(r.referenceValue):"geoPointValue"in r?(function(t){return`geo(${t.latitude},${t.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=so(s);return n+"]"})(r.arrayValue):"mapValue"in r?(function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of n)s?s=!1:i+=",",i+=`${a}:${so(t.fields[a])}`;return i+"}"})(r.mapValue):q(61005,{value:r})}function ui(r){switch(Ot(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=$i(r);return e?16+ui(e):16;case 5:return 2*r.stringValue.length;case 6:return xt(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((i,s)=>i+ui(s)),0)})(r.arrayValue);case 10:case 11:return(function(n){let i=0;return Ut(n.fields,((s,a)=>{i+=s.length+ui(a)})),i})(r.mapValue);default:throw q(13486,{value:r})}}function oo(r){return!!r&&"integerValue"in r}function Bo(r){return!!r&&"arrayValue"in r}function hl(r){return!!r&&"nullValue"in r}function dl(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function hi(r){return!!r&&"mapValue"in r}function N_(r){return(r?.mapValue?.fields||{})[ph]?.stringValue===mh}function ar(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const e={mapValue:{fields:{}}};return Ut(r.mapValue.fields,((t,n)=>e.mapValue.fields[t]=ar(n))),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ar(r.arrayValue.values[t]);return e}return{...r}}function x_(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===D_}class ke{constructor(e){this.value=e}static empty(){return new ke({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!hi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ar(t)}setAll(e){let t=ye.emptyPath(),n={},i=[];e.forEach(((a,c)=>{if(!t.isImmediateParentOf(c)){const l=this.getFieldsMap(t);this.applyChanges(l,n,i),n={},i=[],t=c.popLast()}a?n[c.lastSegment()]=ar(a):i.push(c.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());hi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ye(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];hi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Ut(t,((i,s)=>e[i]=s));for(const i of n)delete e[i]}clone(){return new ke(ar(this.value))}}function gh(r){const e=[];return Ut(r.fields,((t,n)=>{const i=new ye([t]);if(hi(n)){const s=gh(n.mapValue).fields;if(s.length===0)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)})),new xe(e)}class Ie{constructor(e,t,n,i,s,a,c){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=c}static newInvalidDocument(e){return new Ie(e,0,$.min(),$.min(),$.min(),ke.empty(),0)}static newFoundDocument(e,t,n,i){return new Ie(e,1,t,$.min(),n,i,0)}static newNoDocument(e,t){return new Ie(e,2,t,$.min(),$.min(),ke.empty(),0)}static newUnknownDocument(e,t){return new Ie(e,3,t,$.min(),$.min(),ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ie&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ie(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ci{constructor(e,t){this.position=e,this.inclusive=t}}function fl(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],a=r.position[i];if(s.field.isKeyField()?n=B.comparator(B.fromName(a.referenceValue),t.key):n=Tn(a,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function pl(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Ye(r.position[t],e.position[t]))return!1;return!0}class Si{constructor(e,t="asc"){this.field=e,this.dir=t}}function O_(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class _h{}class ue extends _h{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new V_(e,t,n):t==="array-contains"?new F_(e,n):t==="in"?new B_(e,n):t==="not-in"?new q_(e,n):t==="array-contains-any"?new z_(e,n):new ue(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new M_(e,n):new U_(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Tn(t,this.value)):t!==null&&Ot(this.value)===Ot(t)&&this.matchesComparison(Tn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return q(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Je extends _h{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Je(e,t)}matches(e){return yh(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function yh(r){return r.op==="and"}function vh(r){return L_(r)&&yh(r)}function L_(r){for(const e of r.filters)if(e instanceof Je)return!1;return!0}function ao(r){if(r instanceof ue)return r.field.canonicalString()+r.op.toString()+In(r.value);if(vh(r))return r.filters.map((e=>ao(e))).join(",");{const e=r.filters.map((t=>ao(t))).join(",");return`${r.op}(${e})`}}function Eh(r,e){return r instanceof ue?(function(n,i){return i instanceof ue&&n.op===i.op&&n.field.isEqual(i.field)&&Ye(n.value,i.value)})(r,e):r instanceof Je?(function(n,i){return i instanceof Je&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce(((s,a,c)=>s&&Eh(a,i.filters[c])),!0):!1})(r,e):void q(19439)}function wh(r){return r instanceof ue?(function(t){return`${t.field.canonicalString()} ${t.op} ${In(t.value)}`})(r):r instanceof Je?(function(t){return t.op.toString()+" {"+t.getFilters().map(wh).join(" ,")+"}"})(r):"Filter"}class V_ extends ue{constructor(e,t,n){super(e,t,n),this.key=B.fromName(n.referenceValue)}matches(e){const t=B.comparator(e.key,this.key);return this.matchesComparison(t)}}class M_ extends ue{constructor(e,t){super(e,"in",t),this.keys=Th("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class U_ extends ue{constructor(e,t){super(e,"not-in",t),this.keys=Th("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Th(r,e){return(e.arrayValue?.values||[]).map((t=>B.fromName(t.referenceValue)))}class F_ extends ue{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Bo(t)&&_r(t.arrayValue,this.value)}}class B_ extends ue{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&_r(this.value.arrayValue,t)}}class q_ extends ue{constructor(e,t){super(e,"not-in",t)}matches(e){if(_r(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!_r(this.value.arrayValue,t)}}class z_ extends ue{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Bo(t)||!t.arrayValue.values)&&t.arrayValue.values.some((n=>_r(this.value.arrayValue,n)))}}class j_{constructor(e,t=null,n=[],i=[],s=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=c,this.Te=null}}function ml(r,e=null,t=[],n=[],i=null,s=null,a=null){return new j_(r,e,t,n,i,s,a)}function qo(r){const e=H(r);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((n=>ao(n))).join(","),t+="|ob:",t+=e.orderBy.map((n=>(function(s){return s.field.canonicalString()+s.dir})(n))).join(","),ji(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((n=>In(n))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((n=>In(n))).join(",")),e.Te=t}return e.Te}function zo(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!O_(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Eh(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!pl(r.startAt,e.startAt)&&pl(r.endAt,e.endAt)}function co(r){return B.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}class Hi{constructor(e,t=null,n=[],i=[],s=null,a="F",c=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=c,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function $_(r,e,t,n,i,s,a,c){return new Hi(r,e,t,n,i,s,a,c)}function Ih(r){return new Hi(r)}function gl(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function H_(r){return r.collectionGroup!==null}function cr(r){const e=H(r);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new de(ye.comparator);return a.filters.forEach((l=>{l.getFlattenedFilters().forEach((h=>{h.isInequality()&&(c=c.add(h.field))}))})),c})(e).forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new Si(s,n))})),t.has(ye.keyField().canonicalString())||e.Ie.push(new Si(ye.keyField(),n))}return e.Ie}function Ge(r){const e=H(r);return e.Ee||(e.Ee=W_(e,cr(r))),e.Ee}function W_(r,e){if(r.limitType==="F")return ml(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map((i=>{const s=i.dir==="desc"?"asc":"desc";return new Si(i.field,s)}));const t=r.endAt?new Ci(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Ci(r.startAt.position,r.startAt.inclusive):null;return ml(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function lo(r,e,t){return new Hi(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Wi(r,e){return zo(Ge(r),Ge(e))&&r.limitType===e.limitType}function bh(r){return`${qo(Ge(r))}|lt:${r.limitType}`}function ln(r){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map((i=>wh(i))).join(", ")}]`),ji(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map((i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i))).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((i=>In(i))).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((i=>In(i))).join(",")),`Target(${n})`})(Ge(r))}; limitType=${r.limitType})`}function Gi(r,e){return e.isFoundDocument()&&(function(n,i){const s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):B.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)})(r,e)&&(function(n,i){for(const s of cr(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(r,e)&&(function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0})(r,e)&&(function(n,i){return!(n.startAt&&!(function(a,c,l){const h=fl(a,c,l);return a.inclusive?h<=0:h<0})(n.startAt,cr(n),i)||n.endAt&&!(function(a,c,l){const h=fl(a,c,l);return a.inclusive?h>=0:h>0})(n.endAt,cr(n),i))})(r,e)}function G_(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Ah(r){return(e,t)=>{let n=!1;for(const i of cr(r)){const s=K_(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function K_(r,e,t){const n=r.field.isKeyField()?B.comparator(e.key,t.key):(function(s,a,c){const l=a.data.field(s),h=c.data.field(s);return l!==null&&h!==null?Tn(l,h):q(42886)})(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return q(19790,{direction:r.dir})}}class tn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ut(this.inner,((t,n)=>{for(const[i,s]of n)e(i,s)}))}isEmpty(){return ch(this.inner)}size(){return this.innerSize}}const Q_=new ne(B.comparator);function at(){return Q_}const Rh=new ne(B.comparator);function nr(...r){let e=Rh;for(const t of r)e=e.insert(t.key,t);return e}function Ch(r){let e=Rh;return r.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Gt(){return lr()}function Sh(){return lr()}function lr(){return new tn((r=>r.toString()),((r,e)=>r.isEqual(e)))}const X_=new ne(B.comparator),Y_=new de(B.comparator);function Q(...r){let e=Y_;for(const t of r)e=e.add(t);return e}const J_=new de(K);function Z_(){return J_}function jo(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bi(e)?"-0":e}}function Ph(r){return{integerValue:""+r}}function ey(r,e){return R_(e)?Ph(e):jo(r,e)}class Ki{constructor(){this._=void 0}}function ty(r,e,t){return r instanceof Pi?(function(i,s){const a={fields:{[hh]:{stringValue:uh},[fh]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Fo(s)&&(s=$i(s)),s&&(a.fields[dh]=s),{mapValue:a}})(t,e):r instanceof bn?Dh(r,e):r instanceof An?Nh(r,e):(function(i,s){const a=kh(i,s),c=_l(a)+_l(i.Ae);return oo(a)&&oo(i.Ae)?Ph(c):jo(i.serializer,c)})(r,e)}function ny(r,e,t){return r instanceof bn?Dh(r,e):r instanceof An?Nh(r,e):t}function kh(r,e){return r instanceof ki?(function(n){return oo(n)||(function(s){return!!s&&"doubleValue"in s})(n)})(e)?e:{integerValue:0}:null}class Pi extends Ki{}class bn extends Ki{constructor(e){super(),this.elements=e}}function Dh(r,e){const t=xh(e);for(const n of r.elements)t.some((i=>Ye(i,n)))||t.push(n);return{arrayValue:{values:t}}}class An extends Ki{constructor(e){super(),this.elements=e}}function Nh(r,e){let t=xh(e);for(const n of r.elements)t=t.filter((i=>!Ye(i,n)));return{arrayValue:{values:t}}}class ki extends Ki{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function _l(r){return oe(r.integerValue||r.doubleValue)}function xh(r){return Bo(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class Oh{constructor(e,t){this.field=e,this.transform=t}}function ry(r,e){return r.field.isEqual(e.field)&&(function(n,i){return n instanceof bn&&i instanceof bn||n instanceof An&&i instanceof An?wn(n.elements,i.elements,Ye):n instanceof ki&&i instanceof ki?Ye(n.Ae,i.Ae):n instanceof Pi&&i instanceof Pi})(r.transform,e.transform)}class iy{constructor(e,t){this.version=e,this.transformResults=t}}class Ue{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ue}static exists(e){return new Ue(void 0,e)}static updateTime(e){return new Ue(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function di(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class Qi{}function Lh(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new $o(r.key,Ue.none()):new Ar(r.key,r.data,Ue.none());{const t=r.data,n=ke.empty();let i=new de(ye.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new Ft(r.key,n,new xe(i.toArray()),Ue.none())}}function sy(r,e,t){r instanceof Ar?(function(i,s,a){const c=i.value.clone(),l=vl(i.fieldTransforms,s,a.transformResults);c.setAll(l),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(r,e,t):r instanceof Ft?(function(i,s,a){if(!di(i.precondition,s))return void s.convertToUnknownDocument(a.version);const c=vl(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(Vh(i)),l.setAll(c),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(r,e,t):(function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function ur(r,e,t,n){return r instanceof Ar?(function(s,a,c,l){if(!di(s.precondition,a))return c;const h=s.value.clone(),f=El(s.fieldTransforms,l,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null})(r,e,t,n):r instanceof Ft?(function(s,a,c,l){if(!di(s.precondition,a))return c;const h=El(s.fieldTransforms,l,a),f=a.data;return f.setAll(Vh(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((m=>m.field)))})(r,e,t,n):(function(s,a,c){return di(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c})(r,e,t)}function oy(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=kh(n.transform,i||null);s!=null&&(t===null&&(t=ke.empty()),t.set(n.field,s))}return t||null}function yl(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!(function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&wn(n,i,((s,a)=>ry(s,a)))})(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class Ar extends Qi{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ft extends Qi{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Vh(r){const e=new Map;return r.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}})),e}function vl(r,e,t){const n=new Map;Y(r.length===t.length,32656,{Re:t.length,Ve:r.length});for(let i=0;i<t.length;i++){const s=r[i],a=s.transform,c=e.data.field(s.field);n.set(s.field,ny(a,c,t[i]))}return n}function El(r,e,t){const n=new Map;for(const i of r){const s=i.transform,a=t.data.field(i.field);n.set(i.field,ty(s,a,e))}return n}class $o extends Qi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ay extends Qi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class cy{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&sy(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ur(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ur(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Sh();return this.mutations.forEach((i=>{const s=e.get(i.key),a=s.overlayedDocument;let c=this.applyToLocalView(a,s.mutatedFields);c=t.has(i.key)?null:c;const l=Lh(a,c);l!==null&&n.set(i.key,l),a.isValidDocument()||a.convertToNoDocument($.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Q())}isEqual(e){return this.batchId===e.batchId&&wn(this.mutations,e.mutations,((t,n)=>yl(t,n)))&&wn(this.baseMutations,e.baseMutations,((t,n)=>yl(t,n)))}}class Ho{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){Y(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let i=(function(){return X_})();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new Ho(e,t,n,i)}}class ly{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class uy{constructor(e,t){this.count=e,this.unchangedNames=t}}var ae,X;function hy(r){switch(r){case D.OK:return q(64938);case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0;default:return q(15467,{code:r})}}function Mh(r){if(r===void 0)return ot("GRPC error has no .code"),D.UNKNOWN;switch(r){case ae.OK:return D.OK;case ae.CANCELLED:return D.CANCELLED;case ae.UNKNOWN:return D.UNKNOWN;case ae.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case ae.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case ae.INTERNAL:return D.INTERNAL;case ae.UNAVAILABLE:return D.UNAVAILABLE;case ae.UNAUTHENTICATED:return D.UNAUTHENTICATED;case ae.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case ae.NOT_FOUND:return D.NOT_FOUND;case ae.ALREADY_EXISTS:return D.ALREADY_EXISTS;case ae.PERMISSION_DENIED:return D.PERMISSION_DENIED;case ae.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case ae.ABORTED:return D.ABORTED;case ae.OUT_OF_RANGE:return D.OUT_OF_RANGE;case ae.UNIMPLEMENTED:return D.UNIMPLEMENTED;case ae.DATA_LOSS:return D.DATA_LOSS;default:return q(39323,{code:r})}}(X=ae||(ae={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";function dy(){return new TextEncoder}const fy=new bt([4294967295,4294967295],0);function wl(r){const e=dy().encode(r),t=new Yu;return t.update(e),new Uint8Array(t.digest())}function Tl(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new bt([t,n],0),new bt([i,s],0)]}class Wo{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new rr(`Invalid padding: ${t}`);if(n<0)throw new rr(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new rr(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new rr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=bt.fromNumber(this.ge)}ye(e,t,n){let i=e.add(t.multiply(bt.fromNumber(n)));return i.compare(fy)===1&&(i=new bt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=wl(e),[n,i]=Tl(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(n,i,s);if(!this.we(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new Wo(s,i,t);return n.forEach((c=>a.insert(c))),a}insert(e){if(this.ge===0)return;const t=wl(e),[n,i]=Tl(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(n,i,s);this.Se(a)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class rr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Xi{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Rr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Xi($.min(),i,new ne(K),at(),Q())}}class Rr{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Rr(n,t,Q(),Q(),Q())}}class fi{constructor(e,t,n,i){this.be=e,this.removedTargetIds=t,this.key=n,this.De=i}}class Uh{constructor(e,t){this.targetId=e,this.Ce=t}}class Fh{constructor(e,t,n=ve.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class Il{constructor(){this.ve=0,this.Fe=bl(),this.Me=ve.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Q(),t=Q(),n=Q();return this.Fe.forEach(((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:q(38017,{changeType:s})}})),new Rr(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=bl()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Y(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class py{constructor(e){this.Ge=e,this.ze=new Map,this.je=at(),this.Je=Yr(),this.He=Yr(),this.Ye=new ne(K)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:q(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((n,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,n=e.Ce.count,i=this.ot(t);if(i){const s=i.target;if(co(s))if(n===0){const a=new B(s.path);this.et(t,a,Ie.newNoDocument(a,$.min()))}else Y(n===1,20013,{expectedCount:n});else{const a=this._t(t);if(a!==n){const c=this.ut(e),l=c?this.ct(c,e,a):1;if(l!==0){this.it(t);const h=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let a,c;try{a=xt(n).toUint8Array()}catch(l){if(l instanceof lh)return En("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new Wo(a,i,s)}catch(l){return En(l instanceof rr?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.ge===0?null:c}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let i=0;return n.forEach((s=>{const a=this.Ge.ht(),c=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.et(t,s,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((s,a)=>{const c=this.ot(a);if(c){if(s.current&&co(c.target)){const l=new B(c.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,Ie.newNoDocument(l,e))}s.Be&&(t.set(a,s.ke()),s.qe())}}));let n=Q();this.He.forEach(((s,a)=>{let c=!0;a.forEachWhile((l=>{const h=this.ot(l);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(n=n.add(s))})),this.je.forEach(((s,a)=>a.setReadTime(e)));const i=new Xi(e,t,this.Ye,this.je,n);return this.je=at(),this.Je=Yr(),this.He=Yr(),this.Ye=new ne(K),i}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Il,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new de(K),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new de(K),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Il),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Yr(){return new ne(B.comparator)}function bl(){return new ne(B.comparator)}const my={asc:"ASCENDING",desc:"DESCENDING"},gy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_y={and:"AND",or:"OR"};class yy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function uo(r,e){return r.useProto3Json||ji(e)?e:{value:e}}function Di(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Bh(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function vy(r,e){return Di(r,e.toTimestamp())}function Ke(r){return Y(!!r,49232),$.fromTimestamp((function(t){const n=Nt(t);return new te(n.seconds,n.nanos)})(r))}function Go(r,e){return ho(r,e).canonicalString()}function ho(r,e){const t=(function(i){return new ee(["projects",i.projectId,"databases",i.database])})(r).child("documents");return e===void 0?t:t.child(e)}function qh(r){const e=ee.fromString(r);return Y(Wh(e),10190,{key:e.toString()}),e}function fo(r,e){return Go(r.databaseId,e.path)}function Fs(r,e){const t=qh(e);if(t.get(1)!==r.databaseId.projectId)throw new U(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new U(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new B(jh(t))}function zh(r,e){return Go(r.databaseId,e)}function Ey(r){const e=qh(r);return e.length===4?ee.emptyPath():jh(e)}function po(r){return new ee(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function jh(r){return Y(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function Al(r,e,t){return{name:fo(r,e),fields:t.value.mapValue.fields}}function wy(r,e){let t;if("targetChange"in e){e.targetChange;const n=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:q(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(h,f){return h.useProto3Json?(Y(f===void 0||typeof f=="string",58123),ve.fromBase64String(f||"")):(Y(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),ve.fromUint8Array(f||new Uint8Array))})(r,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&(function(h){const f=h.code===void 0?D.UNKNOWN:Mh(h.code);return new U(f,h.message||"")})(a);t=new Fh(n,i,s,c||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const i=Fs(r,n.document.name),s=Ke(n.document.updateTime),a=n.document.createTime?Ke(n.document.createTime):$.min(),c=new ke({mapValue:{fields:n.document.fields}}),l=Ie.newFoundDocument(i,s,a,c),h=n.targetIds||[],f=n.removedTargetIds||[];t=new fi(h,f,l.key,l)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const i=Fs(r,n.document),s=n.readTime?Ke(n.readTime):$.min(),a=Ie.newNoDocument(i,s),c=n.removedTargetIds||[];t=new fi([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const i=Fs(r,n.document),s=n.removedTargetIds||[];t=new fi([],s,i,null)}else{if(!("filter"in e))return q(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:i=0,unchangedNames:s}=n,a=new uy(i,s),c=n.targetId;t=new Uh(c,a)}}return t}function Ty(r,e){let t;if(e instanceof Ar)t={update:Al(r,e.key,e.value)};else if(e instanceof $o)t={delete:fo(r,e.key)};else if(e instanceof Ft)t={update:Al(r,e.key,e.data),updateMask:Dy(e.fieldMask)};else{if(!(e instanceof ay))return q(16599,{Vt:e.type});t={verify:fo(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((n=>(function(s,a){const c=a.transform;if(c instanceof Pi)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof bn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof An)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof ki)return{fieldPath:a.field.canonicalString(),increment:c.Ae};throw q(20930,{transform:a.transform})})(0,n)))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:vy(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:q(27497)})(r,e.precondition)),t}function Iy(r,e){return r&&r.length>0?(Y(e!==void 0,14353),r.map((t=>(function(i,s){let a=i.updateTime?Ke(i.updateTime):Ke(s);return a.isEqual($.min())&&(a=Ke(s)),new iy(a,i.transformResults||[])})(t,e)))):[]}function by(r,e){return{documents:[zh(r,e.path)]}}function Ay(r,e){const t={structuredQuery:{}},n=e.path;let i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=zh(r,i);const s=(function(h){if(h.length!==0)return Hh(Je.create(h,"and"))})(e.filters);s&&(t.structuredQuery.where=s);const a=(function(h){if(h.length!==0)return h.map((f=>(function(_){return{field:un(_.field),direction:Sy(_.dir)}})(f)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const c=uo(r,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function Ry(r){let e=Ey(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){Y(n===1,65062);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=(function(m){const _=$h(m);return _ instanceof Je&&vh(_)?_.getFilters():[_]})(t.where));let a=[];t.orderBy&&(a=(function(m){return m.map((_=>(function(R){return new Si(hn(R.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(R.direction))})(_)))})(t.orderBy));let c=null;t.limit&&(c=(function(m){let _;return _=typeof m=="object"?m.value:m,ji(_)?null:_})(t.limit));let l=null;t.startAt&&(l=(function(m){const _=!!m.before,T=m.values||[];return new Ci(T,_)})(t.startAt));let h=null;return t.endAt&&(h=(function(m){const _=!m.before,T=m.values||[];return new Ci(T,_)})(t.endAt)),$_(e,i,a,s,c,"F",l,h)}function Cy(r,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return q(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function $h(r){return r.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=hn(t.unaryFilter.field);return ue.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=hn(t.unaryFilter.field);return ue.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=hn(t.unaryFilter.field);return ue.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=hn(t.unaryFilter.field);return ue.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return q(61313);default:return q(60726)}})(r):r.fieldFilter!==void 0?(function(t){return ue.create(hn(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return q(58110);default:return q(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(t){return Je.create(t.compositeFilter.filters.map((n=>$h(n))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return q(1026)}})(t.compositeFilter.op))})(r):q(30097,{filter:r})}function Sy(r){return my[r]}function Py(r){return gy[r]}function ky(r){return _y[r]}function un(r){return{fieldPath:r.canonicalString()}}function hn(r){return ye.fromServerFormat(r.fieldPath)}function Hh(r){return r instanceof ue?(function(t){if(t.op==="=="){if(dl(t.value))return{unaryFilter:{field:un(t.field),op:"IS_NAN"}};if(hl(t.value))return{unaryFilter:{field:un(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(dl(t.value))return{unaryFilter:{field:un(t.field),op:"IS_NOT_NAN"}};if(hl(t.value))return{unaryFilter:{field:un(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:un(t.field),op:Py(t.op),value:t.value}}})(r):r instanceof Je?(function(t){const n=t.getFilters().map((i=>Hh(i)));return n.length===1?n[0]:{compositeFilter:{op:ky(t.op),filters:n}}})(r):q(54877,{filter:r})}function Dy(r){const e=[];return r.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Wh(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}class Et{constructor(e,t,n,i,s=$.min(),a=$.min(),c=ve.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(e){return new Et(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Et(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Et(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Et(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ny{constructor(e){this.yt=e}}function xy(r){const e=Ry({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?lo(e,e.limit,"L"):e}class Oy{constructor(){this.Cn=new Ly}addToCollectionParentIndex(e,t){return this.Cn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Dt.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Dt.min())}updateCollectionGroup(e,t,n){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class Ly{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new de(ee.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new de(ee.comparator)).toArray()}}const Rl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Gh=41943040;class Pe{static withCacheSize(e){return new Pe(e,Pe.DEFAULT_COLLECTION_PERCENTILE,Pe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Pe.DEFAULT_COLLECTION_PERCENTILE=10,Pe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pe.DEFAULT=new Pe(Gh,Pe.DEFAULT_COLLECTION_PERCENTILE,Pe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pe.DISABLED=new Pe(-1,0,0);class Rn{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Rn(0)}static cr(){return new Rn(-1)}}const Cl="LruGarbageCollector",Vy=1048576;function Sl([r,e],[t,n]){const i=K(r,t);return i===0?K(e,n):i}class My{constructor(e){this.Ir=e,this.buffer=new de(Sl),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Sl(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Uy{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){L(Cl,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Dn(t)?L(Cl,"Ignoring IndexedDB error during garbage collection: ",t):await kn(t)}await this.Vr(3e5)}))}}class Fy{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((n=>Math.floor(t/100*n)))}nthSequenceNumber(e,t){if(t===0)return P.resolve(zi.ce);const n=new My(t);return this.mr.forEachTarget(e,(i=>n.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>n.Ar(i))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Rl)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Rl):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,i,s,a,c,l,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,a=Date.now(),this.nthSequenceNumber(e,i)))).next((m=>(n=m,c=Date.now(),this.removeTargets(e,n,t)))).next((m=>(s=m,l=Date.now(),this.removeOrphanedDocuments(e,n)))).next((m=>(h=Date.now(),cn()<=G.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(c-a)+`ms
	Removed ${s} targets in `+(l-c)+`ms
	Removed ${m} documents in `+(h-l)+`ms
Total Duration: ${h-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m}))))}}function By(r,e){return new Fy(r,e)}class qy{constructor(){this.changes=new tn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ie.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?P.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class zy{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class jy{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(n=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(n!==null&&ur(n.mutation,i,xe.empty(),te.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.getLocalViewOfDocuments(e,n,Q()).next((()=>n))))}getLocalViewOfDocuments(e,t,n=Q()){const i=Gt();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,n).next((s=>{let a=nr();return s.forEach(((c,l)=>{a=a.insert(c,l.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const n=Gt();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Q())))}populateOverlays(e,t,n){const i=[];return n.forEach((s=>{t.has(s)||i.push(s)})),this.documentOverlayCache.getOverlays(e,i).next((s=>{s.forEach(((a,c)=>{t.set(a,c)}))}))}computeViews(e,t,n,i){let s=at();const a=lr(),c=(function(){return lr()})();return t.forEach(((l,h)=>{const f=n.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof Ft)?s=s.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),ur(f.mutation,h,f.mutation.getFieldMask(),te.now())):a.set(h.key,xe.empty())})),this.recalculateAndSaveOverlays(e,s).next((l=>(l.forEach(((h,f)=>a.set(h,f))),t.forEach(((h,f)=>c.set(h,new zy(f,a.get(h)??null)))),c)))}recalculateAndSaveOverlays(e,t){const n=lr();let i=new ne(((a,c)=>a-c)),s=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const c of a)c.keys().forEach((l=>{const h=t.get(l);if(h===null)return;let f=n.get(l)||xe.empty();f=c.applyToLocalView(h,f),n.set(l,f);const m=(i.get(c.batchId)||Q()).add(l);i=i.insert(c.batchId,m)}))})).next((()=>{const a=[],c=i.getReverseIterator();for(;c.hasNext();){const l=c.getNext(),h=l.key,f=l.value,m=Sh();f.forEach((_=>{if(!s.has(_)){const T=Lh(t.get(_),n.get(_));T!==null&&m.set(_,T),s=s.add(_)}})),a.push(this.documentOverlayCache.saveOverlays(e,h,m))}return P.waitFor(a)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.recalculateAndSaveOverlays(e,n)))}getDocumentsMatchingQuery(e,t,n,i){return(function(a){return B.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):H_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next((s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):P.resolve(Gt());let c=pr,l=s;return a.next((h=>P.forEach(h,((f,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),s.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next((_=>{l=l.insert(f,_)}))))).next((()=>this.populateOverlays(e,h,s))).next((()=>this.computeViews(e,l,h,Q()))).next((f=>({batchId:c,changes:Ch(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new B(t)).next((n=>{let i=nr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let a=nr();return this.indexManager.getCollectionParents(e,s).next((c=>P.forEach(c,(l=>{const h=(function(m,_){return new Hi(_,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next((f=>{f.forEach(((m,_)=>{a=a.insert(m,_)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i)))).next((a=>{s.forEach(((l,h)=>{const f=h.getKey();a.get(f)===null&&(a=a.insert(f,Ie.newInvalidDocument(f)))}));let c=nr();return a.forEach(((l,h)=>{const f=s.get(l);f!==void 0&&ur(f.mutation,h,xe.empty(),te.now()),Gi(t,h)&&(c=c.insert(l,h))})),c}))}}class $y{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return P.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Ke(i.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:xy(i.bundledQuery),readTime:Ke(i.readTime)}})(t)),P.resolve()}}class Hy{constructor(){this.overlays=new ne(B.comparator),this.qr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Gt();return P.forEach(t,(i=>this.getOverlay(e,i).next((s=>{s!==null&&n.set(i,s)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((i,s)=>{this.St(e,t,s)})),P.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.qr.get(n);return i!==void 0&&(i.forEach((s=>this.overlays=this.overlays.remove(s))),this.qr.delete(n)),P.resolve()}getOverlaysForCollection(e,t,n){const i=Gt(),s=t.length+1,a=new B(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const l=c.getNext().value,h=l.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&l.largestBatchId>n&&i.set(l.getKey(),l)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new ne(((h,f)=>h-f));const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);f===null&&(f=Gt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const c=Gt(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((h,f)=>c.set(h,f))),!(c.size()>=i)););return P.resolve(c)}St(e,t,n){const i=this.overlays.get(n.key);if(i!==null){const a=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new ly(t,n));let s=this.qr.get(t);s===void 0&&(s=Q(),this.qr.set(t,s)),this.qr.set(t,s.add(n.key))}}class Wy{constructor(){this.sessionToken=ve.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}class Ko{constructor(){this.Qr=new de(me.$r),this.Ur=new de(me.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new me(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((n=>this.addReference(n,t)))}removeReference(e,t){this.Gr(new me(e,t))}zr(e,t){e.forEach((n=>this.removeReference(n,t)))}jr(e){const t=new B(new ee([])),n=new me(t,e),i=new me(t,e+1),s=[];return this.Ur.forEachInRange([n,i],(a=>{this.Gr(a),s.push(a.key)})),s}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new B(new ee([])),n=new me(t,e),i=new me(t,e+1);let s=Q();return this.Ur.forEachInRange([n,i],(a=>{s=s.add(a.key)})),s}containsKey(e){const t=new me(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class me{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return B.comparator(e.key,t.key)||K(e.Yr,t.Yr)}static Kr(e,t){return K(e.Yr,t.Yr)||B.comparator(e.key,t.key)}}class Gy{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new de(me.$r)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new cy(s,t,n,i);this.mutationQueue.push(a);for(const c of i)this.Zr=this.Zr.add(new me(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.ei(n),s=i<0?0:i;return P.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?Uo:this.tr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new me(t,0),i=new me(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,i],(a=>{const c=this.Xr(a.Yr);s.push(c)})),P.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new de(K);return t.forEach((i=>{const s=new me(i,0),a=new me(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,a],(c=>{n=n.add(c.Yr)}))})),P.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;B.isDocumentKey(s)||(s=s.child(""));const a=new me(new B(s),0);let c=new de(K);return this.Zr.forEachWhile((l=>{const h=l.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(c=c.add(l.Yr)),!0)}),a),P.resolve(this.ti(c))}ti(e){const t=[];return e.forEach((n=>{const i=this.Xr(n);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){Y(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return P.forEach(t.mutations,(i=>{const s=new me(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){const n=new me(t,0),i=this.Zr.firstAfterOrEqual(n);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ky{constructor(e){this.ri=e,this.docs=(function(){return new ne(B.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return P.resolve(n?n.document.mutableCopy():Ie.newInvalidDocument(t))}getEntries(e,t){let n=at();return t.forEach((i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():Ie.newInvalidDocument(i))})),P.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=at();const a=t.path,c=new B(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){const{key:h,value:{document:f}}=l.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||T_(w_(f),n)<=0||(i.has(f.key)||Gi(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return P.resolve(s)}getAllFromCollectionGroup(e,t,n,i){q(9500)}ii(e,t){return P.forEach(this.docs,(n=>t(n)))}newChangeBuffer(e){return new Qy(this)}getSize(e){return P.resolve(this.size)}}class Qy extends qy{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(n)})),P.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Xy{constructor(e){this.persistence=e,this.si=new tn((t=>qo(t)),zo),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.oi=0,this._i=new Ko,this.targetCount=0,this.ai=Rn.ur()}forEachTarget(e,t){return this.si.forEach(((n,i)=>t(i))),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),P.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Rn(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Pr(t),P.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.si.forEach(((a,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.si.delete(a),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)})),P.waitFor(s).next((()=>i))}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return P.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),P.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach((a=>{s.push(i.markPotentiallyOrphaned(e,a))})),P.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return P.resolve(n)}containsKey(e,t){return P.resolve(this._i.containsKey(t))}}class Kh{constructor(e,t){this.ui={},this.overlays={},this.ci=new zi(0),this.li=!1,this.li=!0,this.hi=new Wy,this.referenceDelegate=e(this),this.Pi=new Xy(this),this.indexManager=new Oy,this.remoteDocumentCache=(function(i){return new Ky(i)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new Ny(t),this.Ii=new $y(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Hy,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new Gy(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){L("MemoryPersistence","Starting transaction:",e);const i=new Yy(this.ci.next());return this.referenceDelegate.Ei(),n(i).next((s=>this.referenceDelegate.di(i).next((()=>s)))).toPromise().then((s=>(i.raiseOnCommittedEvent(),s)))}Ai(e,t){return P.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}}class Yy extends b_{constructor(e){super(),this.currentSequenceNumber=e}}class Qo{constructor(e){this.persistence=e,this.Ri=new Ko,this.Vi=null}static mi(e){return new Qo(e)}get fi(){if(this.Vi)return this.Vi;throw q(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),P.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((s=>this.fi.add(s.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.fi,(n=>{const i=B.fromPath(n);return this.gi(e,i).next((s=>{s||t.removeEntry(i,$.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Ni{constructor(e,t){this.persistence=e,this.pi=new tn((n=>C_(n.path)),((n,i)=>n.isEqual(i))),this.garbageCollector=By(this,t)}static mi(e,t){return new Ni(e,t)}Ei(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((n=>t.next((i=>n+i))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}pr(e,t){return P.forEach(this.pi,((n,i)=>this.br(e,n,i).next((s=>s?P.resolve():t(i)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(e,(a=>this.br(e,a,t).next((c=>{c||(n++,s.removeEntry(a,$.min()))})))).next((()=>s.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),P.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ui(e.data.value)),t}br(e,t,n){return P.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return P.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Xo{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=i}static As(e,t){let n=Q(),i=Q();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Xo(e,t.fromCache,n,i)}}class Jy{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Zy{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return $f()?8:A_(be())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.ys(e,t).next((a=>{s.result=a})).next((()=>{if(!s.result)return this.ws(e,t,i,n).next((a=>{s.result=a}))})).next((()=>{if(s.result)return;const a=new Jy;return this.Ss(e,t,a).next((c=>{if(s.result=c,this.Vs)return this.bs(e,t,a,c.size)}))})).next((()=>s.result))}bs(e,t,n,i){return n.documentReadCount<this.fs?(cn()<=G.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",ln(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),P.resolve()):(cn()<=G.DEBUG&&L("QueryEngine","Query:",ln(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(cn()<=G.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",ln(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ge(t))):P.resolve())}ys(e,t){if(gl(t))return P.resolve(null);let n=Ge(t);return this.indexManager.getIndexType(e,n).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=lo(t,null,"F"),n=Ge(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((s=>{const a=Q(...s);return this.ps.getDocuments(e,a).next((c=>this.indexManager.getMinOffset(e,n).next((l=>{const h=this.Ds(t,c);return this.Cs(t,h,a,l.readTime)?this.ys(e,lo(t,null,"F")):this.vs(e,h,t,l)}))))})))))}ws(e,t,n,i){return gl(t)||i.isEqual($.min())?P.resolve(null):this.ps.getDocuments(e,n).next((s=>{const a=this.Ds(t,s);return this.Cs(t,a,n,i)?P.resolve(null):(cn()<=G.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ln(t)),this.vs(e,a,t,E_(i,pr)).next((c=>c)))}))}Ds(e,t){let n=new de(Ah(e));return t.forEach(((i,s)=>{Gi(e,s)&&(n=n.add(s))})),n}Cs(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,t,n){return cn()<=G.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",ln(t)),this.ps.getDocumentsMatchingQuery(e,t,Dt.min(),n)}vs(e,t,n,i){return this.ps.getDocumentsMatchingQuery(e,n,i).next((s=>(t.forEach((a=>{s=s.insert(a.key,a)})),s)))}}const Yo="LocalStore",ev=3e8;class tv{constructor(e,t,n,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new ne(K),this.xs=new tn((s=>qo(s)),zo),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new jy(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function nv(r,e,t,n){return new tv(r,e,t,n)}async function Qh(r,e){const t=H(r);return await t.persistence.runTransaction("Handle user change","readonly",(n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next((s=>(i=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(n)))).next((s=>{const a=[],c=[];let l=Q();for(const h of i){a.push(h.batchId);for(const f of h.mutations)l=l.add(f.key)}for(const h of s){c.push(h.batchId);for(const f of h.mutations)l=l.add(f.key)}return t.localDocuments.getDocuments(n,l).next((h=>({Ls:h,removedBatchIds:a,addedBatchIds:c})))}))}))}function rv(r,e){const t=H(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const i=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,l,h,f){const m=h.batch,_=m.keys();let T=P.resolve();return _.forEach((R=>{T=T.next((()=>f.getEntry(l,R))).next((k=>{const S=h.docVersions.get(R);Y(S!==null,48541),k.version.compareTo(S)<0&&(m.applyToRemoteDocument(k,h),k.isValidDocument()&&(k.setReadTime(h.commitVersion),f.addEntry(k)))}))})),T.next((()=>c.mutationQueue.removeMutationBatch(l,m)))})(t,n,e,s).next((()=>s.apply(n))).next((()=>t.mutationQueue.performConsistencyCheck(n))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(c){let l=Q();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(l=l.add(c.batch.mutations[h].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(n,i)))}))}function Xh(r){const e=H(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function iv(r,e){const t=H(r),n=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const c=[];e.targetChanges.forEach(((f,m)=>{const _=i.get(m);if(!_)return;c.push(t.Pi.removeMatchingKeys(s,f.removedDocuments,m).next((()=>t.Pi.addMatchingKeys(s,f.addedDocuments,m))));let T=_.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?T=T.withResumeToken(ve.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):f.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(f.resumeToken,n)),i=i.insert(m,T),(function(k,S,N){return k.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=ev?!0:N.addedDocuments.size+N.modifiedDocuments.size+N.removedDocuments.size>0})(_,T,f)&&c.push(t.Pi.updateTargetData(s,T))}));let l=at(),h=Q();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))})),c.push(sv(s,a,e.documentUpdates).next((f=>{l=f.ks,h=f.qs}))),!n.isEqual($.min())){const f=t.Pi.getLastRemoteSnapshotVersion(s).next((m=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,n)));c.push(f)}return P.waitFor(c).next((()=>a.apply(s))).next((()=>t.localDocuments.getLocalViewOfDocuments(s,l,h))).next((()=>l))})).then((s=>(t.Ms=i,s)))}function sv(r,e,t){let n=Q(),i=Q();return t.forEach((s=>n=n.add(s))),e.getEntries(r,n).next((s=>{let a=at();return t.forEach(((c,l)=>{const h=s.get(c);l.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(c)),l.isNoDocument()&&l.version.isEqual($.min())?(e.removeEntry(c,l.readTime),a=a.insert(c,l)):!h.isValidDocument()||l.version.compareTo(h.version)>0||l.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(l),a=a.insert(c,l)):L(Yo,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",l.version)})),{ks:a,qs:i}}))}function ov(r,e){const t=H(r);return t.persistence.runTransaction("Get next mutation batch","readonly",(n=>(e===void 0&&(e=Uo),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e))))}function av(r,e){const t=H(r);return t.persistence.runTransaction("Allocate target","readwrite",(n=>{let i;return t.Pi.getTargetData(n,e).next((s=>s?(i=s,P.resolve(i)):t.Pi.allocateTargetId(n).next((a=>(i=new Et(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,i).next((()=>i)))))))})).then((n=>{const i=t.Ms.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n}))}async function mo(r,e,t){const n=H(r),i=n.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",s,(a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Dn(a))throw a;L(Yo,`Failed to update sequence numbers for target ${e}: ${a}`)}n.Ms=n.Ms.remove(e),n.xs.delete(i.target)}function Pl(r,e,t){const n=H(r);let i=$.min(),s=Q();return n.persistence.runTransaction("Execute query","readwrite",(a=>(function(l,h,f){const m=H(l),_=m.xs.get(f);return _!==void 0?P.resolve(m.Ms.get(_)):m.Pi.getTargetData(h,f)})(n,a,Ge(e)).next((c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(a,c.targetId).next((l=>{s=l}))})).next((()=>n.Fs.getDocumentsMatchingQuery(a,e,t?i:$.min(),t?s:Q()))).next((c=>(cv(n,G_(e),c),{documents:c,Qs:s})))))}function cv(r,e,t){let n=r.Os.get(e)||$.min();t.forEach(((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)})),r.Os.set(e,n)}class kl{constructor(){this.activeTargetIds=Z_()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class lv{constructor(){this.Mo=new kl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new kl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class uv{Oo(e){}shutdown(){}}const Dl="ConnectivityMonitor";class Nl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){L(Dl,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){L(Dl,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Jr=null;function go(){return Jr===null?Jr=(function(){return 268435456+Math.round(2147483648*Math.random())})():Jr++,"0x"+Jr.toString(16)}const Bs="RestConnection",hv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class dv{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${i}`,this.Wo=this.databaseId.database===Ai?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Go(e,t,n,i,s){const a=go(),c=this.zo(e,t.toUriEncodedString());L(Bs,`Sending RPC '${e}' ${a}:`,c,n);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,i,s);const{host:h}=new URL(c),f=Mt(h);return this.Jo(e,c,l,n,f).then((m=>(L(Bs,`Received RPC '${e}' ${a}: `,m),m)),(m=>{throw En(Bs,`RPC '${e}' ${a} failed with error: `,m,"url: ",c,"request:",n),m}))}Ho(e,t,n,i,s,a){return this.Go(e,t,n,i,s)}jo(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Pn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,s)=>e[s]=i)),n&&n.headers.forEach(((i,s)=>e[s]=i))}zo(e,t){const n=hv[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class fv{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const we="WebChannelConnection";class pv extends dv{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,s){const a=go();return new Promise(((c,l)=>{const h=new Ju;h.setWithCredentials(!0),h.listenOnce(Zu.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case li.NO_ERROR:const m=h.getResponseJson();L(we,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),c(m);break;case li.TIMEOUT:L(we,`RPC '${e}' ${a} timed out`),l(new U(D.DEADLINE_EXCEEDED,"Request time out"));break;case li.HTTP_ERROR:const _=h.getStatus();if(L(we,`RPC '${e}' ${a} failed with status:`,_,"response text:",h.getResponseText()),_>0){let T=h.getResponseJson();Array.isArray(T)&&(T=T[0]);const R=T?.error;if(R&&R.status&&R.message){const k=(function(N){const O=N.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(O)>=0?O:D.UNKNOWN})(R.status);l(new U(k,R.message))}else l(new U(D.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new U(D.UNAVAILABLE,"Connection failed."));break;default:q(9055,{l_:e,streamId:a,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{L(we,`RPC '${e}' ${a} completed.`)}}));const f=JSON.stringify(i);L(we,`RPC '${e}' ${a} sending request:`,i),h.send(t,"POST",f,n,15)}))}T_(e,t,n){const i=go(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=nh(),c=th(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(l.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;const f=s.join("");L(we,`Creating RPC '${e}' stream ${i}: ${f}`,l);const m=a.createWebChannel(f,l);this.I_(m);let _=!1,T=!1;const R=new fv({Yo:S=>{T?L(we,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(_||(L(we,`Opening RPC '${e}' stream ${i} transport.`),m.open(),_=!0),L(we,`RPC '${e}' stream ${i} sending:`,S),m.send(S))},Zo:()=>m.close()}),k=(S,N,O)=>{S.listen(N,(V=>{try{O(V)}catch(z){setTimeout((()=>{throw z}),0)}}))};return k(m,tr.EventType.OPEN,(()=>{T||(L(we,`RPC '${e}' stream ${i} transport opened.`),R.o_())})),k(m,tr.EventType.CLOSE,(()=>{T||(T=!0,L(we,`RPC '${e}' stream ${i} transport closed`),R.a_(),this.E_(m))})),k(m,tr.EventType.ERROR,(S=>{T||(T=!0,En(we,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),R.a_(new U(D.UNAVAILABLE,"The operation could not be completed")))})),k(m,tr.EventType.MESSAGE,(S=>{if(!T){const N=S.data[0];Y(!!N,16349);const O=N,V=O?.error||O[0]?.error;if(V){L(we,`RPC '${e}' stream ${i} received error:`,V);const z=V.status;let F=(function(g){const y=ae[g];if(y!==void 0)return Mh(y)})(z),M=V.message;F===void 0&&(F=D.INTERNAL,M="Unknown error status: "+z+" with message "+V.message),T=!0,R.a_(new U(F,M)),m.close()}else L(we,`RPC '${e}' stream ${i} received:`,N),R.u_(N)}})),k(c,eh.STAT_EVENT,(S=>{S.stat===ro.PROXY?L(we,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===ro.NOPROXY&&L(we,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{R.__()}),0),R}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function qs(){return typeof document<"u"?document:null}function Yi(r){return new yy(r,!0)}class Yh{constructor(e,t,n=1e3,i=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-n);i>0&&L("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const xl="PersistentStream";class Jh{constructor(e,t,n,i,s,a,c,l){this.Mi=e,this.S_=n,this.b_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Yh(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(ot(t.toString()),ot("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,i])=>{this.D_===t&&this.G_(n,i)}),(n=>{e((()=>{const i=new U(D.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(i)}))}))}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{n((()=>this.z_(i)))})),this.stream.onMessage((i=>{n((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return L(xl,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(L(xl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class mv extends Jh{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=wy(this.serializer,e),n=(function(s){if(!("targetChange"in s))return $.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?$.min():a.readTime?Ke(a.readTime):$.min()})(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=po(this.serializer),t.addTarget=(function(s,a){let c;const l=a.target;if(c=co(l)?{documents:by(s,l)}:{query:Ay(s,l).ft},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Bh(s,a.resumeToken);const h=uo(s,a.expectedCount);h!==null&&(c.expectedCount=h)}else if(a.snapshotVersion.compareTo($.min())>0){c.readTime=Di(s,a.snapshotVersion.toTimestamp());const h=uo(s,a.expectedCount);h!==null&&(c.expectedCount=h)}return c})(this.serializer,e);const n=Cy(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=po(this.serializer),t.removeTarget=e,this.q_(t)}}class gv extends Jh{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Y(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Y(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Y(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Iy(e.writeResults,e.commitTime),n=Ke(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=po(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((n=>Ty(this.serializer,n)))};this.q_(t)}}class _v{}class yv extends _v{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new U(D.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,a])=>this.connection.Go(e,ho(t,n),i,s,a))).catch((s=>{throw s.name==="FirebaseError"?(s.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new U(D.UNKNOWN,s.toString())}))}Ho(e,t,n,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,c])=>this.connection.Ho(e,ho(t,n),i,a,c,s))).catch((a=>{throw a.name==="FirebaseError"?(a.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new U(D.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class vv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ot(t),this.aa=!1):L("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Jt="RemoteStore";class Ev{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((a=>{n.enqueueAndForget((async()=>{nn(this)&&(L(Jt,"Restarting streams for network reachability change."),await(async function(l){const h=H(l);h.Ea.add(4),await Cr(h),h.Ra.set("Unknown"),h.Ea.delete(4),await Ji(h)})(this))}))})),this.Ra=new vv(n,i)}}async function Ji(r){if(nn(r))for(const e of r.da)await e(!0)}async function Cr(r){for(const e of r.da)await e(!1)}function Zh(r,e){const t=H(r);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ta(t)?ea(t):Nn(t).O_()&&Zo(t,e))}function Jo(r,e){const t=H(r),n=Nn(t);t.Ia.delete(e),n.O_()&&ed(t,e),t.Ia.size===0&&(n.O_()?n.L_():nn(t)&&t.Ra.set("Unknown"))}function Zo(r,e){if(r.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Nn(r).Y_(e)}function ed(r,e){r.Va.Ue(e),Nn(r).Z_(e)}function ea(r){r.Va=new py({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),At:e=>r.Ia.get(e)||null,ht:()=>r.datastore.serializer.databaseId}),Nn(r).start(),r.Ra.ua()}function ta(r){return nn(r)&&!Nn(r).x_()&&r.Ia.size>0}function nn(r){return H(r).Ea.size===0}function td(r){r.Va=void 0}async function wv(r){r.Ra.set("Online")}async function Tv(r){r.Ia.forEach(((e,t)=>{Zo(r,e)}))}async function Iv(r,e){td(r),ta(r)?(r.Ra.ha(e),ea(r)):r.Ra.set("Unknown")}async function bv(r,e,t){if(r.Ra.set("Online"),e instanceof Fh&&e.state===2&&e.cause)try{await(async function(i,s){const a=s.cause;for(const c of s.targetIds)i.Ia.has(c)&&(await i.remoteSyncer.rejectListen(c,a),i.Ia.delete(c),i.Va.removeTarget(c))})(r,e)}catch(n){L(Jt,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await xi(r,n)}else if(e instanceof fi?r.Va.Ze(e):e instanceof Uh?r.Va.st(e):r.Va.tt(e),!t.isEqual($.min()))try{const n=await Xh(r.localStore);t.compareTo(n)>=0&&await(function(s,a){const c=s.Va.Tt(a);return c.targetChanges.forEach(((l,h)=>{if(l.resumeToken.approximateByteSize()>0){const f=s.Ia.get(h);f&&s.Ia.set(h,f.withResumeToken(l.resumeToken,a))}})),c.targetMismatches.forEach(((l,h)=>{const f=s.Ia.get(l);if(!f)return;s.Ia.set(l,f.withResumeToken(ve.EMPTY_BYTE_STRING,f.snapshotVersion)),ed(s,l);const m=new Et(f.target,l,h,f.sequenceNumber);Zo(s,m)})),s.remoteSyncer.applyRemoteEvent(c)})(r,t)}catch(n){L(Jt,"Failed to raise snapshot:",n),await xi(r,n)}}async function xi(r,e,t){if(!Dn(e))throw e;r.Ea.add(1),await Cr(r),r.Ra.set("Offline"),t||(t=()=>Xh(r.localStore)),r.asyncQueue.enqueueRetryable((async()=>{L(Jt,"Retrying IndexedDB access"),await t(),r.Ea.delete(1),await Ji(r)}))}function nd(r,e){return e().catch((t=>xi(r,t,e)))}async function Zi(r){const e=H(r),t=Lt(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Uo;for(;Av(e);)try{const i=await ov(e.localStore,n);if(i===null){e.Ta.length===0&&t.L_();break}n=i.batchId,Rv(e,i)}catch(i){await xi(e,i)}rd(e)&&id(e)}function Av(r){return nn(r)&&r.Ta.length<10}function Rv(r,e){r.Ta.push(e);const t=Lt(r);t.O_()&&t.X_&&t.ea(e.mutations)}function rd(r){return nn(r)&&!Lt(r).x_()&&r.Ta.length>0}function id(r){Lt(r).start()}async function Cv(r){Lt(r).ra()}async function Sv(r){const e=Lt(r);for(const t of r.Ta)e.ea(t.mutations)}async function Pv(r,e,t){const n=r.Ta.shift(),i=Ho.from(n,e,t);await nd(r,(()=>r.remoteSyncer.applySuccessfulWrite(i))),await Zi(r)}async function kv(r,e){e&&Lt(r).X_&&await(async function(n,i){if((function(a){return hy(a)&&a!==D.ABORTED})(i.code)){const s=n.Ta.shift();Lt(n).B_(),await nd(n,(()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i))),await Zi(n)}})(r,e),rd(r)&&id(r)}async function Ol(r,e){const t=H(r);t.asyncQueue.verifyOperationInProgress(),L(Jt,"RemoteStore received new credentials");const n=nn(t);t.Ea.add(3),await Cr(t),n&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ji(t)}async function Dv(r,e){const t=H(r);e?(t.Ea.delete(2),await Ji(t)):e||(t.Ea.add(2),await Cr(t),t.Ra.set("Unknown"))}function Nn(r){return r.ma||(r.ma=(function(t,n,i){const s=H(t);return s.sa(),new mv(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(r.datastore,r.asyncQueue,{Xo:wv.bind(null,r),t_:Tv.bind(null,r),r_:Iv.bind(null,r),H_:bv.bind(null,r)}),r.da.push((async e=>{e?(r.ma.B_(),ta(r)?ea(r):r.Ra.set("Unknown")):(await r.ma.stop(),td(r))}))),r.ma}function Lt(r){return r.fa||(r.fa=(function(t,n,i){const s=H(t);return s.sa(),new gv(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:Cv.bind(null,r),r_:kv.bind(null,r),ta:Sv.bind(null,r),na:Pv.bind(null,r)}),r.da.push((async e=>{e?(r.fa.B_(),await Zi(r)):(await r.fa.stop(),r.Ta.length>0&&(L(Jt,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}class na{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new At,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const a=Date.now()+n,c=new na(e,t,a,i,s);return c.start(n),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new U(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ra(r,e){if(ot("AsyncQueue",`${e}: ${r}`),Dn(r))return new U(D.UNAVAILABLE,`${e}: ${r}`);throw r}class gn{static emptySet(e){return new gn(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||B.comparator(t.key,n.key):(t,n)=>B.comparator(t.key,n.key),this.keyedMap=nr(),this.sortedSet=new ne(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof gn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new gn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ll{constructor(){this.ga=new ne(B.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):q(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Cn{constructor(e,t,n,i,s,a,c,l,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){const a=[];return t.forEach((c=>{a.push({type:0,doc:c})})),new Cn(e,t,gn.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Wi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class Nv{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class xv{constructor(){this.queries=Vl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const i=H(t),s=i.queries;i.queries=Vl(),s.forEach(((a,c)=>{for(const l of c.Sa)l.onError(n)}))})(this,new U(D.ABORTED,"Firestore shutting down"))}}function Vl(){return new tn((r=>bh(r)),Wi)}async function Ov(r,e){const t=H(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.ba()&&e.Da()&&(n=2):(s=new Nv,n=e.Da()?0:1);try{switch(n){case 0:s.wa=await t.onListen(i,!0);break;case 1:s.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){const c=ra(a,`Initialization of query '${ln(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&ia(t)}async function Lv(r,e){const t=H(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const a=s.Sa.indexOf(e);a>=0&&(s.Sa.splice(a,1),s.Sa.length===0?i=e.Da()?0:1:!s.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function Vv(r,e){const t=H(r);let n=!1;for(const i of e){const s=i.query,a=t.queries.get(s);if(a){for(const c of a.Sa)c.Fa(i)&&(n=!0);a.wa=i}}n&&ia(t)}function Mv(r,e,t){const n=H(r),i=n.queries.get(e);if(i)for(const s of i.Sa)s.onError(t);n.queries.delete(e)}function ia(r){r.Ca.forEach((e=>{e.next()}))}var _o,Ml;(Ml=_o||(_o={})).Ma="default",Ml.Cache="cache";class Uv{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)i.type!==3&&n.push(i);e=new Cn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Cn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==_o.Cache}}class sd{constructor(e){this.key=e}}class od{constructor(e){this.key=e}}class Fv{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Q(),this.mutatedKeys=Q(),this.eu=Ah(e),this.tu=new gn(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new Ll,i=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,c=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((f,m)=>{const _=i.get(f),T=Gi(this.query,m)?m:null,R=!!_&&this.mutatedKeys.has(_.key),k=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations);let S=!1;_&&T?_.data.isEqual(T.data)?R!==k&&(n.track({type:3,doc:T}),S=!0):this.su(_,T)||(n.track({type:2,doc:T}),S=!0,(l&&this.eu(T,l)>0||h&&this.eu(T,h)<0)&&(c=!0)):!_&&T?(n.track({type:0,doc:T}),S=!0):_&&!T&&(n.track({type:1,doc:_}),S=!0,(l||h)&&(c=!0)),S&&(T?(a=a.add(T),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{tu:a,iu:n,Cs:c,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((f,m)=>(function(T,R){const k=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return q(20277,{Rt:S})}};return k(T)-k(R)})(f.type,m.type)||this.eu(f.doc,m.doc))),this.ou(n),i=i??!1;const c=t&&!i?this._u():[],l=this.Xa.size===0&&this.current&&!i?1:0,h=l!==this.Za;return this.Za=l,a.length!==0||h?{snapshot:new Cn(this.query,e.tu,s,a,e.mutatedKeys,l===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ll,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Q(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const t=[];return e.forEach((n=>{this.Xa.has(n)||t.push(new od(n))})),this.Xa.forEach((n=>{e.has(n)||t.push(new sd(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=Q();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Cn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const sa="SyncEngine";class Bv{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class qv{constructor(e){this.key=e,this.hu=!1}}class zv{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new tn((c=>bh(c)),Wi),this.Iu=new Map,this.Eu=new Set,this.du=new ne(B.comparator),this.Au=new Map,this.Ru=new Ko,this.Vu={},this.mu=new Map,this.fu=Rn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function jv(r,e,t=!0){const n=dd(r);let i;const s=n.Tu.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await ad(n,e,t,!0),i}async function $v(r,e){const t=dd(r);await ad(t,e,!0,!1)}async function ad(r,e,t,n){const i=await av(r.localStore,Ge(e)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,t);let c;return n&&(c=await Hv(r,e,s,a==="current",i.resumeToken)),r.isPrimaryClient&&t&&Zh(r.remoteStore,i),c}async function Hv(r,e,t,n,i){r.pu=(m,_,T)=>(async function(k,S,N,O){let V=S.view.ru(N);V.Cs&&(V=await Pl(k.localStore,S.query,!1).then((({documents:E})=>S.view.ru(E,V))));const z=O&&O.targetChanges.get(S.targetId),F=O&&O.targetMismatches.get(S.targetId)!=null,M=S.view.applyChanges(V,k.isPrimaryClient,z,F);return Fl(k,S.targetId,M.au),M.snapshot})(r,m,_,T);const s=await Pl(r.localStore,e,!0),a=new Fv(e,s.Qs),c=a.ru(s.documents),l=Rr.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),h=a.applyChanges(c,r.isPrimaryClient,l);Fl(r,t,h.au);const f=new Bv(e,t,a);return r.Tu.set(e,f),r.Iu.has(t)?r.Iu.get(t).push(e):r.Iu.set(t,[e]),h.snapshot}async function Wv(r,e,t){const n=H(r),i=n.Tu.get(e),s=n.Iu.get(i.targetId);if(s.length>1)return n.Iu.set(i.targetId,s.filter((a=>!Wi(a,e)))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await mo(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Jo(n.remoteStore,i.targetId),yo(n,i.targetId)})).catch(kn)):(yo(n,i.targetId),await mo(n.localStore,i.targetId,!0))}async function Gv(r,e){const t=H(r),n=t.Tu.get(e),i=t.Iu.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Jo(t.remoteStore,n.targetId))}async function Kv(r,e,t){const n=tE(r);try{const i=await(function(a,c){const l=H(a),h=te.now(),f=c.reduce(((T,R)=>T.add(R.key)),Q());let m,_;return l.persistence.runTransaction("Locally write mutations","readwrite",(T=>{let R=at(),k=Q();return l.Ns.getEntries(T,f).next((S=>{R=S,R.forEach(((N,O)=>{O.isValidDocument()||(k=k.add(N))}))})).next((()=>l.localDocuments.getOverlayedDocuments(T,R))).next((S=>{m=S;const N=[];for(const O of c){const V=oy(O,m.get(O.key).overlayedDocument);V!=null&&N.push(new Ft(O.key,V,gh(V.value.mapValue),Ue.exists(!0)))}return l.mutationQueue.addMutationBatch(T,h,N,c)})).next((S=>{_=S;const N=S.applyToLocalDocumentSet(m,k);return l.documentOverlayCache.saveOverlays(T,S.batchId,N)}))})).then((()=>({batchId:_.batchId,changes:Ch(m)})))})(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),(function(a,c,l){let h=a.Vu[a.currentUser.toKey()];h||(h=new ne(K)),h=h.insert(c,l),a.Vu[a.currentUser.toKey()]=h})(n,i.batchId,t),await Sr(n,i.changes),await Zi(n.remoteStore)}catch(i){const s=ra(i,"Failed to persist write");t.reject(s)}}async function cd(r,e){const t=H(r);try{const n=await iv(t.localStore,e);e.targetChanges.forEach(((i,s)=>{const a=t.Au.get(s);a&&(Y(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?Y(a.hu,14607):i.removedDocuments.size>0&&(Y(a.hu,42227),a.hu=!1))})),await Sr(t,n,e)}catch(n){await kn(n)}}function Ul(r,e,t){const n=H(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const i=[];n.Tu.forEach(((s,a)=>{const c=a.view.va(e);c.snapshot&&i.push(c.snapshot)})),(function(a,c){const l=H(a);l.onlineState=c;let h=!1;l.queries.forEach(((f,m)=>{for(const _ of m.Sa)_.va(c)&&(h=!0)})),h&&ia(l)})(n.eventManager,e),i.length&&n.Pu.H_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function Qv(r,e,t){const n=H(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Au.get(e),s=i&&i.key;if(s){let a=new ne(B.comparator);a=a.insert(s,Ie.newNoDocument(s,$.min()));const c=Q().add(s),l=new Xi($.min(),new Map,new ne(K),a,c);await cd(n,l),n.du=n.du.remove(s),n.Au.delete(e),oa(n)}else await mo(n.localStore,e,!1).then((()=>yo(n,e,t))).catch(kn)}async function Xv(r,e){const t=H(r),n=e.batch.batchId;try{const i=await rv(t.localStore,e);ud(t,n,null),ld(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Sr(t,i)}catch(i){await kn(i)}}async function Yv(r,e,t){const n=H(r);try{const i=await(function(a,c){const l=H(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let f;return l.mutationQueue.lookupMutationBatch(h,c).next((m=>(Y(m!==null,37113),f=m.keys(),l.mutationQueue.removeMutationBatch(h,m)))).next((()=>l.mutationQueue.performConsistencyCheck(h))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(h,f,c))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f))).next((()=>l.localDocuments.getDocuments(h,f)))}))})(n.localStore,e);ud(n,e,t),ld(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Sr(n,i)}catch(i){await kn(i)}}function ld(r,e){(r.mu.get(e)||[]).forEach((t=>{t.resolve()})),r.mu.delete(e)}function ud(r,e,t){const n=H(r);let i=n.Vu[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Vu[n.currentUser.toKey()]=i}}function yo(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Iu.get(e))r.Tu.delete(n),t&&r.Pu.yu(n,t);r.Iu.delete(e),r.isPrimaryClient&&r.Ru.jr(e).forEach((n=>{r.Ru.containsKey(n)||hd(r,n)}))}function hd(r,e){r.Eu.delete(e.path.canonicalString());const t=r.du.get(e);t!==null&&(Jo(r.remoteStore,t),r.du=r.du.remove(e),r.Au.delete(t),oa(r))}function Fl(r,e,t){for(const n of t)n instanceof sd?(r.Ru.addReference(n.key,e),Jv(r,n)):n instanceof od?(L(sa,"Document no longer in limbo: "+n.key),r.Ru.removeReference(n.key,e),r.Ru.containsKey(n.key)||hd(r,n.key)):q(19791,{wu:n})}function Jv(r,e){const t=e.key,n=t.path.canonicalString();r.du.get(t)||r.Eu.has(n)||(L(sa,"New document in limbo: "+t),r.Eu.add(n),oa(r))}function oa(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const e=r.Eu.values().next().value;r.Eu.delete(e);const t=new B(ee.fromString(e)),n=r.fu.next();r.Au.set(n,new qv(t)),r.du=r.du.insert(t,n),Zh(r.remoteStore,new Et(Ge(Ih(t.path)),n,"TargetPurposeLimboResolution",zi.ce))}}async function Sr(r,e,t){const n=H(r),i=[],s=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach(((c,l)=>{a.push(n.pu(l,e,t).then((h=>{if((h||t)&&n.isPrimaryClient){const f=h?!h.fromCache:t?.targetChanges.get(l.targetId)?.current;n.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(h){i.push(h);const f=Xo.As(l.targetId,h);s.push(f)}})))})),await Promise.all(a),n.Pu.H_(i),await(async function(l,h){const f=H(l);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>P.forEach(h,(_=>P.forEach(_.Es,(T=>f.persistence.referenceDelegate.addReference(m,_.targetId,T))).next((()=>P.forEach(_.ds,(T=>f.persistence.referenceDelegate.removeReference(m,_.targetId,T)))))))))}catch(m){if(!Dn(m))throw m;L(Yo,"Failed to update sequence numbers: "+m)}for(const m of h){const _=m.targetId;if(!m.fromCache){const T=f.Ms.get(_),R=T.snapshotVersion,k=T.withLastLimboFreeSnapshotVersion(R);f.Ms=f.Ms.insert(_,k)}}})(n.localStore,s))}async function Zv(r,e){const t=H(r);if(!t.currentUser.isEqual(e)){L(sa,"User change. New user:",e.toKey());const n=await Qh(t.localStore,e);t.currentUser=e,(function(s,a){s.mu.forEach((c=>{c.forEach((l=>{l.reject(new U(D.CANCELLED,a))}))})),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Sr(t,n.Ls)}}function eE(r,e){const t=H(r),n=t.Au.get(e);if(n&&n.hu)return Q().add(n.key);{let i=Q();const s=t.Iu.get(e);if(!s)return i;for(const a of s){const c=t.Tu.get(a);i=i.unionWith(c.view.nu)}return i}}function dd(r){const e=H(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=cd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=eE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Qv.bind(null,e),e.Pu.H_=Vv.bind(null,e.eventManager),e.Pu.yu=Mv.bind(null,e.eventManager),e}function tE(r){const e=H(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Xv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Yv.bind(null,e),e}class Oi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Yi(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return nv(this.persistence,new Zy,e.initialUser,this.serializer)}Cu(e){return new Kh(Qo.mi,this.serializer)}Du(e){return new lv}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Oi.provider={build:()=>new Oi};class nE extends Oi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Y(this.persistence.referenceDelegate instanceof Ni,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Uy(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Pe.withCacheSize(this.cacheSizeBytes):Pe.DEFAULT;return new Kh((n=>Ni.mi(n,t)),this.serializer)}}class vo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Ul(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=Zv.bind(null,this.syncEngine),await Dv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new xv})()}createDatastore(e){const t=Yi(e.databaseInfo.databaseId),n=(function(s){return new pv(s)})(e.databaseInfo);return(function(s,a,c,l){return new yv(s,a,c,l)})(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return(function(n,i,s,a,c){return new Ev(n,i,s,a,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>Ul(this.syncEngine,t,0)),(function(){return Nl.v()?new Nl:new uv})())}createSyncEngine(e,t){return(function(i,s,a,c,l,h,f){const m=new zv(i,s,a,c,l,h);return f&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const n=H(t);L(Jt,"RemoteStore shutting down."),n.Ea.add(5),await Cr(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}vo.provider={build:()=>new vo};class rE{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ot("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Vt="FirestoreClient";class iE{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Te.UNAUTHENTICATED,this.clientId=Vo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,(async a=>{L(Vt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,(a=>(L(Vt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new At;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=ra(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function zs(r,e){r.asyncQueue.verifyOperationInProgress(),L(Vt,"Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener((async i=>{n.isEqual(i)||(await Qh(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener((()=>r.terminate())),r._offlineComponents=e}async function Bl(r,e){r.asyncQueue.verifyOperationInProgress();const t=await sE(r);L(Vt,"Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener((n=>Ol(e.remoteStore,n))),r.setAppCheckTokenChangeListener(((n,i)=>Ol(e.remoteStore,i))),r._onlineComponents=e}async function sE(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){L(Vt,"Using user provided OfflineComponentProvider");try{await zs(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===D.FAILED_PRECONDITION||i.code===D.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;En("Error using user provided cache. Falling back to memory cache: "+t),await zs(r,new Oi)}}else L(Vt,"Using default OfflineComponentProvider"),await zs(r,new nE(void 0));return r._offlineComponents}async function fd(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(L(Vt,"Using user provided OnlineComponentProvider"),await Bl(r,r._uninitializedComponentsProvider._online)):(L(Vt,"Using default OnlineComponentProvider"),await Bl(r,new vo))),r._onlineComponents}function oE(r){return fd(r).then((e=>e.syncEngine))}async function aE(r){const e=await fd(r),t=e.eventManager;return t.onListen=jv.bind(null,e.syncEngine),t.onUnlisten=Wv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=$v.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Gv.bind(null,e.syncEngine),t}function cE(r,e,t={}){const n=new At;return r.asyncQueue.enqueueAndForget((async()=>(function(s,a,c,l,h){const f=new rE({next:_=>{f.Nu(),a.enqueueAndForget((()=>Lv(s,m))),_.fromCache&&l.source==="server"?h.reject(new U(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),m=new Uv(c,f,{includeMetadataChanges:!0,qa:!0});return Ov(s,m)})(await aE(r),r.asyncQueue,e,t,n))),n.promise}function pd(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}const ql=new Map;const md="firestore.googleapis.com",zl=!0;class jl{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new U(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=md,this.ssl=zl}else this.host=e.host,this.ssl=e.ssl??zl;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Gh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Vy)throw new U(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}v_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=pd(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new U(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new U(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new U(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,i){return n.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class es{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new U(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new U(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new l_;switch(n.type){case"firstParty":return new f_(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new U(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const n=ql.get(t);n&&(L("ComponentProvider","Removing Datastore"),ql.delete(t),n.terminate())})(this),Promise.resolve()}}function lE(r,e,t,n={}){r=kt(r,es);const i=Mt(e),s=r._getSettings(),a={...s,emulatorOptions:r._getEmulatorOptions()},c=`${e}:${t}`;i&&(Io(`https://${c}`),bo("Firestore",!0)),s.host!==md&&s.host!==c&&En("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...s,host:c,ssl:i,emulatorOptions:n};if(!nt(l,a)&&(r._setSettings(l),n.mockUserToken)){let h,f;if(typeof n.mockUserToken=="string")h=n.mockUserToken,f=Te.MOCK_USER;else{h=fu(n.mockUserToken,r._app?.options.projectId);const m=n.mockUserToken.sub||n.mockUserToken.user_id;if(!m)throw new U(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Te(m)}r._authCredentials=new u_(new ih(h,f))}}class ts{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new ts(this.firestore,e,this._query)}}class he{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new he(this.firestore,e,this._key)}toJSON(){return{type:he._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(br(t,he._jsonSchema))return new he(e,n||null,new B(ee.fromString(t.referencePath)))}}he._jsonSchemaVersion="firestore/documentReference/1.0",he._jsonSchema={type:ce("string",he._jsonSchemaVersion),referencePath:ce("string")};class Rt extends ts{constructor(e,t,n){super(e,t,Ih(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new he(this.firestore,null,new B(e))}withConverter(e){return new Rt(this.firestore,e,this._path)}}function uE(r,e,...t){if(r=fe(r),sh("collection","path",e),r instanceof es){const n=ee.fromString(e,...t);return rl(n),new Rt(r,null,n)}{if(!(r instanceof he||r instanceof Rt))throw new U(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ee.fromString(e,...t));return rl(n),new Rt(r.firestore,null,n)}}function Zr(r,e,...t){if(r=fe(r),arguments.length===1&&(e=Vo.newId()),sh("doc","path",e),r instanceof es){const n=ee.fromString(e,...t);return nl(n),new he(r,null,new B(n))}{if(!(r instanceof he||r instanceof Rt))throw new U(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ee.fromString(e,...t));return nl(n),new he(r.firestore,r instanceof Rt?r.converter:null,new B(n))}}const $l="AsyncQueue";class Hl{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Yh(this,"async_queue_retry"),this._c=()=>{const n=qs();n&&L($l,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=qs();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=qs();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new At;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Dn(e))throw e;L($l,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,ot("INTERNAL UNHANDLED ERROR: ",Wl(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=na.createAndSchedule(this,e,t,n,(s=>this.hc(s)));return this.tc.push(i),i}uc(){this.nc&&q(47125,{Pc:Wl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,n)=>t.targetTimeMs-n.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Wl(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}class Pr extends es{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Hl,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Hl(e),this._firestoreClient=void 0,await e}}}function hE(r,e){const t=typeof r=="object"?r:Co(),n=typeof r=="string"?r:Ai,i=Mi(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const s=uu("firestore");s&&lE(i,...s)}return i}function gd(r){if(r._terminated)throw new U(D.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||dE(r),r._firestoreClient}function dE(r){const e=r._freezeSettings(),t=(function(i,s,a,c){return new k_(i,s,a,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,pd(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)})(r._databaseId,r._app?.options.appId||"",r._persistenceKey,e);r._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),r._firestoreClient=new iE(r._authCredentials,r._appCheckCredentials,r._queue,t,r._componentsProvider&&(function(i){const s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}})(r._componentsProvider))}class Ve{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ve(ve.fromBase64String(e))}catch(t){throw new U(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ve(ve.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ve._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(br(e,Ve._jsonSchema))return Ve.fromBase64String(e.bytes)}}Ve._jsonSchemaVersion="firestore/bytes/1.0",Ve._jsonSchema={type:ce("string",Ve._jsonSchemaVersion),bytes:ce("string")};class ns{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new U(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ye(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class kr{constructor(e){this._methodName=e}}class Qe{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new U(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new U(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return K(this._lat,e._lat)||K(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Qe._jsonSchemaVersion}}static fromJSON(e){if(br(e,Qe._jsonSchema))return new Qe(e.latitude,e.longitude)}}Qe._jsonSchemaVersion="firestore/geoPoint/1.0",Qe._jsonSchema={type:ce("string",Qe._jsonSchemaVersion),latitude:ce("number"),longitude:ce("number")};class Xe{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Xe._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(br(e,Xe._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Xe(e.vectorValues);throw new U(D.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Xe._jsonSchemaVersion="firestore/vectorValue/1.0",Xe._jsonSchema={type:ce("string",Xe._jsonSchemaVersion),vectorValues:ce("object")};const fE=/^__.*__$/;class pE{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Ft(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ar(e,this.data,t,this.fieldTransforms)}}class _d{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Ft(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function yd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw q(40011,{Ac:r})}}class rs{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new rs({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Li(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(yd(this.Ac)&&fE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class mE{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Yi(e)}Cc(e,t,n,i=!1){return new rs({Ac:e,methodName:t,Dc:n,path:ye.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vd(r){const e=r._freezeSettings(),t=Yi(r._databaseId);return new mE(r._databaseId,!!e.ignoreUndefinedProperties,t)}function gE(r,e,t,n,i,s={}){const a=r.Cc(s.merge||s.mergeFields?2:0,e,t,i);la("Data must be an object, but it was:",a,n);const c=wd(n,a);let l,h;if(s.merge)l=new xe(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){const f=[];for(const m of s.mergeFields){const _=Eo(e,m,t);if(!a.contains(_))throw new U(D.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);Id(f,_)||f.push(_)}l=new xe(f),h=a.fieldTransforms.filter((m=>l.covers(m.field)))}else l=null,h=a.fieldTransforms;return new pE(new ke(c),l,h)}class is extends kr{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof is}}function Ed(r,e,t){return new rs({Ac:3,Dc:e.settings.Dc,methodName:r._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class aa extends kr{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Ed(this,e,!0),n=this.vc.map((s=>xn(s,t))),i=new bn(n);return new Oh(e.path,i)}isEqual(e){return e instanceof aa&&nt(this.vc,e.vc)}}class ca extends kr{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Ed(this,e,!0),n=this.vc.map((s=>xn(s,t))),i=new An(n);return new Oh(e.path,i)}isEqual(e){return e instanceof ca&&nt(this.vc,e.vc)}}function _E(r,e,t,n){const i=r.Cc(1,e,t);la("Data must be an object, but it was:",i,n);const s=[],a=ke.empty();Ut(n,((l,h)=>{const f=ua(e,l,t);h=fe(h);const m=i.yc(f);if(h instanceof is)s.push(f);else{const _=xn(h,m);_!=null&&(s.push(f),a.set(f,_))}}));const c=new xe(s);return new _d(a,c,i.fieldTransforms)}function yE(r,e,t,n,i,s){const a=r.Cc(1,e,t),c=[Eo(e,n,t)],l=[i];if(s.length%2!=0)throw new U(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)c.push(Eo(e,s[_])),l.push(s[_+1]);const h=[],f=ke.empty();for(let _=c.length-1;_>=0;--_)if(!Id(h,c[_])){const T=c[_];let R=l[_];R=fe(R);const k=a.yc(T);if(R instanceof is)h.push(T);else{const S=xn(R,k);S!=null&&(h.push(T),f.set(T,S))}}const m=new xe(h);return new _d(f,m,a.fieldTransforms)}function xn(r,e){if(Td(r=fe(r)))return la("Unsupported field value:",e,r),wd(r,e);if(r instanceof kr)return(function(n,i){if(!yd(i.Ac))throw i.Sc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(n,i){const s=[];let a=0;for(const c of n){let l=xn(c,i.wc(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}})(r,e)}return(function(n,i){if((n=fe(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return ey(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const s=te.fromDate(n);return{timestampValue:Di(i.serializer,s)}}if(n instanceof te){const s=new te(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Di(i.serializer,s)}}if(n instanceof Qe)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Ve)return{bytesValue:Bh(i.serializer,n._byteString)};if(n instanceof he){const s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Go(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Xe)return(function(a,c){return{mapValue:{fields:{[ph]:{stringValue:mh},[Ri]:{arrayValue:{values:a.toArray().map((h=>{if(typeof h!="number")throw c.Sc("VectorValues must only contain numeric values.");return jo(c.serializer,h)}))}}}}}})(n,i);throw i.Sc(`Unsupported field value: ${Mo(n)}`)})(r,e)}function wd(r,e){const t={};return ch(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ut(r,((n,i)=>{const s=xn(i,e.mc(n));s!=null&&(t[n]=s)})),{mapValue:{fields:t}}}function Td(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof te||r instanceof Qe||r instanceof Ve||r instanceof he||r instanceof kr||r instanceof Xe)}function la(r,e,t){if(!Td(t)||!oh(t)){const n=Mo(t);throw n==="an object"?e.Sc(r+" a custom object"):e.Sc(r+" "+n)}}function Eo(r,e,t){if((e=fe(e))instanceof ns)return e._internalPath;if(typeof e=="string")return ua(r,e);throw Li("Field path arguments must be of type string or ",r,!1,void 0,t)}const vE=new RegExp("[~\\*/\\[\\]]");function ua(r,e,t){if(e.search(vE)>=0)throw Li(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new ns(...e.split("."))._internalPath}catch{throw Li(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Li(r,e,t,n,i){const s=n&&!n.isEmpty(),a=i!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new U(D.INVALID_ARGUMENT,c+r+l)}function Id(r,e){return r.some((t=>t.isEqual(e)))}class bd{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new he(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new EE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ad("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class EE extends bd{data(){return super.data()}}function Ad(r,e){return typeof e=="string"?ua(r,e):e instanceof ns?e._internalPath:e._delegate._internalPath}function wE(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new U(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class TE{convertValue(e,t="none"){switch(Ot(e)){case 0:return null;case 1:return e.booleanValue;case 2:return oe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(xt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw q(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Ut(e,((i,s)=>{n[i]=this.convertValue(s,t)})),n}convertVectorValue(e){const t=e.fields?.[Ri].arrayValue?.values?.map((n=>oe(n.doubleValue)));return new Xe(t)}convertGeoPoint(e){return new Qe(oe(e.latitude),oe(e.longitude))}convertArray(e,t){return(e.values||[]).map((n=>this.convertValue(n,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=$i(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(mr(e));default:return null}}convertTimestamp(e){const t=Nt(e);return new te(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ee.fromString(e);Y(Wh(n),9688,{name:e});const i=new gr(n.get(1),n.get(3)),s=new B(n.popFirst(5));return i.isEqual(t)||ot(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function IE(r,e,t){let n;return n=r?r.toFirestore(e):e,n}class ei{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _n extends bd{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new pi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Ad("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new U(D.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=_n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}_n._jsonSchemaVersion="firestore/documentSnapshot/1.0",_n._jsonSchema={type:ce("string",_n._jsonSchemaVersion),bundleSource:ce("string","DocumentSnapshot"),bundleName:ce("string"),bundle:ce("string")};class pi extends _n{data(e={}){return super.data(e)}}class yn{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ei(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new pi(this._firestore,this._userDataWriter,n.key,n,new ei(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new U(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map((c=>{const l=new pi(i._firestore,i._userDataWriter,c.doc.key,c.doc,new ei(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((c=>s||c.type!==3)).map((c=>{const l=new pi(i._firestore,i._userDataWriter,c.doc.key,c.doc,new ei(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return c.type!==0&&(h=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),f=a.indexOf(c.doc.key)),{type:bE(c.type),doc:l,oldIndex:h,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new U(D.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=yn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Vo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],i=[];return this.docs.forEach((s=>{s._document!==null&&(t.push(s._document),n.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function bE(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return q(61501,{type:r})}}yn._jsonSchemaVersion="firestore/querySnapshot/1.0",yn._jsonSchema={type:ce("string",yn._jsonSchemaVersion),bundleSource:ce("string","QuerySnapshot"),bundleName:ce("string"),bundle:ce("string")};class AE extends TE{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ve(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new he(this.firestore,null,t)}}function RE(r){r=kt(r,ts);const e=kt(r.firestore,Pr),t=gd(e),n=new AE(e);return wE(r._query),cE(t,r._query).then((i=>new yn(e,n,r,i)))}function CE(r,e,t){r=kt(r,he);const n=kt(r.firestore,Pr),i=IE(r.converter,e);return ha(n,[gE(vd(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,Ue.none())])}function Gl(r,e,t,...n){r=kt(r,he);const i=kt(r.firestore,Pr),s=vd(i);let a;return a=typeof(e=fe(e))=="string"||e instanceof ns?yE(s,"updateDoc",r._key,e,t,n):_E(s,"updateDoc",r._key,e),ha(i,[a.toMutation(r._key,Ue.exists(!0))])}function SE(r){return ha(kt(r.firestore,Pr),[new $o(r._key,Ue.none())])}function ha(r,e){return(function(n,i){const s=new At;return n.asyncQueue.enqueueAndForget((async()=>Kv(await oE(n),i,s))),s.promise})(gd(r),e)}function PE(...r){return new aa("arrayUnion",r)}function kE(...r){return new ca("arrayRemove",r)}(function(e,t=!0){(function(i){Pn=i})(en),Qt(new St("firestore",((n,{instanceIdentifier:i,options:s})=>{const a=n.getProvider("app").getImmediate(),c=new Pr(new h_(n.getProvider("auth-internal")),new p_(a,n.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new U(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gr(h.options.projectId,f)})(a,i),a);return s={useFetchStreams:t,...s},c._setSettings(s),c}),"PUBLIC").setMultipleInstances(!0)),$e(Jc,Zc,e),$e(Jc,Zc,"esm2020")})();const Rd="firebasestorage.googleapis.com",Cd="storageBucket",DE=120*1e3,NE=600*1e3;class se extends Ze{constructor(e,t,n=0){super(js(e),`Firebase Storage: ${t} (${js(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,se.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return js(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ie;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ie||(ie={}));function js(r){return"storage/"+r}function da(){const r="An unknown error occurred, please check the error payload for server response.";return new se(ie.UNKNOWN,r)}function xE(r){return new se(ie.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")}function OE(r){return new se(ie.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function LE(){const r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new se(ie.UNAUTHENTICATED,r)}function VE(){return new se(ie.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function ME(r){return new se(ie.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")}function UE(){return new se(ie.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function FE(){return new se(ie.CANCELED,"User canceled the upload/download.")}function BE(r){return new se(ie.INVALID_URL,"Invalid URL '"+r+"'.")}function qE(r){return new se(ie.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function zE(){return new se(ie.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Cd+"' property when initializing the app?")}function jE(){return new se(ie.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function $E(){return new se(ie.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function HE(r){return new se(ie.UNSUPPORTED_ENVIRONMENT,`${r} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function wo(r){return new se(ie.INVALID_ARGUMENT,r)}function Sd(){return new se(ie.APP_DELETED,"The Firebase app was deleted.")}function WE(r){return new se(ie.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function hr(r,e){return new se(ie.INVALID_FORMAT,"String does not match format '"+r+"': "+e)}function Xn(r){throw new se(ie.INTERNAL_ERROR,"Internal error: "+r)}class Oe{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Oe.makeFromUrl(e,t)}catch{return new Oe(e,"")}if(n.path==="")return n;throw qE(e)}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)";function s(z){z.path.charAt(z.path.length-1)==="/"&&(z.path_=z.path_.slice(0,-1))}const a="(/(.*))?$",c=new RegExp("^gs://"+i+a,"i"),l={bucket:1,path:3};function h(z){z.path_=decodeURIComponent(z.path)}const f="v[A-Za-z0-9_]+",m=t.replace(/[.]/g,"\\."),_="(/([^?#]*).*)?$",T=new RegExp(`^https?://${m}/${f}/b/${i}/o${_}`,"i"),R={bucket:1,path:3},k=t===Rd?"(?:storage.googleapis.com|storage.cloud.google.com)":t,S="([^?#]*)",N=new RegExp(`^https?://${k}/${i}/${S}`,"i"),V=[{regex:c,indices:l,postModify:s},{regex:T,indices:R,postModify:h},{regex:N,indices:{bucket:1,path:2},postModify:h}];for(let z=0;z<V.length;z++){const F=V[z],M=F.regex.exec(e);if(M){const E=M[F.indices.bucket];let g=M[F.indices.path];g||(g=""),n=new Oe(E,g),F.postModify(n);break}}if(n==null)throw BE(e);return n}}class GE{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function KE(r,e,t){let n=1,i=null,s=null,a=!1,c=0;function l(){return c===2}let h=!1;function f(...S){h||(h=!0,e.apply(null,S))}function m(S){i=setTimeout(()=>{i=null,r(T,l())},S)}function _(){s&&clearTimeout(s)}function T(S,...N){if(h){_();return}if(S){_(),f.call(null,S,...N);return}if(l()||a){_(),f.call(null,S,...N);return}n<64&&(n*=2);let V;c===1?(c=2,V=0):V=(n+Math.random())*1e3,m(V)}let R=!1;function k(S){R||(R=!0,_(),!h&&(i!==null?(S||(c=2),clearTimeout(i),m(0)):S||(c=1)))}return m(0),s=setTimeout(()=>{a=!0,k(!0)},t),k}function QE(r){r(!1)}function XE(r){return r!==void 0}function YE(r){return typeof r=="object"&&!Array.isArray(r)}function fa(r){return typeof r=="string"||r instanceof String}function Kl(r){return pa()&&r instanceof Blob}function pa(){return typeof Blob<"u"}function Ql(r,e,t,n){if(n<e)throw wo(`Invalid value for '${r}'. Expected ${e} or greater.`);if(n>t)throw wo(`Invalid value for '${r}'. Expected ${t} or less.`)}function ss(r,e,t){let n=e;return t==null&&(n=`https://${e}`),`${t}://${n}/v0${r}`}function Pd(r){const e=encodeURIComponent;let t="?";for(const n in r)if(r.hasOwnProperty(n)){const i=e(n)+"="+e(r[n]);t=t+i+"&"}return t=t.slice(0,-1),t}var Kt;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(Kt||(Kt={}));function JE(r,e){const t=r>=500&&r<600,i=[408,429].indexOf(r)!==-1,s=e.indexOf(r)!==-1;return t||i||s}class ZE{constructor(e,t,n,i,s,a,c,l,h,f,m,_=!0,T=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=a,this.callback_=c,this.errorCallback_=l,this.timeout_=h,this.progressCallback_=f,this.connectionFactory_=m,this.retry=_,this.isUsingEmulator=T,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((R,k)=>{this.resolve_=R,this.reject_=k,this.start_()})}start_(){const e=(n,i)=>{if(i){n(!1,new ti(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const a=c=>{const l=c.loaded,h=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,h)};this.progressCallback_!==null&&s.addUploadProgressListener(a),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(a),this.pendingConnection_=null;const c=s.getErrorCode()===Kt.NO_ERROR,l=s.getStatus();if(!c||JE(l,this.additionalRetryCodes_)&&this.retry){const f=s.getErrorCode()===Kt.ABORT;n(!1,new ti(!1,null,f));return}const h=this.successCodes_.indexOf(l)!==-1;n(!0,new ti(h,s))})},t=(n,i)=>{const s=this.resolve_,a=this.reject_,c=i.connection;if(i.wasSuccessCode)try{const l=this.callback_(c,c.getResponse());XE(l)?s(l):s()}catch(l){a(l)}else if(c!==null){const l=da();l.serverResponse=c.getErrorText(),this.errorCallback_?a(this.errorCallback_(c,l)):a(l)}else if(i.canceled){const l=this.appDelete_?Sd():FE();a(l)}else{const l=UE();a(l)}};this.canceled_?t(!1,new ti(!1,null,!0)):this.backoffId_=KE(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&QE(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class ti{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function ew(r,e){e!==null&&e.length>0&&(r.Authorization="Firebase "+e)}function tw(r,e){r["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function nw(r,e){e&&(r["X-Firebase-GMPID"]=e)}function rw(r,e){e!==null&&(r["X-Firebase-AppCheck"]=e)}function iw(r,e,t,n,i,s,a=!0,c=!1){const l=Pd(r.urlParams),h=r.url+l,f=Object.assign({},r.headers);return nw(f,e),ew(f,t),tw(f,s),rw(f,n),new ZE(h,r.method,f,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,i,a,c)}function sw(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function ow(...r){const e=sw();if(e!==void 0){const t=new e;for(let n=0;n<r.length;n++)t.append(r[n]);return t.getBlob()}else{if(pa())return new Blob(r);throw new se(ie.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function aw(r,e,t){return r.webkitSlice?r.webkitSlice(e,t):r.mozSlice?r.mozSlice(e,t):r.slice?r.slice(e,t):null}function cw(r){if(typeof atob>"u")throw HE("base-64");return atob(r)}const je={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class $s{constructor(e,t){this.data=e,this.contentType=t||null}}function lw(r,e){switch(r){case je.RAW:return new $s(kd(e));case je.BASE64:case je.BASE64URL:return new $s(Dd(r,e));case je.DATA_URL:return new $s(hw(e),dw(e))}throw da()}function kd(r){const e=[];for(let t=0;t<r.length;t++){let n=r.charCodeAt(t);if(n<=127)e.push(n);else if(n<=2047)e.push(192|n>>6,128|n&63);else if((n&64512)===55296)if(!(t<r.length-1&&(r.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const s=n,a=r.charCodeAt(++t);n=65536|(s&1023)<<10|a&1023,e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63)}else(n&64512)===56320?e.push(239,191,189):e.push(224|n>>12,128|n>>6&63,128|n&63)}return new Uint8Array(e)}function uw(r){let e;try{e=decodeURIComponent(r)}catch{throw hr(je.DATA_URL,"Malformed data URL.")}return kd(e)}function Dd(r,e){switch(r){case je.BASE64:{const i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw hr(r,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case je.BASE64URL:{const i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw hr(r,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=cw(e)}catch(i){throw i.message.includes("polyfill")?i:hr(r,"Invalid character found")}const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}class Nd{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw hr(je.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;n!=null&&(this.base64=fw(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}function hw(r){const e=new Nd(r);return e.base64?Dd(je.BASE64,e.rest):uw(e.rest)}function dw(r){return new Nd(r).contentType}function fw(r,e){return r.length>=e.length?r.substring(r.length-e.length)===e:!1}class vt{constructor(e,t){let n=0,i="";Kl(e)?(this.data_=e,n=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(Kl(this.data_)){const n=this.data_,i=aw(n,e,t);return i===null?null:new vt(i)}else{const n=new Uint8Array(this.data_.buffer,e,t-e);return new vt(n,!0)}}static getBlob(...e){if(pa()){const t=e.map(n=>n instanceof vt?n.data_:n);return new vt(ow.apply(null,t))}else{const t=e.map(a=>fa(a)?lw(je.RAW,a).data:a.data_);let n=0;t.forEach(a=>{n+=a.byteLength});const i=new Uint8Array(n);let s=0;return t.forEach(a=>{for(let c=0;c<a.length;c++)i[s++]=a[c]}),new vt(i,!0)}}uploadData(){return this.data_}}function xd(r){let e;try{e=JSON.parse(r)}catch{return null}return YE(e)?e:null}function pw(r){if(r.length===0)return null;const e=r.lastIndexOf("/");return e===-1?"":r.slice(0,e)}function mw(r,e){const t=e.split("/").filter(n=>n.length>0).join("/");return r.length===0?t:r+"/"+t}function Od(r){const e=r.lastIndexOf("/",r.length-2);return e===-1?r:r.slice(e+1)}function gw(r,e){return e}class Ce{constructor(e,t,n,i){this.server=e,this.local=t||e,this.writable=!!n,this.xform=i||gw}}let ni=null;function _w(r){return!fa(r)||r.length<2?r:Od(r)}function Ld(){if(ni)return ni;const r=[];r.push(new Ce("bucket")),r.push(new Ce("generation")),r.push(new Ce("metageneration")),r.push(new Ce("name","fullPath",!0));function e(s,a){return _w(a)}const t=new Ce("name");t.xform=e,r.push(t);function n(s,a){return a!==void 0?Number(a):a}const i=new Ce("size");return i.xform=n,r.push(i),r.push(new Ce("timeCreated")),r.push(new Ce("updated")),r.push(new Ce("md5Hash",null,!0)),r.push(new Ce("cacheControl",null,!0)),r.push(new Ce("contentDisposition",null,!0)),r.push(new Ce("contentEncoding",null,!0)),r.push(new Ce("contentLanguage",null,!0)),r.push(new Ce("contentType",null,!0)),r.push(new Ce("metadata","customMetadata",!0)),ni=r,ni}function yw(r,e){function t(){const n=r.bucket,i=r.fullPath,s=new Oe(n,i);return e._makeStorageReference(s)}Object.defineProperty(r,"ref",{get:t})}function vw(r,e,t){const n={};n.type="file";const i=t.length;for(let s=0;s<i;s++){const a=t[s];n[a.local]=a.xform(n,e[a.server])}return yw(n,r),n}function Vd(r,e,t){const n=xd(e);return n===null?null:vw(r,n,t)}function Ew(r,e,t,n){const i=xd(e);if(i===null||!fa(i.downloadTokens))return null;const s=i.downloadTokens;if(s.length===0)return null;const a=encodeURIComponent;return s.split(",").map(h=>{const f=r.bucket,m=r.fullPath,_="/b/"+a(f)+"/o/"+a(m),T=ss(_,t,n),R=Pd({alt:"media",token:h});return T+R})[0]}function ww(r,e){const t={},n=e.length;for(let i=0;i<n;i++){const s=e[i];s.writable&&(t[s.server]=r[s.local])}return JSON.stringify(t)}class ma{constructor(e,t,n,i){this.url=e,this.method=t,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Md(r){if(!r)throw da()}function Tw(r,e){function t(n,i){const s=Vd(r,i,e);return Md(s!==null),s}return t}function Iw(r,e){function t(n,i){const s=Vd(r,i,e);return Md(s!==null),Ew(s,i,r.host,r._protocol)}return t}function Ud(r){function e(t,n){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=VE():i=LE():t.getStatus()===402?i=OE(r.bucket):t.getStatus()===403?i=ME(r.path):i=n,i.status=t.getStatus(),i.serverResponse=n.serverResponse,i}return e}function Fd(r){const e=Ud(r);function t(n,i){let s=e(n,i);return n.getStatus()===404&&(s=xE(r.path)),s.serverResponse=i.serverResponse,s}return t}function bw(r,e,t){const n=e.fullServerUrl(),i=ss(n,r.host,r._protocol),s="GET",a=r.maxOperationRetryTime,c=new ma(i,s,Iw(r,t),a);return c.errorHandler=Fd(e),c}function Aw(r,e){const t=e.fullServerUrl(),n=ss(t,r.host,r._protocol),i="DELETE",s=r.maxOperationRetryTime;function a(l,h){}const c=new ma(n,i,a,s);return c.successCodes=[200,204],c.errorHandler=Fd(e),c}function Rw(r,e){return r&&r.contentType||e&&e.type()||"application/octet-stream"}function Cw(r,e,t){const n=Object.assign({},t);return n.fullPath=r.path,n.size=e.size(),n.contentType||(n.contentType=Rw(null,e)),n}function Sw(r,e,t,n,i){const s=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};function c(){let V="";for(let z=0;z<2;z++)V=V+Math.random().toString().slice(2);return V}const l=c();a["Content-Type"]="multipart/related; boundary="+l;const h=Cw(e,n,i),f=ww(h,t),m="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+f+`\r
--`+l+`\r
Content-Type: `+h.contentType+`\r
\r
`,_=`\r
--`+l+"--",T=vt.getBlob(m,n,_);if(T===null)throw jE();const R={name:h.fullPath},k=ss(s,r.host,r._protocol),S="POST",N=r.maxUploadRetryTime,O=new ma(k,S,Tw(r,t),N);return O.urlParams=R,O.headers=a,O.body=T.uploadData(),O.errorHandler=Ud(e),O}class Pw{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Kt.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Kt.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Kt.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,i,s){if(this.sent_)throw Xn("cannot .send() more than once");if(Mt(e)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const a in s)s.hasOwnProperty(a)&&this.xhr_.setRequestHeader(a,s[a].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Xn("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Xn("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Xn("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Xn("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class kw extends Pw{initXhr(){this.xhr_.responseType="text"}}function ga(){return new kw}class Zt{constructor(e,t){this._service=e,t instanceof Oe?this._location=t:this._location=Oe.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Zt(e,t)}get root(){const e=new Oe(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Od(this._location.path)}get storage(){return this._service}get parent(){const e=pw(this._location.path);if(e===null)return null;const t=new Oe(this._location.bucket,e);return new Zt(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw WE(e)}}function Dw(r,e,t){r._throwIfRoot("uploadBytes");const n=Sw(r.storage,r._location,Ld(),new vt(e,!0),t);return r.storage.makeRequestWithTokens(n,ga).then(i=>({metadata:i,ref:r}))}function Nw(r){r._throwIfRoot("getDownloadURL");const e=bw(r.storage,r._location,Ld());return r.storage.makeRequestWithTokens(e,ga).then(t=>{if(t===null)throw $E();return t})}function xw(r){r._throwIfRoot("deleteObject");const e=Aw(r.storage,r._location);return r.storage.makeRequestWithTokens(e,ga)}function Ow(r,e){const t=mw(r._location.path,e),n=new Oe(r._location.bucket,t);return new Zt(r.storage,n)}function Lw(r){return/^[A-Za-z]+:\/\//.test(r)}function Vw(r,e){return new Zt(r,e)}function Bd(r,e){if(r instanceof _a){const t=r;if(t._bucket==null)throw zE();const n=new Zt(t,t._bucket);return e!=null?Bd(n,e):n}else return e!==void 0?Ow(r,e):r}function Mw(r,e){if(e&&Lw(e)){if(r instanceof _a)return Vw(r,e);throw wo("To use ref(service, url), the first argument must be a Storage instance.")}else return Bd(r,e)}function Xl(r,e){const t=e?.[Cd];return t==null?null:Oe.makeFromBucketSpec(t,r)}function Uw(r,e,t,n={}){r.host=`${e}:${t}`;const i=Mt(e);i&&(Io(`https://${r.host}/b`),bo("Storage",!0)),r._isUsingEmulator=!0,r._protocol=i?"https":"http";const{mockUserToken:s}=n;s&&(r._overrideAuthToken=typeof s=="string"?s:fu(s,r.app.options.projectId))}class _a{constructor(e,t,n,i,s,a=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=s,this._isUsingEmulator=a,this._bucket=null,this._host=Rd,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=DE,this._maxUploadRetryTime=NE,this._requests=new Set,i!=null?this._bucket=Oe.makeFromBucketSpec(i,this._host):this._bucket=Xl(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Oe.makeFromBucketSpec(this._url,e):this._bucket=Xl(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Ql("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Ql("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(Le(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Zt(this,e)}_makeRequest(e,t,n,i,s=!0){if(this._deleted)return new GE(Sd());{const a=iw(e,this._appId,n,i,t,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,t){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()}}const Yl="@firebase/storage",Jl="0.14.0";const qd="storage";function Fw(r,e,t){return r=fe(r),Dw(r,e,t)}function Bw(r){return r=fe(r),Nw(r)}function Zl(r){return r=fe(r),xw(r)}function Yn(r,e){return r=fe(r),Mw(r,e)}function qw(r=Co(),e){r=fe(r);const n=Mi(r,qd).getImmediate({identifier:e}),i=uu("storage");return i&&zw(n,...i),n}function zw(r,e,t,n={}){Uw(r,e,t,n)}function jw(r,{instanceIdentifier:e}){const t=r.getProvider("app").getImmediate(),n=r.getProvider("auth-internal"),i=r.getProvider("app-check-internal");return new _a(t,n,i,e,en)}function $w(){Qt(new St(qd,jw,"PUBLIC").setMultipleInstances(!0)),$e(Yl,Jl,""),$e(Yl,Jl,"esm2020")}$w();const Hw={apiKey:"AIzaSyDUNSU2dhAsbcADx5emo-7NELyhv8CXpdI",authDomain:"sampler-8acd6.firebaseapp.com",projectId:"sampler-8acd6",storageBucket:"sampler-8acd6.firebasestorage.app",messagingSenderId:"316723858534",appId:"1:316723858534:web:bb8d08854c112206a2b1a7"},ya=gu(Hw),Wt=a_(ya),Jn=hE(ya),Zn=qw(ya);class Ww{constructor(){this.localCache={}}async loadAll(){try{const e=await RE(uE(Jn,"soundBanks"));return this.localCache={},e.forEach(t=>{this.localCache[t.id]=t.data().samples||[]}),this.localCache}catch(e){return console.warn("BankService: Offline mode or Error",e),{}}}async createBank(e){if(this.localCache[e])return!1;this.localCache[e]=[];try{return await CE(Zr(Jn,"soundBanks",e),{createdAt:new Date,owner:Wt.currentUser?Wt.currentUser.uid:"anon",samples:[]}),!0}catch(t){return console.error("BankService: Create failed",t),delete this.localCache[e],!1}}async deleteBank(e){if(!Wt.currentUser)throw new Error("User not logged in");const t=this.localCache[e]||[];try{const n=t.map(i=>{let s;if(i.fullPath)s=Yn(Zn,i.fullPath);else if(i.url)try{const a=i.url.indexOf("/o/")+3,c=i.url.indexOf("?"),l=c>-1?i.url.substring(a,c):i.url.substring(a),h=decodeURIComponent(l);s=Yn(Zn,h)}catch{return console.warn("Impossibile estrarre path dall'URL:",i.name),Promise.resolve()}return s?Zl(s).catch(a=>{console.warn(`File ${i.name} gi rimosso o non trovato`,a)}):Promise.resolve()});return await Promise.all(n),await SE(Zr(Jn,"soundBanks",e)),delete this.localCache[e],!0}catch(n){return console.error("BankService: Delete bank failed",n),!1}}async addSample(e,t,n,i){if(!Wt.currentUser)throw new Error("User not logged in");const s=Yn(Zn,`users/${Wt.currentUser.uid}/${e}/${t}_${Date.now()}.wav`),a=await Fw(s,n),c=await Bw(a.ref),l={name:t,url:c,color:i,fullPath:a.ref.fullPath};return await Gl(Zr(Jn,"soundBanks",e),{samples:PE(l)}),this.localCache[e]&&this.localCache[e].push(l),l}async deleteSample(e,t){await Gl(Zr(Jn,"soundBanks",e),{samples:kE(t)});try{const n=t.fullPath?Yn(Zn,t.fullPath):Yn(Zn,t.url);await Zl(n)}catch(n){console.warn("File already gone from storage?",n)}this.localCache[e]&&(this.localCache[e]=this.localCache[e].filter(n=>n.name!==t.name))}}const Ct=new Ww;class Gw{constructor(){this.overlay=null,this.resolvePromise=null,this.els={},this.setupGlobalListeners()}ensureDom(){this.overlay&&document.body.contains(this.overlay)||(this.overlay=document.createElement("div"),this.overlay.className="modal-overlay",this.overlay.innerHTML=`
      <div class="modal-box">
        <div class="modal-header" id="modal-title">SYSTEM MESSAGE</div>
        <div class="modal-body" id="modal-message"></div>
        <input type="text" class="modal-input" id="modal-input" style="display:none;">
        <div class="modal-footer" id="modal-footer"></div>
      </div>
    `,document.body.appendChild(this.overlay),this.els={title:this.overlay.querySelector("#modal-title"),msg:this.overlay.querySelector("#modal-message"),input:this.overlay.querySelector("#modal-input"),footer:this.overlay.querySelector("#modal-footer")})}setupGlobalListeners(){document.addEventListener("keydown",e=>{if(!(!this.overlay||!this.overlay.classList.contains("active"))&&(e.key==="Escape"&&this.close(null),e.key==="Enter")){const t=this.els.footer?this.els.footer.querySelector(".btn-confirm"):null;t&&t.click()}})}show(e,t,n=""){return new Promise(i=>{this.ensureDom(),this.resolvePromise=i,this.els.msg.innerText=t,this.els.footer.innerHTML="",this.els.input.style.display="none",this.els.input.value="",e==="alert"?(this.els.title.innerText="ATTENTION",this.createBtn("OK","btn-confirm",()=>this.close(!0))):e==="confirm"?(this.els.title.innerText="CONFIRMATION",this.createBtn("CANCEL","btn-cancel",()=>this.close(!1)),this.createBtn("YES","btn-confirm",()=>this.close(!0))):e==="prompt"&&(this.els.title.innerText="INPUT REQUIRED",this.els.input.style.display="block",this.els.input.value=n,this.createBtn("CANCEL","btn-cancel",()=>this.close(null)),this.createBtn("OK","btn-confirm",()=>this.close(this.els.input.value))),requestAnimationFrame(()=>{this.overlay.classList.add("active"),e==="prompt"&&setTimeout(()=>{this.els.input.focus(),this.els.input.select()},50)})})}createBtn(e,t,n){const i=document.createElement("button");i.className=`modal-btn ${t}`,i.innerText=e,i.onclick=n,this.els.footer.appendChild(i)}close(e){this.overlay&&(this.overlay.classList.remove("active"),this.resolvePromise&&(this.resolvePromise(e),this.resolvePromise=null))}}const Ne=new Gw;function Kw(){const r=document.createElement("div");return r.className="command-buttons",[{id:"play-button",icon:"pixelart-icons-font-play"},{id:"pause-button",icon:"pixelart-icons-font-pause"},{id:"stop-button",isStop:!0}].forEach(t=>{const n=document.createElement("div");n.className="old-button",n.id=t.id,t.isStop?n.innerHTML=`
      <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <rect x="6" y="6" width="15" height="15" />
      </svg>
    `:n.innerHTML=`<i class="${t.icon}"></i>`,r.appendChild(n)}),r}function Hs(r,e){const t=document.createElement("div");t.className="knob-wrapper";const n=document.createElement("div");n.className="knob-label",n.innerText=e,n.id=`label-${r}`;const i=document.createElement("div");i.className="knob-body",i.id=`knob-${r}`,i.dataset.value=r==="vol"?.8:0;const s=document.createElement("div");s.className="knob-indicator";const a=r==="vol"?81:-135;s.style.transform=`translate(-50%, -100%) rotate(${a}deg)`;const c=document.createElement("div");return c.className="knob-value",c.id=`val-${r}`,c.innerText=r==="vol"?"80%":"--",i.appendChild(s),t.append(n,i,c),t}function Qw(){const r=document.createElement("div");r.className="fx-buttons-wrapper";const e=document.createElement("div");return e.className="fx-buttons",[{id:"reverse",img:"reverse.png",alt:"Reverse FX"},{id:"delay",img:"delay.png",alt:"Delay FX"},{id:"distortion",img:"distort.png",alt:"Distort FX"},{id:"bitcrush",img:"bitcrush.png",alt:"Bitcrush FX"}].forEach(n=>{const i=document.createElement("img");i.src=`./assets/img/${n.img}`,i.className="fx-img",i.draggable=!0,i.setAttribute("data-effect",n.id),i.alt=n.alt,i.addEventListener("dragstart",s=>{s.dataTransfer.setData("effectType",n.id),s.dataTransfer.effectAllowed="copy"}),e.appendChild(i)}),r.appendChild(e),r}function Xw(){const r=document.createElement("div");r.className="bpm-led-wrapper";const e=document.createElement("div");return e.id="bpm-led",e.className="bpm-led",e.innerText="tap BPM",r.appendChild(e),r}function Yw(){const r=document.createElement("div");r.className="sampler-wrapper";const e=document.createElement("div");e.className="sampler border-shadow",e.id="sample-drop";const t=document.createElement("div");t.id="waveform";const n=document.createElement("div");n.className="plus-wrapper",n.id="plus-wrapper",n.innerText="DROP A SAMPLE...",t.appendChild(n);const i=document.createElement("div");i.className="eq-grid",i.appendChild(eT()),e.append(t,i);const s=document.createElement("div");s.className="commands border-shadow";const a=document.createElement("div");a.className="loop-label",a.innerText="PLAYBACK";const c=Kw(),l=document.createElement("div");l.className="loop-label",l.innerText="LOOP";const h=document.createElement("div");h.className="loop-buttons",[{id:"d2-button",icon:"pixelart-icons-font-prev"},{id:"loop-button",icon:"pixelart-icons-font-reload"},{id:"x2-button",icon:"pixelart-icons-font-next"}].forEach(N=>{const O=document.createElement("div");O.className="old-button",O.id=N.id,O.innerHTML=`<i class="${N.icon}"></i>`,h.appendChild(O)});const m=document.createElement("div");m.className="loop-label",m.innerText="UTILS";const _=document.createElement("div");_.className="rec-buttons";const T=document.createElement("div");T.className="old-button",T.id="trim-btn",T.title="Trim Audio",T.innerHTML='<i class="pixelart-icons-font-cut"></i>';const R=document.createElement("div");R.className="old-button",R.id="export-btn",R.title="Export to WAV",R.innerHTML='<i class="pixelart-icons-font-download"></i>';const k=document.createElement("div");k.className="old-button",k.id="save-bank-btn",k.title="Save to Current Bank",k.innerHTML='<i class="pixelart-icons-font-save"></i>',_.append(T,k,R),s.append(a,c,l,h,m,_);const S=document.createElement("div");return S.className="master-strip border-shadow",S.innerHTML=`
  <div class="master-label">MASTER OUT</div>
  <div class="meter-container">
    <div id="meter-fill" class="meter-fill"></div>
  </div>
  <input type="range" id="master-vol-fader" class="master-fader" min="0" max="1.5" step="0.01" value="0.8">
`,r.append(e,s),r.append(S),r}function Jw(){const r=document.createElement("div");r.className="effects border-shadow";const e=document.createElement("div");e.className="fx-label",e.textContent="EFFECTS";const t=Qw(),n=document.createElement("div");n.className="knobs-rack hidden",n.id="knobs-rack",n.appendChild(Hs("p1","PARAM 1")),n.appendChild(Hs("p2","PARAM 2")),n.appendChild(Hs("vol","FX LEVEL"));const i=Xw();return r.append(e,t,n,i),r}function Zw(){const r=document.createElement("div");r.className="banks border-shadow";const e=document.createElement("div");e.className="banks-menu";const t=document.createElement("div");t.className="banks-label",t.innerText="CHOOSE A SOUNDBANK";const n=document.createElement("select");n.name="banks",n.id="banks",n.className="banks-dropdown",n.addEventListener("change",async c=>{const l=c.target.value;if(l&&l!=="__NEW_BANK__"?a.style.display="flex":a.style.display="none",l==="__NEW_BANK__"){const h=await Ne.show("prompt","Enter new Sound Bank name:");h&&h.trim()!==""?await Ct.createBank(h)?(To(),n.value=h,vn(h)):(await Ne.show("alert","Bank already exists or invalid name."),n.value="",a.style.display="none"):(n.value="",a.style.display="none")}else vn(l)}),e.append(t,n);const i=document.createElement("div");i.className="banks-content";const s=document.createElement("div");s.className="banks-footer";const a=document.createElement("div");return a.id="delete-bank-btn",a.className="old-button delete-bank-btn",a.innerText="DELETE BANK",a.style.display="none",a.addEventListener("click",async()=>{const c=n.value;if(!c||c==="__NEW_BANK__")return;await Ne.show("confirm",`PERMANENTLY DELETE
"${c}"?`)&&(await Ct.deleteBank(c)?(To(),vn(null),a.style.display="none",await Ne.show("alert","Bank deleted successfully.")):await Ne.show("alert","Error deleting bank."))}),s.appendChild(a),r.append(e,i,s),r}function eT(){const r=document.createElement("div");return r.id="sliders-wrapper",r.className="sliders-wrapper",Ks.map(e=>{const t=document.createElement("div");t.classList.add("eq-band");const n=document.createElement("input");n.classList.add("slider-eq"),n.type="range",n.min=-12,n.max=12,n.value=0,n.step=.1,n.style.pointerEvents="none",n.addEventListener("dblclick",()=>{n.value=0,n.dispatchEvent(new Event("input"))});const i=document.createElement("div");t.classList.add("eq-label"),i.textContent=tT(e),t.appendChild(n),t.appendChild(i),r.appendChild(t)}),r}function tT(r){return r>=1e3?`${r/1e3}kHz`:`${r} Hz`}function vn(r){const e=document.querySelector(".banks-content");if(!e||(e.innerHTML="",!r||r==="__NEW_BANK__"))return;(Ct.localCache[r]||[]).forEach(s=>{const a=document.createElement("div");a.classList.add("sample-pad"),a.textContent=s.name,a.style.borderBottom=`4px solid ${s.color}`,a.draggable=!0,a.addEventListener("dragstart",l=>{l.dataTransfer.setData("type","sample"),l.dataTransfer.setData("audioUrl",s.url),l.dataTransfer.effectAllowed="copy"});const c=document.createElement("div");c.className="pad-delete-btn",c.innerHTML='<i class="pixelart-icons-font-trash"></i>',c.title="Delete Sample",c.addEventListener("mousedown",l=>{l.stopPropagation()}),c.addEventListener("click",async l=>{if(l.stopPropagation(),l.preventDefault(),await Ne.show("confirm",`Delete "${s.name}"?`)){a.style.opacity="0.5",a.style.pointerEvents="none";try{await Ct.deleteSample(r,s),vn(r)}catch(f){console.error(f),alert("Errore durante l'eliminazione"),a.style.opacity="1"}}}),a.appendChild(c),e.appendChild(a)});const n=document.createElement("div");n.classList.add("sample-pad","add-sample-pad"),n.innerHTML="<span>+</span>",n.title="Add Sample from Disk";const i=document.createElement("input");i.type="file",i.accept="audio/*",i.style.display="none",n.addEventListener("click",()=>{n.classList.contains("loading")||i.click()}),i.addEventListener("change",async s=>{const a=s.target.files[0];if(!a)return;const c=a.name.replace(/\.[^/.]+$/,"");let l=await Ne.show("prompt","Rename your sample:",c);if(l===null){i.value="";return}l=l.trim(),l===""&&(l=c);let h=l;h.length>9&&(h=h.substring(0,9)+"."),n.classList.add("loading"),n.innerHTML='<i class="pixelart-icons-font-clock"></i>';try{const f=["var(--color-red)","var(--color-ambra)","var(--color-green)","var(--color-blu)"],m=f[Math.floor(Math.random()*f.length)];await Ct.addSample(r,h,a,m),vn(r)}catch(f){console.error(f),alert("Upload fallito"),n.classList.remove("loading"),n.innerHTML="<span>+</span>"}}),e.appendChild(n)}function To(){const r=document.getElementById("banks");if(!r)return;r.innerHTML="";const e=document.createElement("option");e.value="",e.textContent="-- SELECT SOUND BANK --",e.disabled=!0,e.selected=!0,e.hidden=!0,r.appendChild(e),Object.keys(Ct.localCache).forEach(n=>{const i=document.createElement("option");i.value=n,i.textContent=n,r.appendChild(i)});const t=document.createElement("option");t.value="__NEW_BANK__",t.textContent="+ CREATE NEW BANK",t.style.fontWeight="bold",t.style.color="var(--color-green)",r.appendChild(t)}function nT(){const r=document.createElement("div");r.className="info-wrapper";const e=document.createElement("div");e.className="info-btn",e.id="info-btn",e.innerHTML='<i class="pixelart-icons-font-info-box"></i>';const t=document.createElement("div");return t.className="info-panel border-shadow hidden",t.id="info-panel",t.innerHTML=`
    <div class="info-header">QUICK TUTORIAL</div>
    <div class="info-body">
      <p>> Select a Sound Bank, drag 'n drop sample to load it.</p>
      <p>> Highlight regions, drag 'n drop floppies to apply effects, use lateral curtains to define trim.</p>
      <p>> Double click to select and loop region.</p>
      <p>> Tap or insert BPM.</p>
      <hr class="info-divider">
      <div class="info-item"><i class="pixelart-icons-font-reload"></i> <span> toggle loop mode</span></div>
      <div class="info-item"><i class="pixelart-icons-font-prev"></i> <span> halve loop length</span></div>
      <div class="info-item"><i class="pixelart-icons-font-next"></i> <span> double loop length</span></div>
      <div class="info-item"><i class="pixelart-icons-font-cut"></i> <span> trim to curtains</span></div>
      <div class="info-item"><i class="pixelart-icons-font-save"></i> <span> save to current bank</span></div>
      <div class="info-item"><i class="pixelart-icons-font-download"></i> <span> export wav file</span></div>
      <div class="info-item"><i class="pixelart-icons-font-trash"></i> <span> delete sample</span></div>

    </div>
  `,e.addEventListener("click",()=>{t.classList.toggle("hidden"),e.classList.toggle("active")}),r.append(e,t),r}function rT(){const r=document.createElement("div");r.className="wrapper",r.appendChild(Yw()),r.appendChild(Jw()),r.appendChild(Zw()),r.appendChild(nT());const e=document.getElementById("root")||document.body;e.innerHTML="",e.appendChild(r),To()}function Se(r,e,t,n){return new(t||(t=Promise))((function(i,s){function a(h){try{l(n.next(h))}catch(f){s(f)}}function c(h){try{l(n.throw(h))}catch(f){s(f)}}function l(h){var f;h.done?i(h.value):(f=h.value,f instanceof t?f:new t((function(m){m(f)}))).then(a,c)}l((n=n.apply(r,e||[])).next())}))}let Dr=class{constructor(){this.listeners={}}on(e,t,n){if(this.listeners[e]||(this.listeners[e]=new Set),n?.once){const i=(...s)=>{this.un(e,i),t(...s)};return this.listeners[e].add(i),()=>this.un(e,i)}return this.listeners[e].add(t),()=>this.un(e,t)}un(e,t){var n;(n=this.listeners[e])===null||n===void 0||n.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach((n=>n(...t)))}};const ri={decode:function(r,e){return Se(this,void 0,void 0,(function*(){const t=new AudioContext({sampleRate:e});try{return yield t.decodeAudioData(r)}finally{t.close()}}))},createBuffer:function(r,e){if(!r||r.length===0)throw new Error("channelData must be a non-empty array");if(e<=0)throw new Error("duration must be greater than 0");if(typeof r[0]=="number"&&(r=[r]),!r[0]||r[0].length===0)throw new Error("channelData must contain non-empty channel arrays");(function(n){const i=n[0];if(i.some((s=>s>1||s<-1))){const s=i.length;let a=0;for(let c=0;c<s;c++){const l=Math.abs(i[c]);l>a&&(a=l)}for(const c of n)for(let l=0;l<s;l++)c[l]/=a}})(r);const t=r.map((n=>n instanceof Float32Array?n:Float32Array.from(n)));return{duration:e,length:t[0].length,sampleRate:t[0].length/e,numberOfChannels:t.length,getChannelData:n=>{const i=t[n];if(!i)throw new Error(`Channel ${n} not found`);return i},copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function zd(r,e){const t=e.xmlns?document.createElementNS(e.xmlns,r):document.createElement(r);for(const[n,i]of Object.entries(e))if(n==="children"&&i)for(const[s,a]of Object.entries(i))a instanceof Node?t.appendChild(a):typeof a=="string"?t.appendChild(document.createTextNode(a)):t.appendChild(zd(s,a));else n==="style"?Object.assign(t.style,i):n==="textContent"?t.textContent=i:t.setAttribute(n,i.toString());return t}function eu(r,e,t){const n=zd(r,e||{});return t?.appendChild(n),n}var iT=Object.freeze({__proto__:null,createElement:eu,default:eu});const sT={fetchBlob:function(r,e,t){return Se(this,void 0,void 0,(function*(){const n=yield fetch(r,t);if(n.status>=400)throw new Error(`Failed to fetch ${r}: ${n.status} (${n.statusText})`);return(function(i,s){Se(this,void 0,void 0,(function*(){if(!i.body||!i.headers)return;const a=i.body.getReader(),c=Number(i.headers.get("Content-Length"))||0;let l=0;const h=f=>{l+=f?.length||0;const m=Math.round(l/c*100);s(m)};try{for(;;){const f=yield a.read();if(f.done)break;h(f.value)}}catch(f){console.warn("Progress tracking error:",f)}}))})(n.clone(),e),n.blob()}))}};class oT extends Dr{constructor(e){super(),this.isExternalMedia=!1,e.media?(this.media=e.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),e.playbackRate!=null&&this.onMediaEvent("canplay",(()=>{e.playbackRate!=null&&(this.media.playbackRate=e.playbackRate)}),{once:!0})}onMediaEvent(e,t,n){return this.media.addEventListener(e,t,n),()=>this.media.removeEventListener(e,t,n)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}canPlayType(e){return this.media.canPlayType(e)!==""}setSrc(e,t){const n=this.getSrc();if(e&&n===e)return;this.revokeSrc();const i=t instanceof Blob&&(this.canPlayType(t.type)||!e)?URL.createObjectURL(t):e;if(n&&this.media.removeAttribute("src"),i||e)try{this.media.src=i}catch{this.media.src=e}}destroy(){this.isExternalMedia||(this.media.pause(),this.revokeSrc(),this.media.removeAttribute("src"),this.media.load(),this.media.remove())}setMediaElement(e){this.media=e}play(){return Se(this,void 0,void 0,(function*(){try{return yield this.media.play()}catch(e){if(e instanceof DOMException&&e.name==="AbortError")return;throw e}}))}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=Math.max(0,Math.min(e,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(e,t){t!=null&&(this.media.preservesPitch=t),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}}function Ws(r){return r<0?0:r>1?1:r}function aT({maxTop:r,maxBottom:e,halfHeight:t,vScale:n}){const i=Math.round(r*t*n);return{topHeight:i,totalHeight:i+Math.round(e*t*n)||1}}function cT({barAlign:r,halfHeight:e,topHeight:t,totalHeight:n,canvasHeight:i}){return r==="top"?0:r==="bottom"?i-n:e-t}function tu(r,e,t){const n=e-r.left,i=t-r.top;return[n/r.width,i/r.height]}function jd(r){return!!(r.barWidth||r.barGap||r.barAlign)}function nu(r,e){if(!jd(e))return r;const t=e.barWidth||.5,n=t+(e.barGap||t/2);return n===0?r:Math.floor(r/n)*n}function ru({scrollLeft:r,totalWidth:e,numCanvases:t}){if(e===0)return[0];const n=r/e,i=Math.floor(n*t);return[i-1,i,i+1]}function iu({scrollLeft:r,clientWidth:e,scrollWidth:t}){return t===0?{startX:0,endX:0}:{startX:r/t,endX:(r+e)/t}}class lT extends Dr{constructor(e,t){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.dragUnsubscribe=null,this.subscriptions=[],this.options=e;const n=this.parentFromOptionsContainer(e.container);this.parent=n;const[i,s]=this.initHtml();n.appendChild(i),this.container=i,this.scrollContainer=s.querySelector(".scroll"),this.wrapper=s.querySelector(".wrapper"),this.canvasWrapper=s.querySelector(".canvases"),this.progressWrapper=s.querySelector(".progress"),this.cursor=s.querySelector(".cursor"),t&&s.appendChild(t),this.initEvents()}parentFromOptionsContainer(e){let t;if(typeof e=="string"?t=document.querySelector(e):e instanceof HTMLElement&&(t=e),!t)throw new Error("Container not found");return t}initEvents(){if(this.wrapper.addEventListener("click",(e=>{const t=this.wrapper.getBoundingClientRect(),[n,i]=tu(t,e.clientX,e.clientY);this.emit("click",n,i)})),this.wrapper.addEventListener("dblclick",(e=>{const t=this.wrapper.getBoundingClientRect(),[n,i]=tu(t,e.clientX,e.clientY);this.emit("dblclick",n,i)})),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollContainer.addEventListener("scroll",(()=>{const{scrollLeft:e,scrollWidth:t,clientWidth:n}=this.scrollContainer,{startX:i,endX:s}=iu({scrollLeft:e,scrollWidth:t,clientWidth:n});this.emit("scroll",i,s,e,e+n)})),typeof ResizeObserver=="function"){const e=this.createDelay(100);this.resizeObserver=new ResizeObserver((()=>{e().then((()=>this.onContainerResize())).catch((()=>{}))})),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const e=this.parent.clientWidth;e===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=e,this.reRender(),this.emit("resize"))}initDrag(){this.dragUnsubscribe||(this.dragUnsubscribe=(function(e,t,n,i,s=3,a=0,c=100){if(!e)return()=>{};const l=new Map,h=matchMedia("(pointer: coarse)").matches;let f=()=>{};const m=_=>{if(_.button!==a||(l.set(_.pointerId,_),l.size>1))return;let T=_.clientX,R=_.clientY,k=!1;const S=Date.now(),N=M=>{if(M.defaultPrevented||l.size>1||h&&Date.now()-S<c)return;const E=M.clientX,g=M.clientY,y=E-T,I=g-R;if(k||Math.abs(y)>s||Math.abs(I)>s){M.preventDefault(),M.stopPropagation();const w=e.getBoundingClientRect(),{left:b,top:v}=w;k||(n?.(T-b,R-v),k=!0),t(y,I,E-b,g-v),T=E,R=g}},O=M=>{if(l.delete(M.pointerId),k){const E=M.clientX,g=M.clientY,y=e.getBoundingClientRect(),{left:I,top:w}=y;i?.(E-I,g-w)}f()},V=M=>{l.delete(M.pointerId),M.relatedTarget&&M.relatedTarget!==document.documentElement||O(M)},z=M=>{k&&(M.stopPropagation(),M.preventDefault())},F=M=>{M.defaultPrevented||l.size>1||k&&M.preventDefault()};document.addEventListener("pointermove",N),document.addEventListener("pointerup",O),document.addEventListener("pointerout",V),document.addEventListener("pointercancel",V),document.addEventListener("touchmove",F,{passive:!1}),document.addEventListener("click",z,{capture:!0}),f=()=>{document.removeEventListener("pointermove",N),document.removeEventListener("pointerup",O),document.removeEventListener("pointerout",V),document.removeEventListener("pointercancel",V),document.removeEventListener("touchmove",F),setTimeout((()=>{document.removeEventListener("click",z,{capture:!0})}),10)}};return e.addEventListener("pointerdown",m),()=>{f(),e.removeEventListener("pointerdown",m),l.clear()}})(this.wrapper,((e,t,n)=>{const i=this.wrapper.getBoundingClientRect().width;this.emit("drag",Ws(n/i))}),(e=>{this.isDragging=!0;const t=this.wrapper.getBoundingClientRect().width;this.emit("dragstart",Ws(e/t))}),(e=>{this.isDragging=!1;const t=this.wrapper.getBoundingClientRect().width;this.emit("dragend",Ws(e/t))})),this.subscriptions.push(this.dragUnsubscribe))}initHtml(){const e=document.createElement("div"),t=e.attachShadow({mode:"open"}),n=this.options.cspNonce&&typeof this.options.cspNonce=="string"?this.options.cspNonce.replace(/"/g,""):"";return t.innerHTML=`
      <style${n?` nonce="${n}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
          pointer-events: none;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[e,t]}setOptions(e){if(this.options.container!==e.container){const t=this.parentFromOptionsContainer(e.container);t.appendChild(this.container),this.parent=t}e.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=e,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(e){this.scrollContainer.scrollLeft=e}setScrollPercentage(e){const{scrollWidth:t}=this.scrollContainer,n=t*e;this.setScroll(n)}destroy(){var e;this.subscriptions.forEach((t=>t())),this.container.remove(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),(e=this.unsubscribeOnScroll)===null||e===void 0||e.forEach((t=>t())),this.unsubscribeOnScroll=[]}createDelay(e=10){let t,n;const i=()=>{t&&(clearTimeout(t),t=void 0),n&&(n(),n=void 0)};return this.timeouts.push(i),()=>new Promise(((s,a)=>{i(),n=a,t=setTimeout((()=>{t=void 0,n=void 0,s()}),e)}))}getHeight(e,t){var n;const i=((n=this.audioData)===null||n===void 0?void 0:n.numberOfChannels)||1;return(function({optionsHeight:s,optionsSplitChannels:a,parentHeight:c,numberOfChannels:l,defaultHeight:h=128}){if(s==null)return h;const f=Number(s);if(!isNaN(f))return f;if(s==="auto"){const m=c||h;return a?.every((_=>!_.overlay))?m/l:m}return h})({optionsHeight:e,optionsSplitChannels:t,parentHeight:this.parent.clientHeight,numberOfChannels:i,defaultHeight:128})}convertColorValues(e){return(function(t,n){if(!Array.isArray(t))return t||"";if(t.length===0)return"#999";if(t.length<2)return t[0]||"";const i=document.createElement("canvas"),s=i.getContext("2d"),a=i.height*n,c=s.createLinearGradient(0,0,0,a||n),l=1/(t.length-1);return t.forEach(((h,f)=>{c.addColorStop(f*l,h)})),c})(e,this.getPixelRatio())}getPixelRatio(){return e=window.devicePixelRatio,Math.max(1,e||1);var e}renderBarWaveform(e,t,n,i){const{width:s,height:a}=n.canvas,{halfHeight:c,barWidth:l,barRadius:h,barIndexScale:f,barSpacing:m}=(function({width:T,height:R,length:k,options:S,pixelRatio:N}){const O=R/2,V=S.barWidth?S.barWidth*N:1,z=S.barGap?S.barGap*N:S.barWidth?V/2:0,F=V+z||1;return{halfHeight:O,barWidth:V,barGap:z,barRadius:S.barRadius||0,barIndexScale:k>0?T/F/k:0,barSpacing:F}})({width:s,height:a,length:(e[0]||[]).length,options:t,pixelRatio:this.getPixelRatio()}),_=(function({channelData:T,barIndexScale:R,barSpacing:k,barWidth:S,halfHeight:N,vScale:O,canvasHeight:V,barAlign:z}){const F=T[0]||[],M=T[1]||F,E=F.length,g=[];let y=0,I=0,w=0;for(let b=0;b<=E;b++){const v=Math.round(b*R);if(v>y){const{topHeight:os,totalHeight:Nr}=aT({maxTop:I,maxBottom:w,halfHeight:N,vScale:O}),rn=cT({barAlign:z,halfHeight:N,topHeight:os,totalHeight:Nr,canvasHeight:V});g.push({x:y*k,y:rn,width:S,height:Nr}),y=v,I=0,w=0}const ge=Math.abs(F[b]||0),Fe=Math.abs(M[b]||0);ge>I&&(I=ge),Fe>w&&(w=Fe)}return g})({channelData:e,barIndexScale:f,barSpacing:m,barWidth:l,halfHeight:c,vScale:i,canvasHeight:a,barAlign:t.barAlign});n.beginPath();for(const T of _)h&&"roundRect"in n?n.roundRect(T.x,T.y,T.width,T.height,h):n.rect(T.x,T.y,T.width,T.height);n.fill(),n.closePath()}renderLineWaveform(e,t,n,i){const{width:s,height:a}=n.canvas,c=(function({channelData:l,width:h,height:f,vScale:m}){const _=f/2,T=l[0]||[];return[T,l[1]||T].map(((R,k)=>{const S=R.length,N=S?h/S:0,O=_,V=k===0?-1:1,z=[{x:0,y:O}];let F=0,M=0;for(let E=0;E<=S;E++){const g=Math.round(E*N);if(g>F){const I=O+(Math.round(M*_*m)||1)*V;z.push({x:F,y:I}),F=g,M=0}const y=Math.abs(R[E]||0);y>M&&(M=y)}return z.push({x:F,y:O}),z}))})({channelData:e,width:s,height:a,vScale:i});n.beginPath();for(const l of c)if(l.length){n.moveTo(l[0].x,l[0].y);for(let h=1;h<l.length;h++){const f=l[h];n.lineTo(f.x,f.y)}}n.fill(),n.closePath()}renderWaveform(e,t,n){if(n.fillStyle=this.convertColorValues(t.waveColor),t.renderFunction)return void t.renderFunction(e,n);const i=(function({channelData:s,barHeight:a,normalize:c}){var l;const h=a||1;if(!c)return h;const f=s[0];if(!f||f.length===0)return h;let m=0;for(let _=0;_<f.length;_++){const T=(l=f[_])!==null&&l!==void 0?l:0,R=Math.abs(T);R>m&&(m=R)}return m?h/m:h})({channelData:e,barHeight:t.barHeight,normalize:t.normalize});jd(t)?this.renderBarWaveform(e,t,n,i):this.renderLineWaveform(e,t,n,i)}renderSingleCanvas(e,t,n,i,s,a,c){const l=this.getPixelRatio(),h=document.createElement("canvas");h.width=Math.round(n*l),h.height=Math.round(i*l),h.style.width=`${n}px`,h.style.height=`${i}px`,h.style.left=`${Math.round(s)}px`,a.appendChild(h);const f=h.getContext("2d");if(t.renderFunction?(f.fillStyle=this.convertColorValues(t.waveColor),t.renderFunction(e,f)):this.renderWaveform(e,t,f),h.width>0&&h.height>0){const m=h.cloneNode(),_=m.getContext("2d");_.drawImage(h,0,0),_.globalCompositeOperation="source-in",_.fillStyle=this.convertColorValues(t.progressColor),_.fillRect(0,0,h.width,h.height),c.appendChild(m)}}renderMultiCanvas(e,t,n,i,s,a){const c=this.getPixelRatio(),{clientWidth:l}=this.scrollContainer,h=n/c,f=(function({clientWidth:R,totalWidth:k,options:S}){return nu(Math.min(8e3,R,k),S)})({clientWidth:l,totalWidth:h,options:t});let m={};if(f===0)return;const _=R=>{if(R<0||R>=T||m[R])return;m[R]=!0;const k=R*f;let S=Math.min(h-k,f);if(S=nu(S,t),S<=0)return;const N=(function({channelData:O,offset:V,clampedWidth:z,totalWidth:F}){return O.map((M=>{const E=Math.floor(V/F*M.length),g=Math.floor((V+z)/F*M.length);return M.slice(E,g)}))})({channelData:e,offset:k,clampedWidth:S,totalWidth:h});this.renderSingleCanvas(N,t,S,i,k,s,a)},T=Math.ceil(h/f);if(!this.isScrollable){for(let R=0;R<T;R++)_(R);return}if(ru({scrollLeft:this.scrollContainer.scrollLeft,totalWidth:h,numCanvases:T}).forEach((R=>_(R))),T>1){const R=this.on("scroll",(()=>{const{scrollLeft:k}=this.scrollContainer;Object.keys(m).length>10&&(s.innerHTML="",a.innerHTML="",m={}),ru({scrollLeft:k,totalWidth:h,numCanvases:T}).forEach((S=>_(S)))}));this.unsubscribeOnScroll.push(R)}}renderChannel(e,t,n,i){var{overlay:s}=t,a=(function(f,m){var _={};for(var T in f)Object.prototype.hasOwnProperty.call(f,T)&&m.indexOf(T)<0&&(_[T]=f[T]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function"){var R=0;for(T=Object.getOwnPropertySymbols(f);R<T.length;R++)m.indexOf(T[R])<0&&Object.prototype.propertyIsEnumerable.call(f,T[R])&&(_[T[R]]=f[T[R]])}return _})(t,["overlay"]);const c=document.createElement("div"),l=this.getHeight(a.height,a.splitChannels);c.style.height=`${l}px`,s&&i>0&&(c.style.marginTop=`-${l}px`),this.canvasWrapper.style.minHeight=`${l}px`,this.canvasWrapper.appendChild(c);const h=c.cloneNode();this.progressWrapper.appendChild(h),this.renderMultiCanvas(e,a,n,l,c,h)}render(e){return Se(this,void 0,void 0,(function*(){var t;this.timeouts.forEach((h=>h())),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);const n=this.getPixelRatio(),i=this.scrollContainer.clientWidth,{scrollWidth:s,isScrollable:a,useParentWidth:c,width:l}=(function({duration:h,minPxPerSec:f=0,parentWidth:m,fillParent:_,pixelRatio:T}){const R=Math.ceil(h*f),k=R>m,S=!!(_&&!k);return{scrollWidth:R,isScrollable:k,useParentWidth:S,width:(S?m:R)*T}})({duration:e.duration,minPxPerSec:this.options.minPxPerSec||0,parentWidth:i,fillParent:this.options.fillParent,pixelRatio:n});if(this.isScrollable=a,this.wrapper.style.width=c?"100%":`${s}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=e,this.emit("render"),this.options.splitChannels)for(let h=0;h<e.numberOfChannels;h++){const f=Object.assign(Object.assign({},this.options),(t=this.options.splitChannels)===null||t===void 0?void 0:t[h]);this.renderChannel([e.getChannelData(h)],f,l,h)}else{const h=[e.getChannelData(0)];e.numberOfChannels>1&&h.push(e.getChannelData(1)),this.renderChannel(h,this.options,l,0)}Promise.resolve().then((()=>this.emit("rendered")))}))}reRender(){if(this.unsubscribeOnScroll.forEach((n=>n())),this.unsubscribeOnScroll=[],!this.audioData)return;const{scrollWidth:e}=this.scrollContainer,{right:t}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&e!==this.scrollContainer.scrollWidth){const{right:n}=this.progressWrapper.getBoundingClientRect(),i=(function(s){const a=2*s;return(a<0?Math.floor(a):Math.ceil(a))/2})(n-t);this.scrollContainer.scrollLeft+=i}}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e,t=!1){const{scrollLeft:n,scrollWidth:i,clientWidth:s}=this.scrollContainer,a=e*i,c=n,l=n+s,h=s/2;if(this.isDragging)a+30>l?this.scrollContainer.scrollLeft+=30:a-30<c&&(this.scrollContainer.scrollLeft-=30);else{(a<c||a>l)&&(this.scrollContainer.scrollLeft=a-(this.options.autoCenter?h:0));const f=a-n-h;t&&this.options.autoCenter&&f>0&&(this.scrollContainer.scrollLeft+=f)}{const f=this.scrollContainer.scrollLeft,{startX:m,endX:_}=iu({scrollLeft:f,scrollWidth:i,clientWidth:s});this.emit("scroll",m,_,f,f+s)}}renderProgress(e,t){if(isNaN(e))return;const n=100*e;this.canvasWrapper.style.clipPath=`polygon(${n}% 0%, 100% 0%, 100% 100%, ${n}% 100%)`,this.progressWrapper.style.width=`${n}%`,this.cursor.style.left=`${n}%`,this.cursor.style.transform=this.options.cursorWidth?`translateX(-${e*this.options.cursorWidth}px)`:"",this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(e,t)}exportImage(e,t,n){return Se(this,void 0,void 0,(function*(){const i=this.canvasWrapper.querySelectorAll("canvas");if(!i.length)throw new Error("No waveform data");if(n==="dataURL"){const s=Array.from(i).map((a=>a.toDataURL(e,t)));return Promise.resolve(s)}return Promise.all(Array.from(i).map((s=>new Promise(((a,c)=>{s.toBlob((l=>{l?a(l):c(new Error("Could not export image"))}),e,t)})))))}))}}class uT extends Dr{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;const e=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(e))};e()}stop(){this.isRunning=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}class Gs extends Dr{constructor(e=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return Se(this,void 0,void 0,(function*(){}))}get src(){return this.currentSrc}set src(e){if(this.currentSrc=e,this._duration=void 0,!e)return this.buffer=null,void this.emit("emptied");fetch(e).then((t=>{if(t.status>=400)throw new Error(`Failed to fetch ${e}: ${t.status} (${t.statusText})`);return t.arrayBuffer()})).then((t=>this.currentSrc!==e?null:this.audioContext.decodeAudioData(t))).then((t=>{this.currentSrc===e&&(this.buffer=t,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})).catch((t=>{console.error("WebAudioPlayer load error:",t)}))}_play(){if(!this.paused)return;this.paused=!1,this.bufferNode&&(this.bufferNode.onended=null,this.bufferNode.disconnect()),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let e=this.playedDuration*this._playbackRate;(e>=this.duration||e<0)&&(e=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,e),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var e;this.paused=!0,(e=this.bufferNode)===null||e===void 0||e.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return Se(this,void 0,void 0,(function*(){this.paused&&(this._play(),this.emit("play"))}))}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(e){const t=e-this.currentTime,n=this.bufferNode;n?.stop(this.audioContext.currentTime+t),n?.addEventListener("ended",(()=>{n===this.bufferNode&&(this.bufferNode=null,this.pause())}),{once:!0})}setSinkId(e){return Se(this,void 0,void 0,(function*(){return this.audioContext.setSinkId(e)}))}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this.bufferNode&&(this.bufferNode.playbackRate.value=e)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(e){const t=!this.paused;t&&this._pause(),this.playedDuration=e/this._playbackRate,t&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var e,t;return(e=this._duration)!==null&&e!==void 0?e:((t=this.buffer)===null||t===void 0?void 0:t.duration)||0}set duration(e){this._duration=e}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.value=e,this.emit("volumechange")}get muted(){return this._muted}set muted(e){this._muted!==e&&(this._muted=e,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(e){return/^(audio|video)\//.test(e)}getGainNode(){return this.gainNode}getChannelData(){const e=[];if(!this.buffer)return e;const t=this.buffer.numberOfChannels;for(let n=0;n<t;n++)e.push(this.buffer.getChannelData(n));return e}removeAttribute(e){switch(e){case"src":this.src="";break;case"playbackRate":this.playbackRate=0;break;case"currentTime":this.currentTime=0;break;case"duration":this.duration=0;break;case"volume":this.volume=0;break;case"muted":this.muted=!1}}}const hT={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class yr extends oT{static create(e){return new yr(e)}constructor(e){const t=e.media||(e.backend==="WebAudio"?new Gs:void 0);super({media:t,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},hT,e),this.timer=new uT;const n=t?void 0:this.getMediaElement();this.renderer=new lT(this.options,n),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const i=this.options.url||this.getSrc()||"";Promise.resolve().then((()=>{this.emit("init");const{peaks:s,duration:a}=this.options;(i||s&&a)&&this.load(i,s,a).catch((c=>{this.emit("error",c instanceof Error?c:new Error(String(c)))}))}))}updateProgress(e=this.getCurrentTime()){return this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),e}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",(()=>{if(!this.isSeeking()){const e=this.updateProgress();this.emit("timeupdate",e),this.emit("audioprocess",e),this.stopAtPosition!=null&&this.isPlaying()&&e>=this.stopAtPosition&&this.pause()}})))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",(()=>{const e=this.updateProgress();this.emit("timeupdate",e)})),this.onMediaEvent("play",(()=>{this.emit("play"),this.timer.start()})),this.onMediaEvent("pause",(()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("emptied",(()=>{this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("ended",(()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null})),this.onMediaEvent("seeking",(()=>{this.emit("seeking",this.getCurrentTime())})),this.onMediaEvent("error",(()=>{var e;this.emit("error",(e=this.getMediaElement().error)!==null&&e!==void 0?e:new Error("Media error")),this.stopAtPosition=null})))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",((e,t)=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",e*this.getDuration()),this.emit("click",e,t))})),this.renderer.on("dblclick",((e,t)=>{this.emit("dblclick",e,t)})),this.renderer.on("scroll",((e,t,n,i)=>{const s=this.getDuration();this.emit("scroll",e*s,t*s,n,i)})),this.renderer.on("render",(()=>{this.emit("redraw")})),this.renderer.on("rendered",(()=>{this.emit("redrawcomplete")})),this.renderer.on("dragstart",(e=>{this.emit("dragstart",e)})),this.renderer.on("dragend",(e=>{this.emit("dragend",e)})),this.renderer.on("resize",(()=>{this.emit("resize")})));{let e;const t=this.renderer.on("drag",(n=>{var i;if(!this.options.interact)return;this.renderer.renderProgress(n),clearTimeout(e);let s=0;const a=this.options.dragToSeek;this.isPlaying()?s=0:a===!0?s=200:a&&typeof a=="object"&&(s=(i=a.debounceTime)!==null&&i!==void 0?i:200),e=setTimeout((()=>{this.seekTo(n)}),s),this.emit("interaction",n*this.getDuration()),this.emit("drag",n)}));this.subscriptions.push((()=>{clearTimeout(e),t()}))}}initPlugins(){var e;!((e=this.options.plugins)===null||e===void 0)&&e.length&&this.options.plugins.forEach((t=>{this.registerPlugin(t)}))}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((e=>e())),this.mediaSubscriptions=[]}setOptions(e){this.options=Object.assign({},this.options,e),e.duration&&!e.peaks&&(this.decodedData=ri.createBuffer(this.exportPeaks(),e.duration)),e.peaks&&e.duration&&(this.decodedData=ri.createBuffer(e.peaks,e.duration)),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),e.mediaControls!=null&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){if(this.plugins.includes(e))return e;e._init(this),this.plugins.push(e);const t=e.once("destroy",(()=>{this.plugins=this.plugins.filter((n=>n!==e)),this.subscriptions=this.subscriptions.filter((n=>n!==t))}));return this.subscriptions.push(t),e}unregisterPlugin(e){this.plugins=this.plugins.filter((t=>t!==e)),e.destroy()}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(e){return this.renderer.setScroll(e)}setScrollTime(e){const t=e/this.getDuration();this.renderer.setScrollPercentage(t)}getActivePlugins(){return this.plugins}loadAudio(e,t,n,i){return Se(this,void 0,void 0,(function*(){var s;if(this.emit("load",e),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,(s=this.abortController)===null||s===void 0||s.abort(),this.abortController=null,!t&&!n){const c=this.options.fetchParams||{};window.AbortController&&!c.signal&&(this.abortController=new AbortController,c.signal=this.abortController.signal);const l=f=>this.emit("loading",f);t=yield sT.fetchBlob(e,l,c);const h=this.options.blobMimeType;h&&(t=new Blob([t],{type:h}))}this.setSrc(e,t);const a=yield new Promise((c=>{const l=i||this.getDuration();l?c(l):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",(()=>c(this.getDuration())),{once:!0}))}));if(!e&&!t){const c=this.getMediaElement();c instanceof Gs&&(c.duration=a)}if(n)this.decodedData=ri.createBuffer(n,a||0);else if(t){const c=yield t.arrayBuffer();this.decodedData=yield ri.decode(c,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())}))}load(e,t,n){return Se(this,void 0,void 0,(function*(){try{return yield this.loadAudio(e,void 0,t,n)}catch(i){throw this.emit("error",i),i}}))}loadBlob(e,t,n){return Se(this,void 0,void 0,(function*(){try{return yield this.loadAudio("",e,t,n)}catch(i){throw this.emit("error",i),i}}))}zoom(e){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks({channels:e=2,maxLength:t=8e3,precision:n=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const i=Math.min(e,this.decodedData.numberOfChannels),s=[];for(let a=0;a<i;a++){const c=this.decodedData.getChannelData(a),l=[],h=c.length/t;for(let f=0;f<t;f++){const m=c.slice(Math.floor(f*h),Math.ceil((f+1)*h));let _=0;for(let T=0;T<m.length;T++){const R=m[T];Math.abs(R)>Math.abs(_)&&(_=R)}l.push(Math.round(_*n)/n)}s.push(l)}return s}getDuration(){let e=super.getDuration()||0;return e!==0&&e!==1/0||!this.decodedData||(e=this.decodedData.duration),e}toggleInteraction(e){this.options.interact=e}setTime(e){this.stopAtPosition=null,super.setTime(e),this.updateProgress(e),this.emit("timeupdate",e)}seekTo(e){const t=this.getDuration()*e;this.setTime(t)}play(e,t){const n=Object.create(null,{play:{get:()=>super.play}});return Se(this,void 0,void 0,(function*(){e!=null&&this.setTime(e);const i=yield n.play.call(this);return t!=null&&(this.media instanceof Gs?this.media.stopAt(t):this.stopAtPosition=t),i}))}playPause(){return Se(this,void 0,void 0,(function*(){return this.isPlaying()?this.pause():this.play()}))}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}setMediaElement(e){this.unsubscribePlayerEvents(),super.setMediaElement(e),this.initPlayerEvents()}exportImage(){return Se(this,arguments,void 0,(function*(e="image/png",t=1,n="dataURL"){return this.renderer.exportImage(e,t,n)}))}destroy(){var e;this.emit("destroy"),(e=this.abortController)===null||e===void 0||e.abort(),this.plugins.forEach((t=>t.destroy())),this.subscriptions.forEach((t=>t())),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}yr.BasePlugin=class extends Dr{constructor(r){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=r}onInit(){}_init(r){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=r,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((r=>r())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}},yr.dom=iT;class $d{constructor(){this.listeners={}}on(e,t,n){if(this.listeners[e]||(this.listeners[e]=new Set),n?.once){const i=(...s)=>{this.un(e,i),t(...s)};return this.listeners[e].add(i),()=>this.un(e,i)}return this.listeners[e].add(t),()=>this.un(e,t)}un(e,t){var n;(n=this.listeners[e])===null||n===void 0||n.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach((n=>n(...t)))}}class dT extends $d{constructor(e){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=e}onInit(){}_init(e){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((e=>e())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}function mi(r,e,t,n,i=3,s=0,a=100){if(!r)return()=>{};const c=new Map,l=matchMedia("(pointer: coarse)").matches;let h=()=>{};const f=m=>{if(m.button!==s||(c.set(m.pointerId,m),c.size>1))return;let _=m.clientX,T=m.clientY,R=!1;const k=Date.now(),S=F=>{if(F.defaultPrevented||c.size>1||l&&Date.now()-k<a)return;const M=F.clientX,E=F.clientY,g=M-_,y=E-T;if(R||Math.abs(g)>i||Math.abs(y)>i){F.preventDefault(),F.stopPropagation();const I=r.getBoundingClientRect(),{left:w,top:b}=I;R||(t?.(_-w,T-b),R=!0),e(g,y,M-w,E-b),_=M,T=E}},N=F=>{if(c.delete(F.pointerId),R){const M=F.clientX,E=F.clientY,g=r.getBoundingClientRect(),{left:y,top:I}=g;n?.(M-y,E-I)}h()},O=F=>{c.delete(F.pointerId),F.relatedTarget&&F.relatedTarget!==document.documentElement||N(F)},V=F=>{R&&(F.stopPropagation(),F.preventDefault())},z=F=>{F.defaultPrevented||c.size>1||R&&F.preventDefault()};document.addEventListener("pointermove",S),document.addEventListener("pointerup",N),document.addEventListener("pointerout",O),document.addEventListener("pointercancel",O),document.addEventListener("touchmove",z,{passive:!1}),document.addEventListener("click",V,{capture:!0}),h=()=>{document.removeEventListener("pointermove",S),document.removeEventListener("pointerup",N),document.removeEventListener("pointerout",O),document.removeEventListener("pointercancel",O),document.removeEventListener("touchmove",z),setTimeout((()=>{document.removeEventListener("click",V,{capture:!0})}),10)}};return r.addEventListener("pointerdown",f),()=>{h(),r.removeEventListener("pointerdown",f),c.clear()}}function Hd(r,e){const t=e.xmlns?document.createElementNS(e.xmlns,r):document.createElement(r);for(const[n,i]of Object.entries(e))if(n==="children"&&i)for(const[s,a]of Object.entries(i))a instanceof Node?t.appendChild(a):typeof a=="string"?t.appendChild(document.createTextNode(a)):t.appendChild(Hd(s,a));else n==="style"?Object.assign(t.style,i):n==="textContent"?t.textContent=i:t.setAttribute(n,i.toString());return t}function ir(r,e,t){const n=Hd(r,e||{});return t?.appendChild(n),n}class su extends $d{constructor(e,t,n=0){var i,s,a,c,l,h,f,m,_,T;super(),this.totalDuration=t,this.numberOfChannels=n,this.element=null,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.updatingSide=void 0,this.isRemoved=!1,this.subscriptions=[],this.id=e.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(e.start),this.end=this.clampPosition((i=e.end)!==null&&i!==void 0?i:e.start),this.drag=(s=e.drag)===null||s===void 0||s,this.resize=(a=e.resize)===null||a===void 0||a,this.resizeStart=(c=e.resizeStart)===null||c===void 0||c,this.resizeEnd=(l=e.resizeEnd)===null||l===void 0||l,this.color=(h=e.color)!==null&&h!==void 0?h:"rgba(0, 0, 0, 0.1)",this.minLength=(f=e.minLength)!==null&&f!==void 0?f:this.minLength,this.maxLength=(m=e.maxLength)!==null&&m!==void 0?m:this.maxLength,this.channelIdx=(_=e.channelIdx)!==null&&_!==void 0?_:-1,this.contentEditable=(T=e.contentEditable)!==null&&T!==void 0?T:this.contentEditable,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){var e;const t=this.start===this.end;(e=this.element)===null||e===void 0||e.setAttribute("part",`${t?"marker":"region"} ${this.id}`)}addResizeHandles(e){const t={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},n=ir("div",{part:"region-handle region-handle-left",style:Object.assign(Object.assign({},t),{left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"})},e),i=ir("div",{part:"region-handle region-handle-right",style:Object.assign(Object.assign({},t),{right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"})},e);this.subscriptions.push(mi(n,(s=>this.onResize(s,"start")),(()=>null),(()=>this.onEndResizing("start")),1),mi(i,(s=>this.onResize(s,"end")),(()=>null),(()=>this.onEndResizing("end")),1))}removeResizeHandles(e){const t=e.querySelector('[part*="region-handle-left"]'),n=e.querySelector('[part*="region-handle-right"]');t&&e.removeChild(t),n&&e.removeChild(n)}initElement(){if(this.isRemoved)return null;const e=this.start===this.end;let t=0,n=100;this.channelIdx>=0&&this.numberOfChannels>0&&this.channelIdx<this.numberOfChannels&&(n=100/this.numberOfChannels,t=n*this.channelIdx);const i=ir("div",{style:{position:"absolute",top:`${t}%`,height:`${n}%`,backgroundColor:e?"none":this.color,borderLeft:e?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!e&&this.resize&&this.addResizeHandles(i),i}renderPosition(){if(!this.element)return;const e=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*e+"%",this.element.style.right=100*t+"%"}toggleCursor(e){var t;this.drag&&(!((t=this.element)===null||t===void 0)&&t.style)&&(this.element.style.cursor=e?"grabbing":"grab")}initMouseEvents(){const{element:e}=this;e&&(e.addEventListener("click",(t=>this.emit("click",t))),e.addEventListener("mouseenter",(t=>this.emit("over",t))),e.addEventListener("mouseleave",(t=>this.emit("leave",t))),e.addEventListener("dblclick",(t=>this.emit("dblclick",t))),e.addEventListener("pointerdown",(()=>this.toggleCursor(!0))),e.addEventListener("pointerup",(()=>this.toggleCursor(!1))),this.subscriptions.push(mi(e,(t=>this.onMove(t)),(()=>this.toggleCursor(!0)),(()=>{this.toggleCursor(!1),this.drag&&this.emit("update-end")}))),this.contentEditable&&this.content&&(this.contentClickListener=t=>this.onContentClick(t),this.contentBlurListener=()=>this.onContentBlur(),this.content.addEventListener("click",this.contentClickListener),this.content.addEventListener("blur",this.contentBlurListener)))}_onUpdate(e,t,n){var i;if(!(!((i=this.element)===null||i===void 0)&&i.parentElement))return;const{width:s}=this.element.parentElement.getBoundingClientRect(),a=e/s*this.totalDuration;let c=t&&t!=="start"?this.start:this.start+a,l=t&&t!=="end"?this.end:this.end+a;const h=n!==void 0;h&&this.updatingSide&&this.updatingSide!==t&&(this.updatingSide==="start"?c=n:l=n),c=Math.max(0,c),l=Math.min(this.totalDuration,l);const f=l-c;this.updatingSide=t;const m=f>=this.minLength&&f<=this.maxLength;c<=l&&(m||h)&&(this.start=c,this.end=l,this.renderPosition(),this.emit("update",t))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,t){this.resize&&(this.resizeStart||t!=="start")&&(this.resizeEnd||t!=="end")&&this._onUpdate(e,t)}onEndResizing(e){this.resize&&(this.emit("update-end",e),this.updatingSide=void 0)}onContentClick(e){e.stopPropagation(),e.target.focus(),this.emit("click",e)}onContentBlur(){this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(e){this.emit("play",e&&this.end!==this.start?this.end:void 0)}getContent(e=!1){var t;return e?this.content||void 0:this.element instanceof HTMLElement?((t=this.content)===null||t===void 0?void 0:t.innerHTML)||void 0:""}setContent(e){var t;if(this.element)if(this.content&&this.contentEditable&&(this.contentClickListener&&this.content.removeEventListener("click",this.contentClickListener),this.contentBlurListener&&this.content.removeEventListener("blur",this.contentBlurListener)),(t=this.content)===null||t===void 0||t.remove(),e){if(typeof e=="string"){const n=this.start===this.end;this.content=ir("div",{style:{padding:`0.2em ${n?.2:.4}em`,display:"inline-block"},textContent:e})}else this.content=e;this.contentEditable&&(this.content.contentEditable="true",this.contentClickListener=n=>this.onContentClick(n),this.contentBlurListener=()=>this.onContentBlur(),this.content.addEventListener("click",this.contentClickListener),this.content.addEventListener("blur",this.contentBlurListener)),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content),this.emit("content-changed")}else this.content=void 0}setOptions(e){var t,n;if(this.element){if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),e.drag!==void 0&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),e.start!==void 0||e.end!==void 0){const i=this.start===this.end;this.start=this.clampPosition((t=e.start)!==null&&t!==void 0?t:this.start),this.end=this.clampPosition((n=e.end)!==null&&n!==void 0?n:i?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),e.resize!==void 0&&e.resize!==this.resize){const i=this.start===this.end;this.resize=e.resize,this.resize&&!i?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}e.resizeStart!==void 0&&(this.resizeStart=e.resizeStart),e.resizeEnd!==void 0&&(this.resizeEnd=e.resizeEnd)}}remove(){this.isRemoved=!0,this.emit("remove"),this.subscriptions.forEach((e=>e())),this.element&&(this.element.remove(),this.element=null)}}class va extends dT{constructor(e){super(e),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(e){return new va(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer),this.subscriptions.push(this.wavesurfer.on("ready",(t=>{this.regions.forEach((n=>n._setTotalDuration(t)))})));let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",(t=>{const n=this.regions.filter((i=>i.start<=t&&(i.end===i.start?i.start+.05:i.end)>=t));n.forEach((i=>{e.includes(i)||this.emit("region-in",i)})),e.forEach((i=>{n.includes(i)||this.emit("region-out",i)})),e=n})))}initRegionsContainer(){return ir("div",{part:"regions-container",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"5",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(e){e.content&&setTimeout((()=>{const t=e.content,n=t.getBoundingClientRect(),i=this.regions.map((s=>{if(s===e||!s.content)return 0;const a=s.content.getBoundingClientRect();return n.left<a.left+a.width&&a.left<n.left+n.width?a.height:0})).reduce(((s,a)=>s+a),0);t.style.marginTop=`${i}px`}),10)}adjustScroll(e){var t,n;if(!e.element)return;const i=(n=(t=this.wavesurfer)===null||t===void 0?void 0:t.getWrapper())===null||n===void 0?void 0:n.parentElement;if(!i)return;const{clientWidth:s,scrollWidth:a}=i;if(a<=s)return;const c=i.getBoundingClientRect(),l=e.element.getBoundingClientRect(),h=l.left-c.left,f=l.right-c.left;h<0?i.scrollLeft+=h:f>s&&(i.scrollLeft+=f-s)}virtualAppend(e,t,n){const i=()=>{if(!this.wavesurfer)return;const s=this.wavesurfer.getWidth(),a=this.wavesurfer.getScroll(),c=t.clientWidth,l=this.wavesurfer.getDuration(),h=Math.round(e.start/l*c),f=h+(Math.round((e.end-e.start)/l*c)||1)>a&&h<a+s;f&&!n.parentElement?t.appendChild(n):!f&&n.parentElement&&n.remove()};setTimeout((()=>{if(!this.wavesurfer||!e.element)return;i();const s=this.wavesurfer.on("scroll",i),a=this.wavesurfer.on("zoom",i),c=this.wavesurfer.on("resize",i);this.subscriptions.push(s,a,c),e.once("remove",(()=>{s(),a(),c()}))}),0)}saveRegion(e){if(!e.element)return;this.virtualAppend(e,this.regionsContainer,e.element),this.avoidOverlapping(e),this.regions.push(e);const t=[e.on("update",(n=>{n||this.adjustScroll(e),this.emit("region-update",e,n)})),e.on("update-end",(n=>{this.avoidOverlapping(e),this.emit("region-updated",e,n)})),e.on("play",(n=>{var i;(i=this.wavesurfer)===null||i===void 0||i.play(e.start,n)})),e.on("click",(n=>{this.emit("region-clicked",e,n)})),e.on("dblclick",(n=>{this.emit("region-double-clicked",e,n)})),e.on("content-changed",(()=>{this.emit("region-content-changed",e)})),e.once("remove",(()=>{t.forEach((n=>n())),this.regions=this.regions.filter((n=>n!==e)),this.emit("region-removed",e)}))];this.subscriptions.push(...t),this.emit("region-created",e)}addRegion(e){var t,n;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const i=this.wavesurfer.getDuration(),s=(n=(t=this.wavesurfer)===null||t===void 0?void 0:t.getDecodedData())===null||n===void 0?void 0:n.numberOfChannels,a=new su(e,i,s);return this.emit("region-initialized",a),i?this.saveRegion(a):this.subscriptions.push(this.wavesurfer.once("ready",(c=>{a._setTotalDuration(c),this.saveRegion(a)}))),a}enableDragSelection(e,t=3){var n;const i=(n=this.wavesurfer)===null||n===void 0?void 0:n.getWrapper();if(!(i&&i instanceof HTMLElement))return()=>{};let s=null,a=0,c=0;return mi(i,((l,h,f)=>{s&&s._onUpdate(l,f>a?"end":"start",c)}),(l=>{var h,f;if(a=l,!this.wavesurfer)return;const m=this.wavesurfer.getDuration(),_=(f=(h=this.wavesurfer)===null||h===void 0?void 0:h.getDecodedData())===null||f===void 0?void 0:f.numberOfChannels,{width:T}=this.wavesurfer.getWrapper().getBoundingClientRect();c=a/T*m;const R=l/T*m,k=(l+5)/T*m;s=new su(Object.assign(Object.assign({},e),{start:R,end:k}),m,_),this.emit("region-initialized",s),s.element&&this.regionsContainer.appendChild(s.element)}),(()=>{s&&(this.saveRegion(s),s.updatingSide=void 0,s=null)}),t)}clearRegions(){this.regions.slice().forEach((e=>e.remove())),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}}class fT{constructor(e){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineContext=window.OfflineAudioContext||window.webkitOfflineAudioContext,!window.AudioContext||!window.OfflineContext){console.error("BeatDetect.ERROR : Browser does not support WebAudio API.");return}this.VERSION="1.0.0",this._log=e.log||!1,this._sampleRate=e.sampleRate||44100,this._lowPassFreq=e.lowPassFreq||150,this._highPassFreq=e.highPassFreq||100,this._bpmRange=e.bpmRange||[90,180],this.count=0,this._ts={current:0,previous:0,first:0},this._tapResetId=-1}getBeatInfo(e){return new Promise((t,n)=>{this._fetchRawTrack(e).then(this._buildOfflineCtx.bind(this)).then(this._processRenderedBuffer.bind(this)).then(t).catch(n)})}tapBpm(e){e.element.addEventListener("click",this._tapBpm.bind(this,e),!1)}_fetchRawTrack(e){return this._logEvent("log",`Fetching track ${e.name||""}`),new Promise((t,n)=>{const i=new XMLHttpRequest;i.open("GET",e.url,!0),i.responseType="arraybuffer",i.onload=()=>t(Object.assign(i,e)),i.onerror=n,i.send()})}_buildOfflineCtx(e){return this._logEvent("log","Rendering Offline for analysis..."),new Promise((t,n)=>{new AudioContext().decodeAudioData(e.response,s=>{const a=new window.OfflineContext(2,s.duration*this._sampleRate,this._sampleRate),c=a.createBufferSource();c.buffer=s;const l=a.createBiquadFilter();l.type="lowpass",l.frequency.value=this._lowPassFreq,l.Q.value=1;const h=a.createBiquadFilter();h.type="highpass",h.frequency.value=this._highPassFreq,h.Q.value=1,c.connect(l),l.connect(h),h.connect(a.destination),c.start(0),a.startRendering(),a.oncomplete=f=>t(Object.assign(f,e)),a.onerror=n})})}_processRenderedBuffer(e){return this._logEvent("log","Collecting beat info..."),new Promise(t=>{const n=e.renderedBuffer.getChannelData(0),i=e.renderedBuffer.getChannelData(1),s=this._getPeaks([n,i]),c=this._getIntervals(s).sort((l,h)=>h.count-l.count).splice(0,5);t({bpm:c[0].tempo})})}_getPeaks(e){const t=this._sampleRate/2,n=e[0].length/t;let i=[];for(let s=0;s<n;++s){let a=0;for(let c=s*t;c<(s+1)*t;++c){const l=Math.max(Math.abs(e[0][c]),Math.abs(e[1][c]));(!a||l>a.volume)&&(a={position:c,volume:l})}i.push(a)}return i.sort((s,a)=>a.volume-s.volume),i=i.splice(0,i.length*.5),i.sort((s,a)=>s.position-a.position),i}_getIntervals(e){const t=[];return e.forEach((n,i)=>{for(let s=1;i+s<e.length&&s<10;++s){const a={tempo:60*this._sampleRate/(e[i+s].position-n.position),count:1,peaks:[]};for(;a.tempo<=this._bpmRange[0];)a.tempo*=2;for(;a.tempo>this._bpmRange[1];)a.tempo/=2;a.tempo=Math.round(a.tempo),t.some(l=>l.tempo===a.tempo?(l.peaks.push(n),++l.count,!0):!1)||t.push(a)}}),t}_tapBpm(e){if(window.clearTimeout(this._tapResetId),this._ts.current=Date.now(),this._ts.first===0&&(this._ts.first=this._ts.current),this._ts.previous!==0){let t=6e4*this.count/(this._ts.current-this._ts.first);e.callback(Math.round(t))}this._ts.previous=this._ts.current,++this.count,this._tapResetId=window.setTimeout(()=>{this.count=0,this._ts.current=0,this._ts.previous=0,this._ts.first=0,e.callback("--")},5e3)}_logEvent(e,t){this._log&&console[e](`BeatDetect : ${t}`)}}class pT{constructor(){this.audioContext=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"interactive",sampleRate:44100}),this.wavesurfer=null,this.regions=null,this.activeRegion=null,this.currentRegion=null,this.currentAudioURL="",this.originalBuffer=null,this.isEmpty=!0,this.isLooping=!1,this.zoomLevel=0,this.filters=[],this.eqInputNode=null,this.previewEffectNode=null,this.delayNode=null,this.feedbackNode=null,this.eqInitialized=!1,this.masterGainNode=null,this.previewGainNode=null,this.currentEffectType=null,this.effectParams={},this.bpm=0,this.isMagnetOn=!1,this.quantizeVal=4,this.history=[],this.redoStack=[],this.maxHistory=10,this.beatDetect=new fT({sampleRate:this.audioContext.sampleRate,log:!1,perf:!1,round:!1,float:4,lowPassFreq:150,highPassFreq:100,bpmRange:[70,180],timeSignature:4}),this.initWaveSurfer(),this.setupEventListeners(),this.initBeatDetect()}initWaveSurfer(){this.wavesurfer&&(this.wavesurfer.destroy(),this.wavesurfer=null),this.regions=va.create(),this.eqInitialized=!1,this.wavesurfer=yr.create({container:"#waveform",waveColor:"#ccc",progressColor:"#4b657aff",cursorColor:"#333",height:250,plugins:[this.regions],audioContext:this.audioContext,sampleRate:this.audioContext.sampleRate}),this.setupZoom(),this.setupWaveSurferEvents()}setupZoom(){document.querySelector("#waveform").addEventListener("wheel",t=>{if(this.wavesurfer){t.preventDefault();const n=t.deltaY>0?-50:50;let i=this.wavesurfer.options.minPxPerSec||50,s=Math.max(20,Math.min(i+n,1e3));this.wavesurfer.zoom(s)}},{passive:!1})}setupWaveSurferEvents(){this.wavesurfer.on("decode",()=>{const t=this.wavesurfer.getDecodedData();t&&(this.originalBuffer=t,requestAnimationFrame(()=>this.initEqualizer()),requestAnimationFrame(()=>this.setupKnobListeners()))}),this.wavesurfer.on("ready",async()=>{this.initEqualizer(),this.createTrimUI(),await this.detectBPM();const t=document.getElementById("plus-wrapper");t&&t.remove(),this.regions.enableDragSelection({color:"rgba(165, 165, 165, 0.1)"}),this.initTrimCurtains()}),this.wavesurfer.on("click",()=>this.clearLoop()),this.wavesurfer.on("finish",()=>{this.isLooping&&!this.currentRegion&&this.wavesurfer.play()}),document.querySelector("#waveform").addEventListener("mouseleave",()=>{this.wavesurfer.isPlaying()||this.wavesurfer.setOptions({dragSelection:!0})}),this.regions.on("region-created",t=>{this.isSystemRegion(t)||this.handleRegionCreated(t)}),this.wavesurfer.on("region-click",(t,n)=>{this.isSystemRegion(t)||this.handleRegionClick(t,n)}),this.regions.on("region-in",t=>{this.isSystemRegion(t)||(this.currentRegion=t)}),this.regions.on("region-out",t=>{this.isLooping&&this.currentRegion===t&&t.play()}),this.regions.on("region-removed",t=>{this.activeRegion===t&&(console.log("Active region deleted: cleaning up effects."),this.closeEffectPanel())})}initAudio(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContext.state==="suspended"?this.audioContext.resume():(this.initEqualizer(),Promise.resolve())}async loadAudioFile(e){if(e)try{await this.wavesurfer.load(e)}catch(t){console.error("Load Error:",t)}}async reloadWithBuffer(e){const t=wc(e,e.length),n=URL.createObjectURL(t);this.originalBuffer=e,this.currentAudioURL=n,await this.wavesurfer.load(n),this.eqInitialized=!1,this.initEqualizer()}isSystemRegion(e){return e.id==="left-curtain"||e.id==="right-curtain"||e.id==="trim-region"}handleRegionCreated(e){const t=e.element,n=document.createElement("div");n.className="region-close-btn",n.textContent="x",n.title="Delete Region",Object.assign(n.style,{position:"absolute",top:"5px",right:"5px",width:"24px",height:"24px",backgroundColor:"--var(dgrey)",color:"white",borderRadius:"0 0 0 4px",fontFamily:"Pixelify Sans, system-ui",fontSize:"20px",lineHeight:"22px",textAlign:"center",cursor:"pointer",zIndex:"10",userSelect:"none"}),n.addEventListener("mouseenter",()=>{n.style.backgroundColor="--var(dgrey)",n.style.transform="scale(1.2)"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="--var(lgrey)",n.style.transform="scale(1)"}),n.addEventListener("click",i=>{i.stopPropagation(),e.remove(),this.currentRegion===e&&(this.currentRegion=null)}),t.appendChild(n),this.setupRegionDropZone(e,t),e.on("dblclick",i=>{i.preventDefault(),i.stopPropagation(),this.isLooping||document.getElementById("loop-button").click(),this.setCurrentRegion(e)})}setupRegionDropZone(e,t){t.addEventListener("dragover",n=>{n.preventDefault(),n.stopPropagation(),t.style.border="2px solid rgba(255, 255, 255, 0.5)",t.style.backgroundColor="rgba(255, 255, 255, 0.3)"}),t.addEventListener("dragleave",n=>{n.preventDefault(),n.stopPropagation(),t.style.border="0px solid rgba(255, 255, 255, 0.5)",t.style.backgroundColor=e.color}),t.addEventListener("drop",n=>{n.preventDefault(),n.stopPropagation();const i=document.getElementById("waveform");i&&i.classList.remove("dragover"),t.style.backgroundColor=e.color,t.style.border="none";const s=n.dataTransfer.getData("effectType");if(s){const a=e.color;t.style.backgroundColor="color-mix(in srgb, var(--lgrey) 30%, transparent)",setTimeout(()=>{t&&(t.style.backgroundColor=a)},300),s==="reverse"?this.applyDirectEffect(e,"reverse"):["distortion","delay","bitcrush"].includes(s)&&this.activateRealTimePreview(e,s)}})}handleRegionClick(e,t){t.stopPropagation(),this.setCurrentRegion(e)}setCurrentRegion(e){this.currentRegion&&(this.currentRegion.setOptions({color:"rgba(255, 255, 255, 0.1)"}),this.currentRegion.element&&(this.currentRegion.element.style.border="none",this.currentRegion.element.style.zIndex="10")),this.currentRegion=e,e.setOptions({color:"rgba(255, 255, 255, 0.2)"}),e.element&&(e.element.style.boxSizing="border-box",e.element.style.border="1px solid rgba(255, 255, 255, 0.5)",e.element.style.zIndex="100"),this.wavesurfer.isPlaying()&&e.play()}clearLoop(){this.currentRegion&&(this.currentRegion.setOptions({color:"rgba(255, 255, 255, 0.1)"}),this.currentRegion.element&&(this.currentRegion.element.style.border="none",this.currentRegion.element.style.zIndex="10"),this.currentRegion=null)}initEqualizer(){const e=this.wavesurfer.getMediaElement();if(!e)return;e.crossOrigin="anonymous",this.masterGainNode||(this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.gain.value=.8),this.analyser||(this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=256,this.analyser.minDecibels=-90,this.analyser.maxDecibels=-10),this.masterGainNode.connect(this.analyser),this.mediaNode||(this.mediaNode=this.audioContext.createMediaElementSource(e)),this.eqInputNode||(this.eqInputNode=this.audioContext.createGain()),this.filters.length===0&&(this.filters=Ks.map(i=>{const s=this.audioContext.createBiquadFilter();return s.type=i<=32?"lowshelf":i>=16e3?"highshelf":"peaking",s.frequency.value=i,s}),this.connectSliders());try{this.mediaNode.disconnect()}catch{}try{this.eqInputNode.disconnect()}catch{}try{this.previewEffectNode&&this.previewEffectNode.disconnect()}catch{}try{this.delayNode&&this.delayNode.disconnect()}catch{}try{this.feedbackNode&&this.feedbackNode.disconnect()}catch{}try{this.previewGainNode&&this.previewGainNode.disconnect()}catch{}this.filters.forEach(i=>{try{i.disconnect()}catch{}}),this.masterGainNode.disconnect(),(this.currentEffectType==="distortion"||this.currentEffectType==="bitcrush")&&this.previewEffectNode?(this.mediaNode.connect(this.previewEffectNode),this.previewEffectNode.connect(this.eqInputNode)):this.currentEffectType==="delay"&&this.delayNode?(this.mediaNode.connect(this.eqInputNode),this.mediaNode.connect(this.delayNode),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.delayNode),this.delayNode.connect(this.eqInputNode)):this.mediaNode.connect(this.eqInputNode);let t=this.eqInputNode;this.currentEffectType&&this.previewGainNode&&(this.eqInputNode.disconnect(),this.eqInputNode.connect(this.previewGainNode),t=this.previewGainNode);let n=t;this.filters.forEach(i=>{n.connect(i),n=i}),n.connect(this.masterGainNode),this.masterGainNode.connect(this.audioContext.destination),this.masterGainNode.connect(this.analyser),this.eqInitialized=!0}connectSliders(){document.querySelectorAll(".slider-eq").forEach((t,n)=>{this.filters[n]&&(this.filters[n].gain.value=t.value,t.oninput=i=>{this.filters[n].gain.value=i.target.value})})}async applyDirectEffect(e,t){if(this.originalBuffer)try{const n=await Tc(this.originalBuffer,this.audioContext,t,e.start,e.end);n&&await this.reloadWithBuffer(n)}catch{}}activateRealTimePreview(e,t){this.closeEffectPanel(),this.activeRegion=e,this.currentEffectType=t;const n=document.getElementById("knobs-rack");n&&n.classList.remove("hidden"),this.previewGainNode=this.audioContext.createGain();const i=.8;this.previewGainNode.gain.value=i,this.effectParams.volume=i;const s=document.getElementById("knob-vol");s&&this.updateKnobVisual(s,i);const a=document.getElementById("val-vol");a&&(a.innerText="80%");let c=.5,l=.5;if(t==="distortion")document.getElementById("label-p1").innerText="DRIVE",document.getElementById("label-p2").innerText="---",this.effectParams.amount=50,c=50/400,this.previewEffectNode=this.audioContext.createWaveShaper(),this.previewEffectNode.curve=ii(this.effectParams.amount),this.previewEffectNode.oversample="4x";else if(t==="delay")document.getElementById("label-p1").innerText="TIME",document.getElementById("label-p2").innerText="F.BACK",this.effectParams.time=.25,this.effectParams.feedback=.4,c=.25,l=.4/.9,this.delayNode=this.audioContext.createDelay(2),this.delayNode.delayTime.value=.25,this.feedbackNode=this.audioContext.createGain(),this.feedbackNode.gain.value=.4;else if(t==="bitcrush"){document.getElementById("label-p1").innerText="BITS",document.getElementById("label-p2").innerText="FREQ",this.effectParams.bits=8,this.effectParams.normFreq=.1,c=8/16,l=.1;const f=4096;this.previewEffectNode=this.audioContext.createScriptProcessor(f,1,1),this.previewEffectNode.onaudioprocess=m=>{const _=m.inputBuffer.getChannelData(0),T=m.outputBuffer.getChannelData(0),R=1/Math.pow(2,this.effectParams.bits),k=Math.floor(1/this.effectParams.normFreq);for(let S=0;S<f;S++)T[S]=S%k===0?Math.round(_[S]/R)*R:S>0?T[S-1]:0}}this.updateKnobVisual(document.getElementById("knob-p1"),c),this.updateEffectParam(1,c),t!=="distortion"?(this.updateKnobVisual(document.getElementById("knob-p2"),l),this.updateEffectParam(2,l)):(this.updateKnobVisual(document.getElementById("knob-p2"),0),document.getElementById("val-p2").innerText="--");const h=document.createElement("div");h.className="region-apply-btn",h.innerText="APPLY",Object.assign(h.style,{position:"absolute",bottom:"50px",left:"50%",transform:"translateX(-50%)",backgroundColor:"color-mix(in srgb, var(--lgrey), transparent 20%)",color:"white",border:"2px solid black",fontFamily:'"Pixelify Sans", system-ui',fontSize:"24px",fontWeight:"bold",padding:"2px 8px",cursor:"pointer",zIndex:"1000",boxShadow:"2px 2px 0px rgba(0,0,0,0.5)",pointerEvents:"auto",whiteSpace:"nowrap"}),h.onclick=f=>{f.preventDefault(),f.stopPropagation(),this.freezeCurrentEffect()},e.element.appendChild(h),this.currentApplyBtn=h,this.eqInitialized=!1,this.initEqualizer(),this.isLooping||document.getElementById("loop-button").click(),e.play()}createSlider(e,t,n,i,s,a){const c=document.createElement("div");c.style.marginBottom="10px";const l=document.createElement("span");l.innerText=`${e}: `;const h=document.createElement("span");h.innerText=s,h.style.marginLeft="5px",h.style.color="#aaa";const f=document.createElement("input");return f.type="range",f.min=t,f.max=n,f.step=i,f.value=s,f.style.width="100%",f.oninput=m=>{const _=parseFloat(m.target.value);h.innerText=_,a(_)},c.appendChild(l),c.appendChild(f),c.appendChild(h),c}createEffectControlsUI(e){let t=document.getElementById("effect-controls-wrapper");t||(t=document.createElement("div"),t.id="effect-controls-wrapper",Object.assign(t.style,{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",backgroundColor:"#222",padding:"15px",borderRadius:"8px",border:"1px solid #444",color:"white",zIndex:"1000",minWidth:"250px"}),document.body.appendChild(t)),t.innerHTML="",t.style.display="block";const n=document.createElement("h4");n.innerText=e.toUpperCase(),n.style.margin="0 0 10px 0",t.appendChild(n),e==="distortion"?t.appendChild(this.createSlider("Drive",0,400,1,this.effectParams.amount,c=>{this.effectParams.amount=c,this.previewEffectNode&&(this.previewEffectNode.curve=ii(c))})):e==="delay"?(t.appendChild(this.createSlider("Time (s)",.01,1,.01,this.effectParams.time,c=>{this.effectParams.time=c,this.delayNode&&this.delayNode.delayTime.linearRampToValueAtTime(c,this.audioContext.currentTime+.1)})),t.appendChild(this.createSlider("Feedback",0,.9,.05,this.effectParams.feedback,c=>{this.effectParams.feedback=c,this.feedbackNode&&(this.feedbackNode.gain.value=c)}))):e==="bitcrush"&&(t.appendChild(this.createSlider("Bits",1,16,1,this.effectParams.bits,c=>{this.effectParams.bits=c})),t.appendChild(this.createSlider("Freq (Norm)",.01,1,.01,this.effectParams.normFreq,c=>{this.effectParams.normFreq=c})));const i=document.createElement("div");i.style.display="flex",i.style.gap="10px",i.style.marginTop="15px";const s=document.createElement("button");s.innerText="FREEZE",Object.assign(s.style,{background:"var(--color-green)",color:"#000",border:"none",padding:"8px 15px",cursor:"pointer",fontWeight:"bold"}),s.onclick=()=>this.freezeCurrentEffect();const a=document.createElement("button");a.innerText="CANCEL",Object.assign(a.style,{background:"#555",color:"white",border:"none",padding:"8px 15px",cursor:"pointer"}),a.onclick=()=>this.closeEffectPanel(),i.appendChild(s),i.appendChild(a),t.appendChild(i)}async freezeCurrentEffect(){if(this.activeRegion)try{const e=await Tc(this.originalBuffer,this.audioContext,this.currentEffectType,this.activeRegion.start,this.activeRegion.end,this.effectParams);if(e&&this.effectParams.volume!==void 0){const t=this.effectParams.volume,n=Math.floor(this.activeRegion.start*e.sampleRate),i=Math.floor(this.activeRegion.end*e.sampleRate);for(let s=0;s<e.numberOfChannels;s++){const a=e.getChannelData(s);for(let c=n;c<i&&c<a.length;c++)a[c]=a[c]*t}}this.closeEffectPanel(),e&&await this.reloadWithBuffer(e)}catch(e){console.error("Freeze Error:",e)}}closeEffectPanel(){const e=document.getElementById("knobs-rack");e&&e.classList.add("hidden"),this.currentApplyBtn&&(this.currentApplyBtn.remove(),this.currentApplyBtn=null),this.previewEffectNode=null,this.delayNode=null,this.feedbackNode=null,this.previewGainNode=null,this.activeRegion=null,this.currentEffectType=null;const t=document.getElementById("label-p1");t&&(t.innerText="PARAM 1");const n=document.getElementById("label-p2");n&&(n.innerText="PARAM 2"),this.eqInitialized=!1,this.initEqualizer()}setupKnobListeners(){const e=document.getElementById("freeze-btn");e&&e.addEventListener("click",()=>this.freezeCurrentEffect());const t=(n,i)=>{const s=document.getElementById(`knob-${n}`);if(!s)return;let a=0,c=0;const l=f=>{const m=a-f.clientY;let T=c+m*.005;T=Math.max(0,Math.min(1,T)),this.updateKnobVisual(s,T),i(T)},h=()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",h),document.body.style.cursor="default"};s.addEventListener("mousedown",f=>{f.preventDefault(),a=f.clientY,c=parseFloat(s.dataset.value)||0,document.addEventListener("mousemove",l),document.addEventListener("mouseup",h),document.body.style.cursor="ns-resize"})};t("p1",n=>{this.currentEffectType&&this.updateEffectParam(1,n)}),t("p2",n=>{this.currentEffectType&&this.updateEffectParam(2,n)}),t("vol",n=>{this.currentEffectType?(this.previewGainNode&&(this.previewGainNode.gain.value=n),this.effectParams.volume=n):this.masterGainNode&&(this.masterGainNode.gain.value=n);const i=document.getElementById("val-vol");i&&(i.innerText=Math.round(n*100)+"%")})}updateKnobVisual(e,t){e.dataset.value=t;const n=t*270-135,i=e.querySelector(".knob-indicator");i&&(i.style.transform=`translate(-50%, -100%) rotate(${n}deg)`)}updateEffectParam(e,t){const n=this.currentEffectType;if(n==="distortion"){if(e===1){const i=t*400;this.effectParams.amount=i,document.getElementById("val-p1").innerText=Math.floor(i),this.previewEffectNode&&(this.previewEffectNode.curve=ii(i))}}else if(n==="delay"){if(e===1){const i=.01+t*.99;this.effectParams.time=i,document.getElementById("val-p1").innerText=i.toFixed(2)+"s",this.delayNode&&this.delayNode.delayTime.linearRampToValueAtTime(i,this.audioContext.currentTime+.1)}if(e===2){const i=t*.9;this.effectParams.feedback=i,document.getElementById("val-p2").innerText=Math.floor(i*100)+"%",this.feedbackNode&&(this.feedbackNode.gain.value=i)}}else if(n==="bitcrush"){if(e===1){const i=1+Math.floor(t*15);this.effectParams.bits=i,document.getElementById("val-p1").innerText=i+"bit"}if(e===2){const i=.01+t*.99;this.effectParams.normFreq=i,document.getElementById("val-p2").innerText=i.toFixed(2)+"x"}}}initTrimCurtains(){const e=this.wavesurfer.getDuration(),t="rgba(0, 0, 0, 0.65)",n="var(--color-red)";this.regions.getRegions().forEach(i=>{(i.id==="left-curtain"||i.id==="right-curtain")&&i.remove()}),this.leftCurtain=this.regions.addRegion({id:"left-curtain",start:0,end:0,color:t,drag:!1,resize:!0,loop:!1,handleStyle:{left:{display:"none"},right:{backgroundColor:n,width:"4px",opacity:"1",zIndex:"10"}}}),this.rightCurtain=this.regions.addRegion({id:"right-curtain",start:e,end:e,color:t,drag:!1,resize:!0,loop:!1,handleStyle:{left:{backgroundColor:n,width:"4px",opacity:"1",zIndex:"10"},right:{display:"none"}}})}createTrimUI(){const e=document.getElementById("waveform");e.querySelectorAll(".trim-ui-element").forEach(t=>t.remove()),this.trimUI={container:e},this.trimUI.leftOverlay=document.createElement("div"),this.trimUI.leftOverlay.className="trim-overlay trim-ui-element",this.trimUI.leftOverlay.style.cssText="left: 0; width: 0%;",this.trimUI.rightOverlay=document.createElement("div"),this.trimUI.rightOverlay.className="trim-overlay trim-ui-element",this.trimUI.rightOverlay.style.cssText="right: 0; width: 0%;",this.trimUI.leftHandle=document.createElement("div"),this.trimUI.leftHandle.className="trim-handle trim-handle-left trim-ui-element",this.trimUI.leftHandle.innerText="|",this.trimUI.leftHandle.style.left="0%",this.trimUI.rightHandle=document.createElement("div"),this.trimUI.rightHandle.className="trim-handle trim-handle-right trim-ui-element",this.trimUI.rightHandle.innerText="|",this.trimUI.rightHandle.style.cssText="left: 100%; transform: translateX(-100%);",e.append(this.trimUI.leftOverlay,this.trimUI.rightOverlay,this.trimUI.leftHandle,this.trimUI.rightHandle),this.enableDrag(this.trimUI.leftHandle,"left"),this.enableDrag(this.trimUI.rightHandle,"right")}enableDrag(e,t){let n=!1;e.addEventListener("mousedown",i=>{n=!0,i.stopPropagation(),document.body.style.cursor="col-resize"}),window.addEventListener("mousemove",i=>{if(!n)return;i.preventDefault();const s=this.trimUI.container.getBoundingClientRect();let a=i.clientX-s.left;a<0&&(a=0),a>s.width&&(a=s.width);const c=a/s.width*100;if(t==="left"){const l=parseFloat(this.trimUI.rightHandle.style.left)||100;if(c>=l-2)return;e.style.left=c+"%",this.trimUI.leftOverlay.style.width=c+"%"}else{const l=parseFloat(this.trimUI.leftHandle.style.left)||0;if(c<=l+2)return;e.style.left=c+"%",this.trimUI.rightOverlay.style.width=100-c+"%"}}),window.addEventListener("mouseup",()=>{n&&(n=!1,document.body.style.cursor="default")})}async trimAudio(){if(!this.originalBuffer||!this.trimUI)return;let e=parseFloat(this.trimUI.leftHandle.style.left)||0,t=parseFloat(this.trimUI.rightHandle.style.left);isNaN(t)&&(t=100);let n=e/100,i=t/100;const s=.001;if(n<s&&(n=0),i>1-s&&(i=1),n>=i||n===0&&i===1)return;const a=Math.floor(n*this.originalBuffer.length);if(Math.floor(i*this.originalBuffer.length)-a<=0)return;const l=If(this.originalBuffer,n,i,this.audioContext);l&&(await this.reloadWithBuffer(l),this.regions.clearRegions(),this.createTrimUI())}initBeatDetect(){this.lockTimer=null,this.lastTapTime=0;const e=document.getElementById("bpm-led");this.beatDetect.tapBpm({element:e,precision:4,callback:t=>{const n=Date.now();this.lockTimer&&(clearTimeout(this.lockTimer),this.lockTimer=null),n-this.lastTapTime<=2e3&&(e.classList.remove("bpm-led-locked"),this.bpm=Math.round(t),e.textContent=this.bpm+" BPM"),this.lastTapTime=n,this.lockTimer=setTimeout(()=>e.classList.add("bpm-led-locked"),2e3)}})}async detectBPM(){this.beatDetect.getBeatInfo({url:this.currentAudioURL}).then(e=>{this.bpm=Math.round(e.bpm),document.getElementById("bpm-led").textContent=this.bpm+" BPM"}).catch(e=>{})}setupBpmInput(){const e=document.getElementById("bpm-led");e&&e.addEventListener("contextmenu",t=>{if(t.preventDefault(),t.stopPropagation(),e.querySelector("input"))return;const n=e.innerText.replace(" BPM",""),i=parseInt(n)||this.bpm||120;e.innerHTML="";const s=document.createElement("input");s.classList.add("BPM_input"),s.type="number",s.value=i,s.style.cssText="width:60px; background:transparent; color:inherit; border:none; font-family:inherit; font-size:inherit; text-align:center; outline:none;",e.appendChild(s),s.focus(),s.select();const a=()=>{let c=parseInt(s.value);c&&c>0&&(this.bpm=c),e.innerText=this.bpm+" BPM",e.classList.remove("bpm-led-locked")};s.addEventListener("keydown",c=>{c.key==="Enter"&&a()}),s.addEventListener("blur",()=>a())})}setupEventListeners(){document.getElementById("play-button").addEventListener("click",()=>this.wavesurfer.play()),document.getElementById("pause-button").addEventListener("click",()=>this.wavesurfer.pause()),document.getElementById("stop-button").addEventListener("click",()=>{this.isLooping&&this.wavesurfer.seekTo(0),this.wavesurfer.stop()}),document.getElementById("loop-button").addEventListener("click",()=>{this.isLooping=!this.isLooping,document.getElementById("loop-button").classList.toggle("old-button-loop")}),document.getElementById("x2-button").addEventListener("click",()=>{if(this.isLooping&&this.currentRegion){const n=this.currentRegion.start,i=n+(this.currentRegion.end-n)*2;this.regions.clearRegions(),this.regions.addRegion({start:n,end:i,loop:!0,color:"rgba(165, 165, 165, 0.1)",handleStyle:{left:"rgba(0, 150, 255, 0.9)",right:"rgba(0, 150, 255, 0.9)"}})}}),document.getElementById("d2-button").addEventListener("click",()=>{if(this.isLooping&&this.currentRegion){this.wavesurfer.seekTo(this.currentRegion.start);const n=this.currentRegion.start,i=n+(this.currentRegion.end-n)/2;this.regions.clearRegions(),this.regions.addRegion({start:n,end:i,loop:!0,color:"rgba(165, 165, 165, 0.3)",handleStyle:{left:"rgba(0, 150, 255, 0.9)",right:"rgba(0, 150, 255, 0.9)"}})}}),document.getElementById("trim-btn").addEventListener("click",()=>this.trimAudio()),document.addEventListener("keydown",n=>{n.key.toLowerCase()===" "&&this.wavesurfer.playPause(),(n.ctrlKey||n.metaKey)&&n.key==="z"&&n.preventDefault(),(n.ctrlKey||n.metaKey)&&(n.key==="y"||n.shiftKey&&n.key==="Z")&&n.preventDefault()});const e=document.getElementById("export-btn");e&&e.addEventListener("click",()=>{this.exportAudio(),e.style.color,e.style.color="var(--lgrey)",setTimeout(()=>{e.style.color=""},200)});const t=document.getElementById("save-bank-btn");t&&t.addEventListener("click",()=>{this.saveToCurrentBank(),t.style.color,t.style.color="var(--color-green)",setTimeout(()=>{t.style.color=""},300)}),this.setupGlobalDragDrop(),this.setupBpmInput(),this.setupEqDrawing()}setupGlobalDragDrop(){const e=document.getElementById("waveform");e.addEventListener("dragover",n=>{n.preventDefault();const i=n.dataTransfer.types;i.includes("effecttype")||i.includes("effectType")||e.classList.add("dragover")}),e.addEventListener("dragleave",()=>e.classList.remove("dragover")),e.addEventListener("drop",n=>{if(n.preventDefault(),e.classList.remove("dragover"),n.dataTransfer.getData("effectType"))return;const s=n.dataTransfer.getData("type"),a=n.dataTransfer.getData("audioUrl");if(s==="sample"&&a)this.wavesurfer.load(a),this.currentAudioURL=a;else if(n.dataTransfer.files.length>0){const c=n.dataTransfer.files[0];if(c){const l=URL.createObjectURL(c);this.loadAudioFile(l),this.currentAudioURL=l}}}),document.addEventListener("dragstart",n=>{const i=n.target.closest?n.target.closest(".fx-img"):null;if(i){const s=i.getAttribute("data-effect");s&&(n.dataTransfer.setData("effectType",s),n.dataTransfer.effectAllowed="copy")}});const t=document.getElementById("master-vol-fader");t&&t.addEventListener("input",n=>{const i=parseFloat(n.target.value);this.masterGainNode&&this.masterGainNode.gain.setTargetAtTime(i,this.audioContext.currentTime,.01),console.log("Master Volume:",i)})}async getProcessedWavBlob(){if(!this.originalBuffer)return null;const e=new OfflineAudioContext(this.originalBuffer.numberOfChannels,this.originalBuffer.length,this.originalBuffer.sampleRate),t=e.createBufferSource();t.buffer=this.originalBuffer;let n=t;const i=this.filters.map(c=>c.gain.value);if(Ks.forEach((c,l)=>{const h=e.createBiquadFilter();h.type=c<=32?"lowshelf":c>=16e3?"highshelf":"peaking",h.frequency.value=c,h.gain.value=i[l],n.connect(h),n=h}),this.masterGainNode){const c=e.createGain();c.gain.value=this.masterGainNode.gain.value,n.connect(c),n=c}n.connect(e.destination),t.start(0);const s=await e.startRendering();let a=0;for(let c=0;c<s.numberOfChannels;c++){const l=s.getChannelData(c);for(let h=0;h<l.length;h++)Math.abs(l[h])>a&&(a=Math.abs(l[h]))}if(a>0){const c=.98/a;for(let l=0;l<s.numberOfChannels;l++){const h=s.getChannelData(l);for(let f=0;f<h.length;f++)h[f]*=c}}return wc(s,s.length)}async exportAudio(){const e=await this.getProcessedWavBlob();if(!e){await Ne.show("alert","Nothing to download in here!");return}const t=URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=t;let s=await Ne.show("prompt","Name your new sample:","My_wild_sample001");s&&(n.download=s.endsWith(".wav")?s:s+".wav",document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(t),document.body.removeChild(n))}async saveToCurrentBank(){const e=document.getElementById("banks"),t=e?e.value:null;if(!this.originalBuffer){await Ne.show("alert","Watch out, no sample loaded!");return}if(!t||t===""||t==="__NEW_BANK__"){await Ne.show("alert","Seleziona una soundbank valida!");return}const n=document.getElementById("save-bank-btn"),i=n.innerHTML;n.innerHTML='<i class="pixelart-icons-font-clock"></i>',n.style.pointerEvents="none";try{const s=await this.getProcessedWavBlob();let c=await Ne.show("prompt","Name your new sample:","Rename your sample");if(!c)throw new Error("Salvataggio annullato");const l=["var(--color-red)","var(--color-ambra)","var(--color-green)","var(--color-blu)"],h=l[Math.floor(Math.random()*l.length)];await Ct.addSample(t,c,s,h),vn(t),await Ne.show("alert","Sample salvato nella bank!")}catch(s){s.message!=="Salvataggio annullato"&&(console.error(s),alert("Errore durante il salvataggio."))}finally{n.innerHTML=i,n.style.pointerEvents="auto"}}drawMeter(){const e=new Uint8Array(this.analyser.frequencyBinCount),t=()=>{this.analyser.getByteFrequencyData(e);const n=e.reduce((s,a)=>s+a)/e.length,i=document.getElementById("meter-fill");i&&(i.style.width=Math.min(100,n/128*100)+"%"),requestAnimationFrame(t)};t()}setupEqDrawing(){const e=document.getElementById("sliders-wrapper");if(!e)return;const t=n=>{const i=e.getBoundingClientRect(),s=n.clientX-i.left,a=n.clientY-i.top,c=e.querySelectorAll(".eq-band"),l=i.width/c.length,h=Math.floor(s/l);if(h>=0&&h<c.length){const f=c[h].querySelector("input"),m=i.height;let _=12-a/m*24;_=Math.max(-12,Math.min(12,_)),f.value=_,this.filters&&this.filters[h]&&this.filters[h].gain.setTargetAtTime(_,this.audioContext.currentTime,.01)}};e.onmousedown=n=>{this.isDrawingEq=!0,t(n)},window.onmousemove=n=>{this.isDrawingEq&&t(n)},window.onmouseup=()=>{this.isDrawingEq=!1}}}let er;async function mT(){try{await Hm(Wt),console.log("Logged in as:",Wt.currentUser.uid),await Ct.loadAll(),console.log("Banks loaded!"),rT(),er=new pT;const r=async()=>{er&&(await er.initAudio(),er.drawMeter(),console.log("Audio Context Unlocked:",er.audioContext.state),window.removeEventListener("click",r))};window.addEventListener("click",r)}catch(r){console.error("Initialization failed:",r),alert("Errore di connessione al Database. Controlla la console.")}}document.addEventListener("DOMContentLoaded",mT);
